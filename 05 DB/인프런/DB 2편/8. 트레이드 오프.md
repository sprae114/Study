ë§í¬ : [[[ì¸í”„ëŸ°]ìŠ¤í”„ë§DB 2í¸.pdf]]
í•´ì‹œíƒœí¬ : #íŠ¸ë ˆì´ë“œì˜¤í”„

----
## ë¬´ì—‡ì„ íŠ¸ë ˆì´ë“œ ì˜¤í”„í•´ì•¼í• ê¹Œ?
=> í”„ë¡œì íŠ¸ì˜ í˜„ì¬ ìƒí™©ì— ë§ëŠ” ë” ì ì ˆí•œ ì„ íƒí•´ì•¼í•¨.

#### ğŸ“Œêµ¬ì¡°ì˜ ì•ˆì •ì„±
- ì¥ì  : êµ¬í˜„ì²´ë¥¼ ì‰½ê²Œ êµì²´í• ìˆ˜ ìˆìŒ.
- ë˜ì  : êµ¬ì¡°ë¥¼ ë§ì¶”ê¸° ìœ„í•´ì„œ, ì¤‘ê°„ì— ì–´ëŒ‘í„°ê°€ ë“¤ì–´ê°€ë©´ì„œ ë§ì€ í´ë˜ìŠ¤ì™€ ì „ì²´Â **êµ¬ì¡°ê°€ ë„ˆë¬´ ë³µì¡í•´ì§**Â 
![[Pasted image 20230104121848.png]]

#### ğŸ“Œ ë‹¨ìˆœí•œ êµ¬ì¡°
- ì¥ì  :  DI, OCP ì›ì¹™ì„ í¬ê¸°í•˜ëŠ” ëŒ€ì‹ ì—, ë³µì¡í•œ ì–´ëŒ‘í„°ë¥¼ ì œê±°í•˜ê³ , êµ¬ì¡°ë¥¼ ë‹¨ìˆœí•˜ê²Œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆìŒ.
- ë‹¨ì  : êµ¬í˜„ì²´ë¥¼ êµì²´í•˜ê¸° ìœ„í•´ì„œëŠ” ì½”ë“œì˜ ë§ì€ ë¶€ë¶„ì„ ê³ ì³ì•¼ëŒ.
![[Pasted image 20230104122005.png]]

## JPA + Querydsl
=>ê¸°ë³¸ CRUDì™€ ë‹¨ìˆœ ì¡°íšŒëŠ” ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ë‹´ë‹¹í•˜ê³ , ë³µì¡í•œ ì¡°íšŒ ì¿¼ë¦¬ëŠ” Querydslì´ ë‹´ë‹¹í•œë‹¤.
![[Pasted image 20230104124532.png]]

#### ğŸ“ŒtemRepositoryV2
```java
public interface ItemRepositoryV2 extends JpaRepository<Item, Long> {}
```


#### ğŸ“ŒItemQueryRepositoryV2
```java
import static hello.itemservice.domain.QItem.item;
@Repository
public class ItemQueryRepositoryV2 {
 	private final JPAQueryFactory query;
    
 	public ItemQueryRepositoryV2(EntityManager em) {
 		this.query = new JPAQueryFactory(em);
 	}
 	
	public List<Item> findAll(ItemSearchCond cond) {
		return query.select(item)
			.from(item)
			.where(
				maxPrice(cond.getMaxPrice()),
				likeItemName(cond.getItemName()))
			.fetch();
	}
 
 	private BooleanExpression likeItemName(String itemName) {
 		if (StringUtils.hasText(itemName)) {
 			return item.itemName.like("%" + itemName + "%");
 		}
 		return null;
 	}
    
 	private BooleanExpression maxPrice(Integer maxPrice) {
 		if (maxPrice != null) {
 		return item.price.loe(maxPrice);
 		}
 	return null;
 	}
}
```


#### ğŸ“ŒItemServiceV2
```java
@Service
@RequiredArgsConstructor
@Transactional
public class ItemServiceV2 implements ItemService {
 	private final ItemRepositoryV2 itemRepositoryV2;
 	private final ItemQueryRepositoryV2 itemQueryRepositoryV2;
 
 	@Override
 	public Item save(Item item) {
 		return itemRepositoryV2.save(item);
 	}
    
 	@Override
 	public void update(Long itemId, ItemUpdateDto updateParam) {
 		Item findItem = findById(itemId).orElseThrow();
 		
        findItem.setItemName(updateParam.getItemName());
 		findItem.setPrice(updateParam.getPrice());
 		findItem.setQuantity(updateParam.getQuantity());
 	}
    
 	@Override
 		public Optional<Item> findById(Long id) {
 		return itemRepositoryV2.findById(id);
 	}
    
 	@Override
 		public List<Item> findItems(ItemSearchCond cond) {
 		return itemQueryRepositoryV2.findAll(cond);
 	}
}
```

## ë‹¤ì–‘í•œ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  ì¡°í•©
=> **JPA, ìŠ¤í”„ë§ ë°ì´í„° JPA, Querydslì„ ê¸°ë³¸**ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ë§Œì•½ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì¨ì•¼ í•˜ëŠ”ë°, í•´ê²°ì´ ì˜ ì•ˆë˜ë©´ í•´ë‹¹ ë¶€ë¶„ì—ëŠ” JdbcTemplateì´ë‚˜ MyBatisë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œ


### íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ì„ íƒ
- `JpaTransactionManager`Â ëŠ”Â `DataSourceTransactionManager`Â ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ë„ ëŒ€ë¶€ë¶„ ì œê³µí•œë‹¤. JPAë¼ëŠ” ê¸°ìˆ ë„ ê²°êµ­ ë‚´ë¶€ì—ì„œëŠ” DataSourceì™€ JDBC ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
- ê²°ê³¼ì ìœ¼ë¡œÂ `JpaTransactionManager`Â ë¥¼ í•˜ë‚˜ë§Œ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•˜ë©´, JPA, JdbcTemplate, MyBatis ëª¨ë‘ë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.