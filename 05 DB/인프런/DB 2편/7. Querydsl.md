ë§í¬ : [[[ì¸í”„ëŸ°]ìŠ¤í”„ë§DB 2í¸.pdf]]
í•´ì‹œíƒœí¬ : #QueryDSL

----
#### ğŸ“ŒQueryDSLë€?
Query(ì¿¼ë¦¬) +Â Domain(ë„ë©”ì¸) +Â Specific(íŠ¹í™”) + Language(ì–¸ì–´)
QueryDSLì€ ì¿¼ë¦¬ë¥¼ **Javaë¡œ type-safeí•˜ê²Œ ê°œë°œ**í•  ìˆ˜ ìˆê²Œ ì§€ì›í•˜ëŠ” í”„ë ˆì„ì›Œí¬ë‹¤. ì£¼ë¡œÂ JPAì¿¼ë¦¬(JPQL)ì— ì‚¬ìš©í•˜ë‹¤.

#### ğŸ“ŒQueryDSLë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ”?
-   queryëŠ” ë¬¸ìì´ë¯€ë¡œ Type-check ë¶ˆê°€
-   ì‹¤í–‰í•˜ê¸° ì „ê¹Œì§€ ì‘ë™ì—¬ë¶€ í™•ì¸ ë¶ˆê°€(ëŸ°íƒ€ì„ ì—ëŸ¬)
```java
String sql = "select * from member" +
"where name like ?" +
"and age between ? and ?" // ê³µë°±ì´ ì—†ì–´ ì˜¤ë¥˜
// = select * from memberwhere name like ?and age between ? and ?"
```


#### ğŸ“Œ[ì½”ë“œ] QueryDSLì„¤ì •
```c
dependencies { 
	//Querydsl ì¶”ê°€ 
	implementation 'com.querydsl:querydsl-jpa' 
	annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa" 
	annotationProcessor "jakarta.annotation:jakarta.annotation-api" 
	annotationProcessor "jakarta.persistence:jakarta.persistence-api"
}

//Querydsl ì¶”ê°€, ìë™ ìƒì„±ëœ Qí´ë˜ìŠ¤ gradle cleanìœ¼ë¡œ ì œê±° 
clean { 
	delete file('src/main/generated')
}
```

#### ğŸ“Œ[ì½”ë“œ] Querydsl ì ìš©
â–¶QuerydslConfig
```java
@Configuration  
@RequiredArgsConstructor  
public class QuerydslConfig {  
  
    private final EntityManager em;  
  
    @Bean  
    public ItemService itemService() {  
        return new ItemServiceV1(itemRepository());  
    }  
  
    @Bean  
    public ItemRepository itemRepository() {  
        return new JpaItemRepositoryV3(em);  
    }  
}
```


â–¶JpaItemRepositoryV3
```java
@Repository
@Transactional
public class JpaItemRepositoryV3 implements ItemRepository {

 	private final EntityManager em;
 	private final JPAQueryFactory query;
    
 	public JpaItemRepositoryV3(EntityManager em) {
 		this.em = em;
 		this.query = new JPAQueryFactory(em);
 	}
   
 	public List<Item> findAllOld(ItemSearchCond itemSearch) {
 		String itemName = itemSearch.getItemName();
 		Integer maxPrice = itemSearch.getMaxPrice();
 		QItem item = QItem.item;
 		BooleanBuilder builder = new BooleanBuilder();
        
 		if (StringUtils.hasText(itemName)) {
 			builder.and(item.itemName.like("%" + itemName + "%"));
 		}
        
 		if (maxPrice != null) {
 			builder.and(item.price.loe(maxPrice));
 		}
    
 		List<Item> result = query
 			.select(item)
 			.from(item)
 			.where(builder)
 			.fetch();
 		return result;
 	}


 	@Override
 	public List<Item> findAll(ItemSearchCond cond) {
 		String itemName = cond.getItemName();
 		Integer maxPrice = cond.getMaxPrice();
 		List<Item> result = query
 			.select(item)
 			.from(item)
 			.where(likeItemName(itemName), maxPrice(maxPrice))
 			.fetch();
 		return result;
	}


    private BooleanExpression likeItemName(String itemName) {
 		if (StringUtils.hasText(itemName)) {
 			return item.itemName.like("%" + itemName + "%");
 		}
 		return null;
 	}


 	private BooleanExpression maxPrice(Integer maxPrice) {
 		if (maxPrice != null) {
 			return item.price.loe(maxPrice);
 		}
 		return null;
 	}
}
```

- Querydslì„ ì‚¬ìš©í•˜ë ¤ë©´ JPAQueryFactory ê°€ í•„ìš”í•˜ë‹¤. JPAQueryFactory ëŠ” JPA ì¿¼ë¦¬ì¸ JPQLì„ ë§Œë“¤ê¸° ë•Œë¬¸ì— EntityManager ê°€ í•„ìš”í•˜ë‹¤.
- ì„¤ì • ë°©ì‹ì€ JdbcTemplate ì„ ì„¤ì •í•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ë‹¤
