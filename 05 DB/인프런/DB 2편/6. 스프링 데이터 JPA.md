ë§í¬ : [[[ì¸í”„ëŸ°]ìŠ¤í”„ë§DB 2í¸.pdf]]
í•´ì‹œíƒœí¬ : #ìŠ¤í”„ë§ë°ì´í„°JPA

----
## ìŠ¤í”„ë§ ë°ì´í„° JPAë€?
=> JPAë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬



## JpaRepository ê¸°ëŠ¥ì€?
#### ğŸ“Œ ê³µí†µ ì¸í„°í˜ì´ìŠ¤ ê¸°ëŠ¥
- JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œ ê¸°ë³¸ì ì¸ CRUD ê¸°ëŠ¥ ì œê³µí•œë‹¤
=> JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¸í„°í˜ì´ìŠ¤ ìƒì† ë°›ê³ , ì œë„¤ë¦­ì— ê´€ë¦¬í•  <ì—”í‹°í‹°, ì—”í‹°í‹°ID> ë¥¼ ì£¼ë©´ ëœë‹¤.
```java
public interface ItemRepository extends JpaRepository<Member, Long> {}
```

![[Pasted image 20230103164852.png]]
![[Pasted image 20230103175901.png]]

#### ğŸ“Œ ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥
=> JPAëŠ” ì¸í„°í˜ì´ìŠ¤ì— ë©”ì„œë“œë§Œ ì ì–´ë‘ë©´, ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„í•´ì„œ ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¤í–‰í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•¨.

- ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬
```java
public List<Member> findByUsernameAndAgeGreaterThan(String username, int age) { 
	return em.createQuery("select m from Member m where m.username = :username and m.age > :age")
		.setParameter("username", username) 
		.setParameter("age", age) 
		.getResultList();
}
```

- ìŠ¤í”„ë§ ë°ì´í„° JPA
```java
public interface MemberRepository extends JpaRepository<Member, Long> { 
	List<Member> findByUsernameAndAgeGreaterThan(String username, int age);
}
```

```sql
select i from User i where i.UserName = ? and i.Age >= ?
```

- ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” ì¿¼ë¦¬ ë©”ì†Œë“œ ê¸°ëŠ¥
![[Pasted image 20230103180130.png]]

#### ğŸ“Œ JPQL ì§ì ‘ ì‚¬ìš©í•˜ê¸°
```java
public interface SpringDataJpaItemRepository extends JpaRepository<Item, Long> {
	//ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥ 
	List<Item> findByItemNameLike(String itemName);
	
	//ì¿¼ë¦¬ ì§ì ‘ ì‹¤í–‰ 
	@Query("select i from Item i where i.itemName like :itemName and i.price<= :price")
	List<Item> findItems(@Param("itemName") String itemName, @Param("price")Integer price); 
}
```

## (ì½”ë“œ) ìŠ¤í”„ë§ ë°ì´í„° JPA ì„¤ì •
build.gradle
```
//JPA, ìŠ¤í”„ë§ ë°ì´í„° JPA ì¶”ê°€ 
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
```

## (ì½”ë“œ) ìŠ¤í”„ë§ ë°ì´í„° JPA ì‚¬ìš©í•˜ê¸°
#### ğŸ“Œ SpringDataJpaItemRepository
=> JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¸í„°í˜ì´ìŠ¤ ìƒì† ë°›ìœ¼ë©´ ê¸°ë³¸ì ì¸ CRUD ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.
=> ê³µí†µìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì•„ë‹ˆë©´, ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ @Query ë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.
```java
public interface SpringDataJpaItemRepository extends JpaRepository<Item, Long> {

	List<Item> findByItemNameLike(String itemName); 
	
	List<Item> findByPriceLessThanEqual(Integer price);
	
	//ì¿¼ë¦¬ ë©”ì„œë“œ (ì•„ë˜ ë©”ì„œë“œì™€ ê°™ì€ ê¸°ëŠ¥ ìˆ˜í–‰) 
	List<Item> findByItemNameLikeAndPriceLessThanEqual(String itemName, Integer price);
	
	//ì¿¼ë¦¬ ì§ì ‘ ì‹¤í–‰ 
	@Query("select i from Item i where i.itemName like :itemName and i.price <= :price") 
	List<Item> findItems(@Param("itemName") String itemName, @Param("price") Integer price); 
}
```


#### ğŸ“Œ JpaItemRepositoryV2
```java
@Repository  
@Transactional  
@RequiredArgsConstructor  
public class JpaItemRepositoryV2 implements ItemRepository {  
  
    private final SpringDataJpaItemRepository repository;  
  
    @Override  
    public Item save(Item item) {  
        return repository.save(item);  
    }  


    @Override  
    public void update(Long itemId, ItemUpdateDto updateParam) {  
        Item findItem = repository.findById(itemId).orElseThrow();  
        findItem.setItemName(updateParam.getItemName());  
        findItem.setPrice(updateParam.getPrice());  
        findItem.setQuantity(updateParam.getQuantity());  
    }  


    @Override  
    public Optional<Item> findById(Long id) {  
        return repository.findById(id);  
    }  


    @Override  
    public List<Item> findAll(ItemSearchCond cond) {  
        String itemName = cond.getItemName();  
        Integer maxPrice = cond.getMaxPrice();  
  
        if (StringUtils.hasText(itemName) && maxPrice != null) {  
//            return repository.findByItemNameLikeAndPriceLessThanEqual("%" + itemName + "%", maxPrice);  
            return repository.findItems("%" + itemName + "%", maxPrice);  
        } else if (StringUtils.hasText(itemName)) {  
            return repository.findByItemNameLike("%" + itemName + "%");  
        } else if (maxPrice != null) {  
            return repository.findByPriceLessThanEqual(maxPrice);  
        } else {  
            return repository.findAll();  
        }  
    }  
}
```

- í´ë˜ìŠ¤ ì˜ì¡´ê´€ê³„ 
=>`SpringDataJpaItemRepository`ëŠ” DBì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ë¦¬í¬ì§€í† ë¦¬, `JpaItemRepositoryV2` ëŠ” ê°ì²´ì—ì„œ DBë¡œ ë„˜ì–´ê°€ê¸° ìœ„í•œ ì–´ëŒ‘í„° ì—­í• 
![[Pasted image 20230103195526.png]]