ë§í¬ : [[[ì¸í”„ëŸ°]ìŠ¤í”„ë§DB 1í¸.pdf]]
í•´ì‹œíƒœí¬ : #ì˜ˆì™¸

----

## ì˜ˆì™¸ ê°œë…ì¡ê¸°
#### ğŸ“Œì˜ˆì™¸ ê³„ì¸µ  
- ê·¸ë¦¼ìœ¼ë¡œ ë³´ê¸°
![[Pasted image 20221231161459.png]]
- Error  
	- ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì‹œìŠ¤í…œ ì˜ˆì™¸ì´ë‹¤. ì‹ ê²½ì“°ì§€ ë§ê¸°  
- Exception  
	- ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹¤ì§ˆì ì¸ ìµœìƒìœ„ ì˜ˆì™¸  
	- ê·¸ í•˜ìœ„ ì˜ˆì™¸ëŠ” ëª¨ë‘ ì»´íŒŒì¼ëŸ¬ê°€ ì²´í¬í•˜ëŠ” ì²´í¬ ì˜ˆì™¸ì´ë‹¤.  
	- ì˜ˆì™¸ì¸ ê²½ìš°  
		- RuntimeException  
		- illegalArgumentException

#### ğŸ“Œì˜ˆì™¸ ë‘ê°€ì§€ ê·œì¹™  
1) ì˜ˆì™¸ëŠ” **ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜ ë˜ì ¸ì•¼ í•œë‹¤.**  
- ì¡ëŠ” ê²½ìš°
![[Pasted image 20221231161649.png]]

- ë˜ì§€ëŠ” ê²½ìš°
![[Pasted image 20221231161659.png]]

2) ì˜ˆì™¸ë¥¼ ì¡ê±°ë‚˜ ë˜ì§ˆ ë•Œ ì§€ì •í•œ ì˜ˆì™¸ë¿ë§Œ ì•„ë‹ˆë¼ ê·¸ ì˜ˆì™¸ì˜ **ìì‹ë“¤ë„ í•¨ê»˜ ì²˜ë¦¬**ëœë‹¤.  


#### ğŸ“Œì˜ˆì™¸ë¥¼ ê³„ì† ë˜ì§€ë©´ ì–´ë–»ê²Œ ë ê¹Œ?  
- ìë°” main() ì“°ë ˆë“œì˜ ê²½ìš°, ì˜ˆì™¸ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ë©´ì„œ ì‹œìŠ¤í…œì´ ì¢…ë£Œëœë‹¤.  
- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê²½ìš°, **WASê°€ í•´ë‹¹ ì˜ˆì™¸ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬**í•˜ëŠ”ë°, ì£¼ë¡œ ì‚¬ìš©ìì—ê²Œ ê°œë°œìê°€ ì§€ì •í•œ, **ì˜¤ë¥˜ í˜ì´ì§€**ë¥¼ ë³´ì—¬ì¤€ë‹¤.  

## ì²´í¬ ì˜ˆì™¸
#### ğŸ“Œì²´í¬ì˜ˆì™¸ë€?
=> ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´, í•­ìƒ throws ì— ë˜ì§€ëŠ” ì˜ˆì™¸ë¥¼ ì„ ì–¸í•´ì•¼í•˜ëŠ” ë°©ë²•.

#### ğŸ“Œì²´í¬ ì˜ˆì™¸ì˜ ì¥ë‹¨ì ì€?
- ì¥ì   
	- ì˜ˆì™¸ë¥¼ ëˆ„ë½í•˜ì§€ ì•Šë„ë¡ ì»´íŒŒì¼ëŸ¬ë¥¼ í†µí•´ ë¬¸ì œë¥¼ ì¡ì•„ì£¼ëŠ” í›Œë¥­í•œ ì•ˆì „ ì¥ì¹˜  

- ë‹¨ì   
	- ë²ˆê±°ë¡œìš´ ì¼  
	- ì˜ì¡´ê´€ê³„ì— ë”°ë¥¸ ì˜ˆì™¸ì²˜ë¦¬ ìˆ˜ì •  

#### ğŸ“Œì²´í¬ ì˜ˆì™¸ëŠ” ì–¸ì œ ì‚¬ìš©í• ê¹Œ?
=> ì²´í¬ ì˜ˆì™¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìƒ ì˜ë„ì ìœ¼ë¡œ ë˜ì§€ëŠ” ì˜ˆì™¸ì—ë§Œ ì‚¬ìš© ex) ê³„ì¢Œ ì´ì²´ ì‹¤íŒ¨ ì˜ˆì™¸

#### ğŸ“Œì²´í¬ ì˜ˆì™¸ì˜ ë¬¸ì œì ì€?
1. ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸  
    - **ëŒ€ë¶€ë¶„ì˜ ì„œë¹„ìŠ¤ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ëŸ° ë¬¸ì œë“¤ì„ í•´ê²°í•  ìˆ˜ ì—†ì–´**ì„œ ì¼ê´€ì„± ìˆê²Œ ê³µí†µì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼í•¨.  
    - ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  ê°œë°œìê°€ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ ë¹ ë¥´ê²Œ ì¸ì§€í•˜ëŠ” ê²ƒì´ í•„ìš”í•˜ë‹¤.
![[Pasted image 20221231164456.png]]

2. ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œ  
    - JDBC ê¸°ìˆ ì´ ì•„ë‹Œ **ë‹¤ë¥¸ ê¸°ìˆ ë¡œ ë³€ê²½í•œë‹¤ë©´, ì˜¤ë¥˜ ë˜í•œ ë‹¤ ë°”ê¿”ì¤˜ì•¼í•¨.** 
![[Pasted image 20221231164558.png]]

#### ğŸ“Œ(ì½”ë“œ) ì²´í¬ ì˜ˆì™¸ ì²˜ë¦¬í•˜ê¸°
```java
@Slf4j  
public class CheckedTest {  
    @Test  
    void checked_catch() {  
        Service service = new Service();  
        service.callCatch();  
    }  
  
    @Test  
    void checked_throw() {  
        Service service = new Service();  
        assertThatThrownBy(() -> service.callThrow())  
                .isInstanceOf(MyCheckedException.class);  
    }  
  
    /**  
     * Exceptionì„ ìƒì†ë°›ì€ ì˜ˆì™¸ëŠ” ì²´í¬ ì˜ˆì™¸ê°€ ëœë‹¤.  
     */    
     static class MyCheckedException extends Exception {  
        public MyCheckedException(String message) {  
            super(message);  
        }  
    }  


    /**  
     * Checked ì˜ˆì™¸ëŠ” ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜, ë˜ì§€ê±°ë‚˜ ë‘˜ì¤‘ í•˜ë‚˜ë¥¼ í•„ìˆ˜ë¡œ ì„ íƒí•´ì•¼ í•œë‹¤.  
     */    
     static class Service {  
        Repository repository = new Repository();  
  
        /**  
         * ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ  
         */  
        public void callCatch() {  
            try {  
                repository.call();  
            } catch (MyCheckedException e) {  
                //ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§  
                log.info("ì˜ˆì™¸ ì²˜ë¦¬, message={}", e.getMessage(), e);  
            }  
        }  
  
        /**  
         * ì²´í¬ ì˜ˆì™¸ë¥¼ ë°–ìœ¼ë¡œ ë˜ì§€ëŠ” ì½”ë“œ  
         * ì²´í¬ ì˜ˆì™¸ëŠ” ì˜ˆì™¸ë¥¼ ì¡ì§€ ì•Šê³  ë°–ìœ¼ë¡œ ë˜ì§€ë ¤ë©´ throws ì˜ˆì™¸ë¥¼ ë©”ì„œë“œì— í•„ìˆ˜ë¡œ ì„ ì–¸í•´ì•¼í•œë‹¤.  
         * @throws MyCheckedException  
         */        
         public void callThrow() throws MyCheckedException {  
            repository.call();  
        }  
    }  
  
    static class Repository {  
        public void call() throws MyCheckedException {  
            throw new MyCheckedException("ex");  
        }  
    }  
  
}
```

- ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜ì€?  
![[Pasted image 20221231162138.png]]

- ì˜ˆì™¸ë¥¼ ê³„ì† ë˜ì ¸ì„œ ì²˜ë¦¬í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜ì€?
![[Pasted image 20221231162201.png]]


#### ğŸ“Œ IF ì²´í¬ ì˜ˆì™¸ì¸ë°, ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠëŠ”ë‹¤ë©´?  
- throws ë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë°œìƒ. 
- `Unhandled exception: hello.jdbc.exception.basic.CheckedTest.MyCheckedException`


## ì–¸ì²´í¬ ì˜ˆì™¸ 

#### ğŸ“Œì–¸ì²´í¬ ì˜ˆì™¸ë€?
=> ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ë„ throws ë¥¼ ìƒëµí•  ìˆ˜ ìˆë‹¤.  

- ì´ì „ ì²´í¬ ì˜ˆì™¸ì—ì„œ throws ë¶€ë¶„ ì—†ì–´ì§€ê³  ëŸ°íƒ€ì„ ì—ëŸ¬ë¡œ ë°”ë€œ  

#### ğŸ“Œì–¸ì²´í¬ ì˜ˆì™¸ì˜ ì¥ë‹¨ì   
- ì¥ì  : ì–¸ì²´í¬ ì˜ˆì™¸ë¥¼ ë¬´ì‹œí•  ìˆ˜ ìˆë‹¤  
- ë‹¨ì  : ê°œë°œìê°€ ì‹¤ìˆ˜ë¡œ ì˜ˆì™¸ë¥¼ ëˆ„ë½í•  ìˆ˜ ìˆë‹¤.  

#### ğŸ“Œì–¸ì²´í¬ ì˜ˆì™¸ëŠ” ì–¸ì œ ì‚¬ìš©í• ê¹Œ?
=> ê¸°ë³¸ì ìœ¼ë¡œ ì–¸ì²´í¬(ëŸ°íƒ€ì„) ì˜ˆì™¸ë¥¼ ì‚¬ìš©
![[Pasted image 20221231164730.png]]

#### ğŸ“ŒëŸ°íƒ€ì„ ì˜ˆì™¸ë¡œ ë°”ê¾¸ëŠ” ë°©ë²•ì€?
1) ì²´í¬ ì˜ˆì™¸ë¥¼ ëŸ°íƒ€ì„ ì˜ˆì™¸ë¡œ ë³€í™˜í•´ì„œ ì‚¬ìš©  
	- `SQLException` ì„ ëŸ°íƒ€ì„ ì˜ˆì™¸ì¸` RuntimeSQLException `ìœ¼ë¡œ ë³€í™˜  
```java
public void call() {   
    try {  
        runSQL();  
    }   
    catch (SQLException e) {   
        throw new RuntimeSQLException(e); //ëŸ°íƒ€ì„ ì˜ˆì™¸ë¡œ ë³€í™˜
    }   
}
```

2) ì²´í¬ ì˜ˆì™¸ ëŒ€ì‹  ê°™ì€ ê¸°ëŠ¥ì´ ìˆëŠ” ëŸ°íƒ€ì„ ì˜ˆì™¸ë¡œ ì‚¬ìš©  
	- ConnectException ëŒ€ì‹ ì— RuntimeConnectException ì„ ì‚¬ìš©  


#### ğŸ“ŒëŸ°íƒ€ì„ ì˜ˆì™¸ì‹œ ì§€ì¼œì•¼í•  ì‚¬í•­ ë‘ê°€ì§€ëŠ”?
1) ëŸ°íƒ€ì„ ì˜ˆì™¸ëŠ” ë¬¸ì„œí™”  
- ì˜ˆ) method() throws DataAccessException ì™€ ê°™ì´ ë¬¸ì„œí™” + ì½”ë“œì—ë„ ëª…ì‹œ
```java
/**  
 * Make an instance managed and persistent. * @param entity entity instance * @throws EntityExistsException if the entity already exists.  
 * @throws IllegalArgumentException if the instance is not an entity  
 * @throws TransactionRequiredException if there is no transaction when invoked on a container-managed entity manager of that is of type  
 */
 public void persist(Object entity);
```

2) ì˜ˆì™¸ë¥¼ ì „í™˜í•  ë•ŒëŠ” ê¼­! ê¸°ì¡´ ì˜ˆì™¸ë¥¼ í¬í•¨  
```java
public void call() {   
    try {  
        runSQL();  
    }   
    catch (SQLException e) {   
        throw new RuntimeSQLException(e); //ê¸°ì¡´ ì˜ˆì™¸(e) í¬í•¨  
    }   
}
```

- ì¶œë ¥
![[Pasted image 20221231165643.png]]

## ë°ì´í„° ì ‘ê·¼ ì˜ˆì™¸ ì§ì ‘ ë§Œë“¤ê¸°
#### ğŸ“Œì˜ˆì™¸ ì§ì ‘ ë§Œë“œëŠ” ì´ìœ ëŠ”?
íšŒì› ê°€ì…ì‹œ DBì— ì´ë¯¸ ê°™ì€ IDê°€ ìˆìœ¼ë©´ ì˜ˆì™¸ì²˜ë¦¬í•˜ê³  ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ID ë’¤ì— ìˆ«ìë¥¼ ë¶™ì—¬ì„œ ìƒˆë¡œìš´ IDë¥¼ ë§Œë“¤ê³  ì‹¶ì€ê²ƒ.

#### ğŸ“Œ(ì½”ë“œ) ì§ì ‘ì˜ˆì™¸ ë§Œë“¤ê¸°
```java
public class MyDuplicateKeyException extends MyDbException {  
    public MyDuplicateKeyException() {}  
    
    public MyDuplicateKeyException(String message) { super(message); }  
    
    public MyDuplicateKeyException(String message, Throwable cause) { super(message, cause); }  
    
    public MyDuplicateKeyException(Throwable cause) { super(cause); } 
}
```


#### ğŸ“Œì˜¤ë¥˜ ì½”ë“œ ì‚¬ìš©í•˜ë©´ ë¬¸ì œì ì€?
=> ê°™ì€ ì˜¤ë¥˜ì—¬ë„ ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ì •ì˜ëœ ì˜¤ë¥˜ ì½”ë“œê°€ ë‹¤ë¥´ë‹¤
(í‚¤ ì¤‘ë³µ ì˜¤ë¥˜ ì½”ë“œ H2 DB: 23505, MySQL: 1062)


#### ğŸ“Œ(ì½”ë“œ) SQL ì˜ˆì™¸ ë³€í™˜ê¸° ì‚¬ìš©í•˜ê¸°
```java
public class MemberRepositoryV4_2 implements MemberRepository {  

    private final DataSource dataSource;   
    
	private final SQLExceptionTranslator exTranslator;  //ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” SQL ë³€í™˜ ì¸í„°í˜ì´ìŠ¤

    public MemberRepositoryV4_2(DataSource dataSource) {   
        this.dataSource = dataSource;   
        //ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” SQL ë³€í™˜ êµ¬í˜„ì²´
        this.exTranslator = new SQLErrorCodeSQLExceptionTranslator(dataSource);  
    }

...
public Member save(Member member) {
	...
	try{
	...
	} catch (SQLException e) {
		throw exTranslator.translate("save", sql, e); //SQL ë³€í™˜ ì‚¬ìš©
	}
```

- `translate() `ë©”ì„œë“œì˜ ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” ì½ì„ ìˆ˜ ìˆëŠ” ì„¤ëª…ì´ê³ , ë‘ë²ˆì§¸ëŠ” ì‹¤í–‰í•œ sql, ë§ˆì§€ë§‰ì€ ë°œìƒëœ SQLException ì„ ì „ë‹¬í•˜ë©´ ëœë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì ì ˆí•œ ìŠ¤í”„ë§ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì˜ ì˜ˆì™¸ë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•´ì¤€ë‹¤.
- ì–´ë–»ê²Œ ê°ê°ì˜ DBê°€ ì œê³µí•˜ëŠ” SQL ErrorCodeê¹Œì§€ ê³ ë ¤í•´ì„œ ì˜ˆì™¸ë¥¼ ë³€í™˜í•  ìˆ˜ ìˆì„ê¹Œ?
	- sql-error-codes.xmlì— 