[연관관계 매핑 (tistory.com)](https://escapefromcoding.tistory.com/395#1.-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-em.flush-%EC%97%AC%EB%B6%80%EC%97%90-%EB%94%B0%EB%9D%BC%EC%84%9C-%EC%9D%98%EB%8F%84%EC%99%80-%EB%8B%A4%EB%A5%B8-%EA%B2%B0%EA%B3%BC%EA%B0%80-%EB%82%98%EC%98%AC-%EC%88%98-%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4.)

----
## 연관관계의 필요성한 이유는?
=> 객체지향 설계의 목표는 자율적인 객체들의 **협력 공통체**를 만드는 것임.객체를 테이블에 맞춰 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없는 한계점.


## 객체지향과 DB는 어떤점이 다를까?
출처 : [JPA, 객체지향과 RDB (tistory.com)](https://tang-co.tistory.com/106)

![[Pasted image 20230110172802.png]]
1) DB에는 **객체**가 존재하지 않음. 그래서 상속, 객체 간 참조 발생 시 저장이 어려움.
2) **연관관계**의 차이점. 객채는 참조사용, 테이블은 왜래키 사용함
3) 객체는 자유롭게 그래프 **탐색** 가능함.


## 연관관계 매핑시 고려해야될 3가지는?
1) **방향** : 객체관계에만 방향이 존재하고, 테이블은 항상 양방향관계이다.
2) **다중성** : 다대일, 일대일.. 연관관계를 어떻게 맺을것인지 고려해야함.
3) **연관관계주인** : 연관관계의 주인을 정해야함.


## 연관관계 기본개념
1. 1:N 혹은 N:1 관계에서 **외래키는 항상 N쪽**에 있다.(외래키의 주인은 N이다.)
2. 1:1 관계에서 외래키의 위치는 설계에 따라 달라진다.


## 단방향
▶ Member -> Team
Member는 Team을 조회할 수 있지만, Team은 Member를 조회할 수 없음.
![[Pasted image 20231121165239.png]]

```java
@Entity  
public class Member {  
  
    @Id @GeneratedValue  
    @Column(name = "member_id")  
    private Long id;  
  
    private String username;  
  
    @ManyToOne  
    @JoinColumn(name = "team_id")  
    private Team team;  
  
}

@Entity  
public class Order {  
  
    @Id @GeneratedValue  
    @Column(name = "team_id")  
    private Long id;  
  
    private String name;
}
```



## 양방향
![[Pasted image 20231121165247.png]]

```java
@Entity  
public class Member {  
  
    @Id @GeneratedValue  
    @Column(name = "member_id")  
    private Long id;  
  
    private String username;  
  
    @ManyToOne  
    @JoinColumn(name = "team_id")  
    private Team team;  
    
}  
  
@Entity  
public class Team {  
  
    @Id @GeneratedValue  
    @Column(name = "team_id")    
    private Long id;  
      
    private String name;    
    
    @OneToMany(mappedBy = "member")  
    private List<Member> members = new ArrayList()<>
}
```


## mappedBy속성은 왜 필요할까요?
[JPA 연관관계 맵핑 – 민동현 – Dream Cometrue (donghyeon.dev)](https://donghyeon.dev/jpa/2020/01/31/JPA-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91/)
[[JPA] - @JoinColumn과 연관관계의 주인 (mappedBy)](https://ttl-blog.tistory.com/126#%40JoinColumn-1)
[JPA 05.02 - 양방향 연관관계와 연관관계의 주인 (tistory.com)](https://delusidiot.tistory.com/entry/JPA-0502-%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%99%80-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%EC%9D%98-%EC%A3%BC%EC%9D%B8)

![[Pasted image 20231121173054.png]]
데이터베이스 테이블은 외래 키 하나로 양쪽이 서로 조인할 수 있습니다.

반면에 객체에는 양방향 연관관계라는 것은 없습니다. 서로 다른 단방향 연관관계 2개를 로직으로 잘 묶어서 양방향으로 보이게 할 뿐입니다. 그래서 이 연관관계 외래키를 관리하는 포인트가 2군데로 늘어 나게 됩니다.

그래서 한쪽에 두고 사용해야 하기 때문에 **두 연관관계 중 하나를 정해서 테이블의 외래키를 관리**해야 하는데, 이것을 연관관계 주인이라고 합니다.

연관관계 **주인만이 데이터베이스 연관관계와 매핑되고, 외래키를 관리(등록,수정,삭제**)할 수 있습니다. 반면에 주인이 아닌 쪽은 **읽기**만 할 수 있습니다.

- 연관관계 주인은 mappedBy 속성을 사용하지 않는다.
- 주인이 아니면 mappedBy 속성을 사용해서 속성의 값으로 연관관계의 주인을 지정해야한다.


## 누가 연관관계 주인이 될래?
**연관관계의 주인은 외래 키가 있는 곳**으로 정합니다. **주인이 아닌 쪽은 mappedBy 속성으로 사용해서 주인이 아님을 설정**합니다.


## 연관관계 매핑 어노테이션
#### @JoinColumn
`@JoinColumn`은 외래키를 매핑할 때 사용한다.  

![[Pasted image 20231121180915.png]]


#### @ManyToOne
`@ManyToOne`은 다대일 관계에서 사용한다.  
![[Pasted image 20231121180938.png]]