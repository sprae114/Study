#μ¤ν”„λ§λ°μ΄ν„°JPA

#μΈν”„λ°μ¤ν”„λ§DB2νΈ06

----
## μ¤ν”„λ§ λ°μ΄ν„° JPAλ€?
=> JPAλ¥Ό νΈλ¦¬ν•κ² μ‚¬μ©ν•  μ μλ„λ΅ λ„μ™€μ£Όλ” λΌμ΄λΈλ¬λ¦¬

## JpaRepository κΈ°λ¥μ€?
#### κ³µν†µ μΈν„°νμ΄μ¤ κΈ°λ¥
- JpaRepository μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄μ„ **κΈ°λ³Έμ μΈ CRUD κΈ°λ¥ μ κ³µ**ν•λ‹¤
- JpaRepository μΈν„°νμ΄μ¤λ¥Ό μΈν„°νμ΄μ¤ μƒμ† λ°›κ³ , μ λ„¤λ¦­μ— κ΄€λ¦¬ν•  <μ—”ν‹°ν‹°, μ—”ν‹°ν‹°ID> λ¥Ό μ£Όλ©΄ λλ‹¤.
```java
public interface ItemRepository extends JpaRepository<Member, Long> {}
```

![[Pasted image 20230103164852.png]]
![[Pasted image 20230103175901.png]]

#### μΏΌλ¦¬ λ©”μ„λ“ κΈ°λ¥
=> JPAλ” μΈν„°νμ΄μ¤μ— λ©”μ„λ“λ§ μ μ–΄λ‘λ©΄, λ©”μ„λ“ **μ΄λ¦„μ„ λ¶„μ„ν•΄μ„ μΏΌλ¦¬λ¥Ό μλ™μΌλ΅ λ§λ“¤κ³  μ‹¤ν–‰**ν•΄μ£Όλ” κΈ°λ¥μ„ μ κ³µν•¨.

β–¶ κΈ°μ΅΄μ μ‚¬μ©ν–λ μμ JPA λ¦¬ν¬μ§€ν† λ¦¬ (SQL μ§μ ‘ μ‘μ„±ν•΄μ•Ό ν•¨.)
```java
public List<Member> findByUsernameAndAgeGreaterThan(String username, int age) { 
	return em.createQuery("select m from Member m where m.username = :username and m.age > :age")
		.setParameter("username", username) 
		.setParameter("age", age) 
		.getResultList();
}
```

β–¶ μ¤ν”„λ§ λ°μ΄ν„° JPA (μΏΌλ¦¬ μλ™ μƒμ„±)
```java
public interface MemberRepository extends JpaRepository<Member, Long> { 
	List<Member> findByUsernameAndAgeGreaterThan(String username, int age);
}
```

```sql
select i from User i where i.UserName = ? and i.Age >= ?
```


#### JPQL μ§μ ‘ μ‚¬μ©ν•κΈ°
μΏΌλ¦¬κ°€ λ³µμ΅ν• κ²½μ°, `@Query`λ¥Ό μ‚¬μ©ν•΄μ„ JPQLμ„ ν†µν•΄ μ§μ ‘ μΏΌλ¦¬ μ‘μ„±ν•  μ μλ‹¤.
```java
public interface SpringDataJpaItemRepository extends JpaRepository<Item, Long> {
	//μΏΌλ¦¬ λ©”μ„λ“ κΈ°λ¥ 
	List<Item> findByItemNameLike(String itemName);
	
	//μΏΌλ¦¬ μ§μ ‘ μ‹¤ν–‰ 
	@Query("select i from Item i where i.itemName like :itemName and i.price<= :price")
	List<Item> findItems(@Param("itemName") String itemName, @Param("price")Integer price); 
}
```


## (μ½”λ“) μ¤ν”„λ§ λ°μ΄ν„° JPA κµ¬ν„μ²΄
#### π“ SpringDataJpaItemRepository
=> JpaRepository μΈν„°νμ΄μ¤λ¥Ό μΈν„°νμ΄μ¤ μƒμ† λ°›μΌλ©΄ κΈ°λ³Έμ μΈ CRUD κΈ°λ¥μ„ μ‚¬μ©ν•  μ μμ.
=> κ³µν†µμΌλ΅ μ κ³µν•  μ μλ” κΈ°λ¥μ΄ μ•„λ‹λ©΄, μΏΌλ¦¬ λ©”μ„λ“ κΈ°λ¥μ„ μ‚¬μ©ν•κ±°λ‚ @Query λ¥Ό μ‚¬μ©ν•΄μ„ μ§μ ‘ μΏΌλ¦¬λ¥Ό μ‹¤ν–‰ν•λ©΄ λλ‹¤.
```java
public interface SpringDataJpaItemRepository extends JpaRepository<Item, Long> {

	List<Item> findByItemNameLike(String itemName); 
	
	List<Item> findByPriceLessThanEqual(Integer price);
	
	//μΏΌλ¦¬ λ©”μ„λ“ (μ•„λ λ©”μ„λ“μ™€ κ°™μ€ κΈ°λ¥ μν–‰) 
	List<Item> findByItemNameLikeAndPriceLessThanEqual(String itemName, Integer price);
	
	//μΏΌλ¦¬ μ§μ ‘ μ‹¤ν–‰ 
	@Query("select i from Item i where i.itemName like :itemName and i.price <= :price") 
	List<Item> findItems(@Param("itemName") String itemName, @Param("price") Integer price); 
}
```


- ν΄λμ¤ μμ΅΄κ΄€κ³„ 
=>`SpringDataJpaItemRepository`λ” DBμ— λ°μ΄ν„°λ¥Ό μ €μ¥ν•κΈ° μ„ν• λ¦¬ν¬μ§€ν† λ¦¬, `JpaItemRepositoryV2` λ” κ°μ²΄μ—μ„ DBλ΅ λ„μ–΄κ°€κΈ° μ„ν• μ–΄λ‘ν„° μ—­ν• 
![[Pasted image 20230103195526.png]]