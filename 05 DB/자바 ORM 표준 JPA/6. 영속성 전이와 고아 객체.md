ë§í¬ : [[ìë°” orm í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°.pdf]]
í•´ì‹œíƒœí¬ : #ì˜ì†ì„±ì „ì´, #ê³ ì•„ê°ì²´

----

#### ğŸ“Œ ì˜ì†ì„± ì „ì´ + ê³ ì•„ ê°ì²´ì˜ ìƒëª…ì£¼ê¸°ëŠ”?
=> Â **ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ í†µí•´ì„œ ìì‹ì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬ê°€ ê°€ëŠ¥**í•˜ë‹¤.


## ì˜ì†ì„± ì „ì´
#### ğŸ“Œ ì˜ì†ì„± ì „ì´ê°€ í•„ìš”í•œ ì´ìœ ëŠ”?
=> íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ ìˆ˜ ìˆì—ˆë‹¤. ê·¸ëŸ¬ë©´, ì—°ê´€ëœ ì—”í‹°í‹°(ex ë¶€ëª¨ ì—”í‹°í‹°)ë„ í•¨ê»˜ ì˜ì†ìƒíƒœë¡œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

#### ğŸ“Œ ì˜ì†ì„± ì „ì´ë€?
=> ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ í†µí•´ì„œ **ìì‹ì˜ ìƒëª…ì£¼ê¸°ê°€ ê´€ë¦¬**ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸

#### ğŸ“Œ (ì½”ë“œ) ì˜ì†ì„± ì „ì´ ì‚¬ìš©ì „
- parent, child
```kotlin
// parent
@Entity
public class Parent {

    @Id @GeneratedValue
    private Long id;

    private String name;

    @OneToMany(mappedBy = "parent")
    private List<Child> childList = new ArrayList<>();
}

// child
@Entity
public class Child {

    @Id @GeneratedValue
    private Long id;

    private String name;

    @ManyToOne
    @JoinColumn(name = "parent_id")
    private Parent parent;
}
```


- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```java
Child child1 = new Child();
Child child2 = new Child();
Parent parent = new Parent();
// ë¶€ëª¨ì—ê²Œ ìì‹ì„ ë“±ë¡
parent.addChild(child1);
parent.addChild(child2);

em.persist(parent);
em.persist(child1);
em.persist(child2);// persistë¥¼ 3ë²ˆì´ë‚˜ í•´ì•¼í•œë‹¤.
```
=> Â persistë¥¼ 3ë²ˆì´ë‚˜ í˜¸ì¶œí•˜ë©´ì„œ ë“±ë¡í•˜ëŠ” ì½”ë“œëŠ” ë§¤ìš° ë¶ˆí¸í•˜ë‹¤. ì´ë¥¼ ì˜ì†ì„± ì „ì´ë¥¼ í†µí•´ í•´ê²°í•˜ì

#### ğŸ“Œ (ì½”ë“œ) ì˜ì†ì„± ì „ì´ ì‚¬ìš©í›„
- ê·¸ë¦¼
![[Pasted image 20230117173723.png]]

- í´ë˜ìŠ¤ êµ¬ì„±
```java
@Entity
public class Parent{

	@OneToMany(mappedBy = "parent", cascade = CascadeType.ALL) //ì˜ì†ì„± ì „ì´ ì†ì„±(CASCADE)ì‚¬ìš©
	private List<Child> childList = new ArrayList<>();

	public void addChild(Child child){
		childList.add(child);
		child.setParent(this);
	}
	...
}
```
=> `cascade = CascadeType.ALL` : Â parentë¥¼ ì˜ì†í™” í•˜ë©´ ë‚˜ë¨¸ì§€ 2ëª…ì˜ ìì‹ë„ í•¨ê»˜ ì˜ì†í™” ë˜ë„ë¡ í•¨.

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```java
Child child1 = new Child();
Child child2 = new Child();
Parent parent = new Parent();

parent.addChild(child1);
parent.addChild(child2);

em.persist(parent); // ë¶€ëª¨ë§Œ ì˜ì†í™”
```

- ê²°ê³¼
![[Pasted image 20230117173707.png]]

#### ğŸ“Œ ì£¼ì˜ì 
1) Parentì™€ childì˜ **ìƒëª…ì£¼ê¸°ê°€ ê±°ì˜ ê°™ì„ë•Œ ì‚¬ìš©**í•œë‹¤.
2) **ë‹¨ì¼ ì†Œìœ ì**(Parentë¼ëŠ” ì—”í‹°í‹°ë§Œì´ Childë¥¼ ì†Œìœ í•œ ìœ ì¼í•œ ì†Œìœ ìì¼ë•Œ)ì—ë§Œ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤.


## ê³ ì•„ ê°ì²´
#### ğŸ“Œ ê³ ì•„ ê°ì²´ë€?
=> ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§„ **ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œ**í•œë‹¤.

#### ğŸ“Œ (ì½”ë“œ) ê³ ì•„ ê°ì²´ ì‚¬ìš©
- í´ë˜ìŠ¤ êµ¬ì„±
```java
@Entity
public class Parent{

    @Id @GeneratedValue
    private Long id;

    private String name;

	@OneToMany(mappedBy = "parent", cascade = CascadeType.ALL, orphanRemoval = true) // ì¶”ê°€
	private List<Child> childList = new ArrayList<>();

	public void addChild(Child child){
		childList.add(child);
		child.setParent(this);
	}
	...
}
```
=> `orphanRemoval = true` : ê³ ì•„ê°ì²´ ì†ì„± ì¶”ê°€

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
findParentì—ì„œ ChildListë¥¼ ì–»ì€ í›„, 0ë²ˆ ê°ì²´ë¥¼ ì‚­ì œí•˜ëŠ” ë‚´ìš©
```java
Child child1 = new Child();
Child child2 = new Child();

Parent parent = new Parent();
parent.addChild(child1);
parent.addChild(child2);

em.persist(parent); // parentë§Œ persistí•´ë„ childë„ ê°™ì´ persistëœë‹¤

em.flush();
em.clear();

Parent findParent = em.find(Parent.class, parent.getId());
findParent.getChildList().remove(0); // ê³ ì•„ê°ì²´ 

transaction.commit();
```
=> 0ë²ˆ ìì‹ì„ Parentì˜ ì»¬ë ‰ì…˜ì—ì„œ ì œê±°í–ˆê¸° ë•Œë¬¸ì—(ë¶€ëª¨ì™€ì˜ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§)Â **0ë²ˆ ìì‹ì€ ìë™ ì‚­ì œ**ëŒ

- ì‹¤í–‰ëœ SQL
![[Pasted image 20230117175151.png]]


#### ğŸ“Œ ì£¼ì˜ì 
1) ì°¸ì¡°í•˜ëŠ” ê³³ì´ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•´ì•¼ í•¨.
2) @OneToOne, @OneToManyë§Œ ì‚¬ìš© ê°€ëŠ¥í•¨.