#여러EC2

#AWS로시작하는인프라구축의정석 , #아마존웹서비스AWS

----

# 이론 
## 전체 매커니즘
1) 가상 네트워크 : 관리자가 자유롭게 다양한 서버를 구축할 수 있는 네트워크 설정
VPC, 서브넷, NAT 게이트웨이, 라우팅테이블, 보안그룹, ... 등을 설정해야함.
![image](https://github.com/sprae114/Study/assets/52237184/39f0ff01-b162-4d6e-914f-b27ac0d1a8ba)

2) 

## VPC
#### 네트워크란?
**인프라스트럭처(=인프라, 기반시설) 관리자가 주체가 되어 관리**하는 장소임. 네트워크 내의 기기는 LAN을 통해서 자유롭게 통신할 수 있음.
![image](https://github.com/sprae114/Study/assets/52237184/0a4f177e-632b-4703-bff4-976ec89eb8bc)


#### VPC이란?
AWS의 데이터센터에 있는 전용기기에서 서버나 네트워크 장비를 작동시켜, **클라우드 환경에서 제공되는 가상 사설 네트워크 서비스**이다. VPC끼리는 독립적으로 실행됌.
![image](https://github.com/sprae114/Study/assets/52237184/a66622b1-3aff-43ee-94cf-1538c1fc35cc)

#### VPC를 사용하는 이유는?
 ![[Pasted image 20221123173403.png]]
VPC가 없다면 EC2 인스턴스들이 서로 거미줄처럼 연결되고 인터넷과 연결됌. 이렇게 되면 인스턴스 변경에 불편함 생김.

 ![[Pasted image 20221123173527.png]]
VPC를 적용하면 위 그림과같이 **VPC별로 네트워크를 구성**할 수 있고 각각의 VPC에따라 다르게 네트워크 설정을 줄 수 있습니다.


## 서브넷
#### 서브넷이란?
VPC의 **IP주소 범위를 나누는 단위**로, VPC안에는 하나 이상의 서브넷을 만들어야함.


#### 서브넷을 사용하는 이유는?
1. 네트워크 관리의 편의성
서브넷을 사용하면 큰 네트워크를 여러 개의 작은 네트워크로 분할할 수 있습니다. 이렇게 하면 네트워크를 더욱 쉽게 관리할 수 있습니다.

2. 보안 강화
서브넷을 사용하면 네트워크의 보안을 강화할 수 있습니다. 서브넷을 통해 각 네트워크를 물리적 또는 논리적으로 분리함으로써, 각 네트워크를 독립적으로 보호할 수 있습니다. 예를 들어, 중요한 데이터를 처리하는 서버는 별도의 서브넷에 배치하여 외부로부터의 접근을 제한할 수 있습니다.

3. 효율적인 IP 주소 관리
서브넷을 사용하면 IP 주소를 효율적으로 관리할 수 있습니다. 서브넷을 통해 IP 주소를 그룹화하고 할당하면, IP 주소의 낭비를 줄이고, IP 주소의 관리를 효율적으로 수행할 수 있습니다.


#### 서브넷 종류는?
![image](https://github.com/sprae114/Study/assets/52237184/6bea6eb3-fcf5-4127-a922-df740bf33edb)
1. Public 서브넷
Public 서브넷의 인스턴스는 인터넷 게이트웨이를 통해 **인터넷에 직접 연결**될 수 있습니다. 이를 가능하게 하려면 인스턴스에 공용 IP 주소(예: Elastic IP)가 할당되어야 합니다. 또한, 라우팅 테이블에 인터넷 게이트웨이를 지정해야 합니다. 
일반적으로 **웹 서버, 애플리케이션 서버**와 같이 외부와 통신이 필요한 시스템을 배치합니다.

2. Private 서브넷
Private 서브넷의 인스턴스는 **인터넷에 직접 연결되지 않습**니다. 이들 인스턴스는 NAT 게이트웨이 또는 NAT 인스턴스를 통해 인터넷에 액세스할 수 있지만, 인터넷에서 이들 인스턴스를 직접 액세스할 수는 없습니다. 
일반적으로 보안이 중요한 데이터를 처리하는 **데이터베이스, 백엔드 서버** 등..을 배치합니다.


#### 가용영역이란?
클라우드 컴퓨팅에서 특정 지역 내에서 **독립적으로 운영되는 데이터 센터**를 의미합니다.

각 가용 영역은 독립적인 전원, 쿨링 시스템, 네트워크를 가지며, 다른 가용 영역과는 **물리적으로 분리**되어 있습니다.
![image](https://github.com/sprae114/Study/assets/52237184/5043d173-dbd1-4b77-83a0-84c69a4df22b)


## 게이트웨이
#### 인터넷 게이트웨이란?
인터넷 게이트웨이는 **VPC와 인터넷 간의 통신을 가능하게 하는 라우팅 역할**을 하는 AWS 구성 요소입니다. 이를 통해 VPC 내의 인스턴스가 인터넷에 접근하도록 하거나, 인터넷에서 직접 접근 가능한 인스턴스로 트래픽을 라우팅할 수 있습니다.
![image](https://github.com/sprae114/Study/assets/52237184/6bea6eb3-fcf5-4127-a922-df740bf33edb)


#### NAT 게이트웨이란?
**사설 IP 주소와 공인 IP 주소 간의 변환을 수행하는 네트워크 기술**입니다. 프라이빗 서브넷에 생성된 리소스는 인터넷으로 내보낼 수는 있지만 인터넷에 접근할 수 없어야함. 이를 위해 NAT 게이트웨이가 등장함. 퍼블릭 서브넷에 생성함.
![image](https://github.com/sprae114/Study/assets/52237184/92efbafa-30d0-44fa-a63d-a75d7c622819)

![image](https://github.com/sprae114/Study/assets/52237184/b0e17f34-c26b-468d-a6c2-01226fedcbe7)

![image](https://github.com/sprae114/Study/assets/52237184/3385094f-85bf-4249-9cfd-0f52e6cacf5d)


## 라우팅 테이블
#### 라우팅 테이블이란?
네트워크 트래픽이 어디로 가야 하는지 결정하는 규칙을 담고 있는 테이블입니다. 라우팅 테이블에는 목적지 IP 주소 범위(라우트)와 이 트래픽을 처리할 대상(예: 인터넷 게이트웨이, NAT 게이트웨이, VPC 피어링 등)이 포함되어 있습니다. 각 서브넷은 하나 이상의 라우팅 테이블에 연결되어 있으며, 이를 통해 네트워크 트래픽의 흐름을 제어합니다.

**서브넷과 각각 게이트 웨이 또는 서브넷과 서브넷이 통신 할 수 있는 경로**를 만들어야함.
![image](https://github.com/sprae114/Study/assets/52237184/45fcd322-23f2-4a6b-b79a-ec13d48885a0)

**통신 경로를 설정하기 위해** 라우팅 테이블을 사용함.
![[Pasted image 20230705165300.png]]
- 송신 대상지 : 접속 대상의 위치
- 타깃 : 경우지
![image](https://github.com/sprae114/Study/assets/52237184/f5644843-11f9-4246-a30c-79e50f93e07b)


## 보안그룹
#### 보안 그룹이란?
인터넷을 통해 모든 리소스에 접근하는 문제점이 생김. **VPC 안의 리소스를 보호하기 위해 외부로부터 접근을 제한**하는 보안 그룹을 설정해야함.

![image](https://github.com/sprae114/Study/assets/52237184/32abae85-18bd-423a-b4ee-ddbe6c2dd007)


#### 보안 그룹이 제어하는 2가지 방법은?
1) 포트 번호
포트 번호로 서비스 종류 지정함. EX) HTTP(80번), HTTPS(443번), SSH(22번)

2) IP 주소
회사나 학교 조직 내에서 네트워크를 작업할 경우 IP주소를 한정할 수 있음. (IP 주소가 변하지 않으니깐)


#### 보안그룹을 왜 두개나 설정할까?
- **점프서버** : 모든 리소스에 접속하는 입구로, 주로 관리자 접근용으로 사용되는 중간 서버임. 외부에서 직접적으로 접근하지 못하도록 막은 내부 인스턴스에 접근하기 위한 보안 채널을 제공함. **내부 인스턴스에 SSH 또는 RDP를 사용하여 접속하기 위해**서는 점프 서버를 거치도록 되어 있음.
- **로드 밸린서** : **요청이나 처리를 분산하는 역할**로, 사용자 트래픽을 여러 인스턴스로 분산하여 예기치 않은 장애 및 서버 부하를 줄임.


#### 네트워크 ACL과 보안 그룹 차이는?
- 공통점 : **접근 제한을 수행**하기 위한 시스템
- 보안 그룹 : **리소스**(EC2, 로드 밸린서, RDS 등)에 대해 설정 가능
- 네트워크 ACL : **네트워크에 대한 설정**. 즉, 해당 서브넷에 포함되는 리소스 모두에 적용

![image](https://github.com/sprae114/Study/assets/52237184/b2f19bd7-946b-4871-93d1-e819100a89f0)


## 로드밸론싱



# 실습
## 가상네트워크 설정
#### VPC 설정
![image](https://github.com/sprae114/Study/assets/52237184/3cc864e8-2aac-4e7f-99ea-975a969b9fd8)


#### 서브넷 생성 설정
![image](https://github.com/sprae114/Study/assets/52237184/54405164-174c-4907-abeb-c56bb3e35fc3)

![image](https://github.com/sprae114/Study/assets/52237184/49470de6-28a6-4482-af58-2ef7813d4772)


####  NAT 게이트웨이 생성 내용
![image](https://github.com/sprae114/Study/assets/52237184/882b7545-56ae-45af-951e-6532e16f1f5b)


#### 라우팅 테이블 설정
![image](https://github.com/sprae114/Study/assets/52237184/fc0a5a4c-22a2-424e-b885-8fd65226a48e)

![image](https://github.com/sprae114/Study/assets/52237184/d81af3bc-0311-411d-9a7a-b315ff63c60a)

![image](https://github.com/sprae114/Study/assets/52237184/4509e93a-f136-478f-a381-7c364317fb1d)


#### 보안 그룹 설정
![[Pasted image 20230705193055.png]]

