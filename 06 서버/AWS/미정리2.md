# 4장 독립적인 나만의 가상 네트워크 공간 만들기
## 사전지식
### 우테코
- [02:29](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=149.07889695708465) : VPC
- ![[Pasted image 20221123163851.png]]

- [02:56](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=176.05954234618378) : Subnet
- ![[Pasted image 20221123163913.png]]

- [03:06](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=186.85011711730195) : 인터넷 트래픽이 EC2에 도달하는 과정
- ![[Pasted image 20221123164030.png]]

- [04:56](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=296.06287911444093) : NACL과 보안그룹의 차이는?
- ![[Pasted image 20221123164133.png]]

- [05:20](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=320.8134960200272) : VPC, 서브넷에 IP를 할당하는 방법
- ![[Pasted image 20221123164236.png]]

- [06:06](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=366.21063681403353) : ACL, 보안그룹 설명
- ![[Pasted image 20221123164335.png]]

- [07:05](https://www.youtube.com/watch?v=tkP5u_SrF-8&t#t=425.115948123024) : NAT Gateway
Private Subnet은 외부에서 접근하지 못하는 데이터베이스로 사용함. 그래서 인터넷이 연결 안되서 여러 설치파일을 다운받지 못하는 문제점 생김.
NAT Gatway은 **Publice 다운받고 private로 전달해주는 역할**을함
- ![[Pasted image 20221123165449.png]]

### 가장쉽게 VPC 개념잡기
#### 📌VPN
- ![[Pasted image 20221123173218.png]]
그림과같이 회사의 네트워크가 구성되어있고 보안상의 이유로 직원간 물리적으로 네트워크를 분리하고싶다면 기존 인터넷선 선공사도 다시해야함.

- ![[Pasted image 20221123173325.png]]
하지만 VPN은 네트워크A와 네트워크B가 실제로 같은 네트워크상에 있지만 논리적으로 다른네트워크인것처럼 동작함.



#### ✔VPC를 구축하는 과정
1) VPC의 아이피범위를 RFC1918이라는 **Private IP대역에 맞추어 구축**해야함. (Private IP 할당)
- Private IP이란? 인터넷을 위해 사용하는것이 아닌 우리끼리 사용하는 아이피주소 대역
- ![[Pasted image 20221123173746.png]]

2) 서브넷 만들기
- 서브넷이란? **VPC를 잘개 쪼개는 과정**을 통해 더 많은 네트워크망을 만들기 위함.
- ![[Pasted image 20221123174211.png]]
❓서브넷을 사용하는 이유는 뭐지?
**도메인의 크기를 줄이기** 위함. 만약 단일 네트워크에 부여했다면, 과다한 호스트 컴퓨터의 수로 인해 네트워크 트래픽이 증가할 것이다.

3) 라우팅 테이블과 라우터
- 네트워크 요청이 발생하면 데이터는 우선 라우터로 향하게됩니다. 
- 라우터란 목적지이고 라우팅테이블은 각 목적지에 대한 이정표
- 데이터는 라우터로 향하게되며 네트워크 요청은 각각 정의된 라우팅테이블에따라 작동함.
- if) 범위 밖에 네트워크 요청이 온다면, 처리할수 없음
- ![[Pasted image 20221123175726.png]]

✔ 라우터란
- 패킷을 목적지까지 전달하기 위해 다음 네트워크 지점을 결정하는 장치나 컴퓨터 내의 소프트웨어
출처 :[[ Network ] 라우터( Router )란 (tistory.com)](https://chunggaeguri.tistory.com/entry/Network-%EB%9D%BC%EC%9A%B0%ED%84%B0-Router-%EB%9E%80)


4) 인터넷게이트웨이
- 인터넷게이트웨이란? VPC와 인터넷을 연결해주는 하나의 관문
- 서브넷B의 라우팅테이블을 잘보면 0.0.0.0/0으로 정의되어있습니다. 이뜻은 모든 트래픽에 대하여 IGA(인터넷 게이트웨이) A로 향하라는뜻
- ![[Pasted image 20221123180246.png]]

5) 네트워크 ACL과 보안그룹
- 네트워크 ACL과 보안그룹은 방화벽과 같은 역할을 하며 인바운드 트래픽과 아웃바운드 트래픽 보안정책을 설정
- 보안그룹이란? Stateful한 방식으로 동작하는 보안그룹은 모든 허용을 차단하도록 기본설정 되어있으며 필요한 설정은 허용
-  네트워크ACL이란? 각각의 보안그룹별로도 별도의 트래픽을 설정할 수 있으며 서브넷에도 설정할 수 있지만 각각의 EC2인스턴스에도 적용.
- ![[Pasted image 20221123180401.png]]

6) NAT 게이트웨이
- NAT 게이트웨이란? 프라이빗서브넷이 인터넷과 통신하기위한 아웃바운드 인스턴스
- 프라이빗 네트워크가 외부에서 요청되는 인바운드는 필요없더라도 인스턴스의 펌웨어나 혹은 주기적인 업데이트가 필요하여 아웃바운드 트래픽만 허용되야할 경우사용함.
- ![[Pasted image 20221123183143.png]]

출처 : [[AWS] 가장쉽게 VPC 개념잡기. 가장쉽게 VPC 알아보기 | by Harry The Great | 해리의 유목코딩 | Medium](https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098)

## 용어정리
#### 📌Network
- 네트워킹한다 = 서로 통신을 한다

- 프로토콜이란?
통신을 위해 지켜야하는 약속

#### ✔VPN(Virtual Private Network)
- 컴퓨터을 연결하는 사설 네트워크를 만들거나, 원격으로 네트워크를 연결하고 암호화 기술을 적용하여 안정적이고, 보완성 높은 통신 서비스를 제공하는 서비스
- ![[Pasted image 20221123160154.png]]
- VPC와 VPC Gateway를 통해 On-Premise의 VPN장비와 VPN을 연결할 수 있음.


## VPC(Virtual Private Cloud)
#### ✔VPC란?
클라우드에서 논리적으로 격리된 네트워크 공간을 할당하여 가상 네트워크에서 AWS 리소스를 이용할 수 있는 서비스를 제공함.
- ![[Pasted image 20221123162348.png]]
- ![[Pasted image 20221123165959.png]]

#### ✔Private IP, Publice IP, Elastic IP
- Private IP : 인터넷을 통해 연결할 수 없는, VPC 내부에서만 사용하는 주소
- Publice IP : 인턴스와 인터넷 통신을 위해 사용. 인스턴스가 재부팅되면 새로운 Publice IP 할당함.
- Elastic IP : 동적 컴퓨팅을 위해 Elastic IP사용함. 그래서 다른 인스턴스 주소를 매칭하여 인스턴스 장애 조치를 할수 있음.

#### 📌VPC와 서브넷
- 가장쉽게 VPC 개념잡기로 이해하기

#### 📌서브넷 사이즈
- CIDR이란? VPC에서 사용하게 될 IP 주소의 지정하는 범위

추가 : [[NW] 🌐 CIDR 이 무얼 말하는거야? ⇛ 개념 정리 & 계산법 (tistory.com)](https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-CIDR-%EC%9D%B4-%EB%AC%B4%EC%96%BC-%EB%A7%90%ED%95%98%EB%8A%94%EA%B1%B0%EC%95%BC-%E2%87%9B-%EA%B0%9C%EB%85%90-%EC%A0%95%EB%A6%AC-%EA%B3%84%EC%82%B0%EB%B2%95)



#### 📌라우팅테이블
- 아웃바운드(서브넷 외부로 나가는 것) 트래픽에 대해 허용된 경로를 지정로 나침반과 비슷한 역할

## 주요 서비스
#### ✔보안 그룹과 네트워크 액세스 제어(ACL) 목록
- 왜 사용하는 거지? 네트워크 통신과 트래픽에 대해 IP와 Port를 기준으로 통신을 허용하거나 차단하기 위한 기능을 제공
- ![[Pasted image 20221123210936.png]]

#### 📌VPC 피어링 연결
- 피어링 연결이란? 비공개적으로 두 VPC 간에 트래픽을 라우팅할 수 있게 하기 위한 서로 다른 VPC 간의 네트워크 연결을 제공
- ![[Pasted image 20221123211121.png]]

#### ✔NAT(Network Address Translation) 게이트웨이
- NAT 게이트웨이란? 외부 네트워크에 알려진 것과 다른 IP주소를 사용하는 내부 네트워크에서, 내부 IP 주소를 외부 IP 주소로 변환하는 작업을 수행하는 서비스
- 보안상 중요한 서비이지만 윈도우 패치나 보안 업데이트, 소프트웨어 업데이트를 인터넷을 통해 받아야 하는 경우 사용함.
- ![[Pasted image 20221123211554.png]]

#### 📌VPC Endpoint
- Private 서버는 인터넷과 연결되어 있는 S3와 같은 공용 리소스를 연결할 수 없음
- 그래서 NAT 게이트 웨이를 썻지만, VPC Endpoint를 이용하면, S3와 DynamoDB에 쉽고 빠르게 연결 가능
- ![[Pasted image 20221123211851.png]]

#### 📌VPN(Virtual Private Network) 연결
- VPC에서 서비스되는 인스턴스는 On-Premise에 있는 서버나 IDC 내의 시스템과 통신할 순 없음.
- 그래서 VPC에 가상 프라이빗 게이트웨이를 연결하고, 라우팅 테이블 생성하며, 보안 그룹의 규칙을 업데이트해서 접속 가능하게하는 하이브리드 클라우드환경을 구성할 수 있음.
- ![[Pasted image 20221123212335.png]]

📌실습 : VPC 마법사를 통해 퍼블릭 서브넷과 프라이빗 서브넷 만들기(P.123)
📌실습 : 리전 간 VPC Peering으로 글로벌 통합 네트워크 환경 구축하기(P.124)
