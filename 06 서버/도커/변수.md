Docker Composeë¥¼ ì‚¬ìš©í•´ ê°œë°œ(development)ê³¼ ìš´ì˜(production) í™˜ê²½ì„ ë¶„ë¦¬í•˜ê³ , Node.js ë°±ì—”ë“œì™€ React í”„ë¡ íŠ¸ì—”ë“œì— ê°ê° ë‹¤ë¥¸ `.env` íŒŒì¼ì„ ì ìš©í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ğŸ› ï¸

---

### 1. í”„ë¡œì íŠ¸ êµ¬ì¡° ì˜ˆì‹œ
```bash
my-project/
â”œâ”€â”€ backend/               # Node.js ë°±ì—”ë“œ
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.dev           # ê°œë°œìš© í™˜ê²½ ë³€ìˆ˜
â”‚   â”œâ”€â”€ .env.prod          # ìš´ì˜ìš© í™˜ê²½ ë³€ìˆ˜
â”‚   â””â”€â”€ ...
â”œâ”€â”€ frontend/              # React í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.development   # ê°œë°œìš© (React ê¸°ë³¸ ê·œì¹™)
â”‚   â”œâ”€â”€ .env.production    # ìš´ì˜ìš© (React ê¸°ë³¸ ê·œì¹™)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docker-compose.dev.yml   # ê°œë°œìš© Docker Compose
â”œâ”€â”€ docker-compose.prod.yml  # ìš´ì˜ìš© Docker Compose
â””â”€â”€ .gitignore
```

---

### 2. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ì‘ì„±

#### 1) ë°±ì—”ë“œ (Node.js)
- `backend/.env.dev` (ê°œë°œìš©)
```env
NODE_ENV=development
PORT=5000
DB_HOST=dev-db
JWT_SECRET=dev_secret
```

- `backend/.env.prod` (ìš´ì˜ìš©)
```env
NODE_ENV=production
PORT=5000
DB_HOST=prod-db
JWT_SECRET=prod_secret_123!
```

#### 2) í”„ë¡ íŠ¸ì—”ë“œ (React)
`.env` íŒŒì¼ëª…ì€ ë°˜ë“œì‹œ `.env.development`/`.env.production` ì‚¬ìš©
ë³€ìˆ˜ëª…ì€ `REACT_APP_` ì ‘ë‘ì‚¬ í•„ìˆ˜

- `frontend/.env.development` (ê°œë°œìš©)
```env
REACT_APP_API_URL=http://localhost:5000/api
REACT_APP_DEBUG=true
```

- `frontend/.env.production` (ìš´ì˜ìš©)
```env
REACT_APP_API_URL=https://api.myapp.com/api
REACT_APP_DEBUG=false
```

> âš ï¸ React ê·œì¹™: `.env.development`ì™€ `.env.production` íŒŒì¼ëª…ì„ ì‚¬ìš©í•´ì•¼ ìë™ìœ¼ë¡œ ì¸ì‹ë©ë‹ˆë‹¤.

---

### 3. Dockerfile ì„¤ì •

#### 1) ë°±ì—”ë“œ Dockerfile (`backend/Dockerfile`)
```dockerfile
# ê°œë°œ/ìš´ì˜ ê³µí†µ ë² ì´ìŠ¤
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./

# ARGë¡œ í™˜ê²½ ë³€ìˆ˜ ì „ë‹¬ (ê¸°ë³¸ê°’: production)
ARG NODE_ENV=production
ENV NODE_ENV=${NODE_ENV}

RUN npm install

COPY . .

# .env íŒŒì¼ ë³µì‚¬ (ê°œë°œ/ìš´ì˜ ë¶„ë¦¬)
COPY .env.${NODE_ENV} .env

CMD ["node", "server.js"]
```

#### 2) í”„ë¡ íŠ¸ì—”ë“œ Dockerfile (`frontend/Dockerfile`)
ReactëŠ” ë¹Œë“œ íƒ€ì„ì— í™˜ê²½ ë³€ìˆ˜ê°€ ê³ ì •ë˜ë¯€ë¡œ `ENV` ëŒ€ì‹  `COPY .env` ì‚¬ìš©
```dockerfile
# React ë¹Œë“œ ë‹¨ê³„
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm install

COPY . .

# í™˜ê²½ì— ë§ëŠ” .env íŒŒì¼ ë³µì‚¬
COPY .env.${ENV} .env
RUN npm run build

# Nginx ì„œë¹™ ë‹¨ê³„
FROM nginx:alpine
COPY --from=builder /app/build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

---

### 4. Docker Compose íŒŒì¼ ì‘ì„±

#### 1) ê°œë°œìš© (`docker-compose.dev.yml`)
```yaml
version: '3.8'

services:
backend:
build:
  context: ./backend
  args:
	NODE_ENV: development
env_file:
  - ./backend/.env.dev
ports:
  - "5000:5000"
volumes:
  - ./backend:/app
  - /app/node_modules

frontend:
build:
  context: ./frontend
  args:
	ENV: development
env_file:
  - ./frontend/.env.development
ports:
  - "3000:3000"
volumes:
  - ./frontend:/app
  - /app/node_modules
depends_on:
  - backend
```

#### 2) ìš´ì˜ìš© (`docker-compose.prod.yml`)
```yaml
version: '3.8'

services:
backend:
build:
  context: ./backend
  args:
	NODE_ENV: production
env_file:
  - ./backend/.env.prod
ports:
  - "5000:5000"
restart: always

frontend:
build:
  context: ./frontend
  args:
	ENV: production
env_file:
  - ./frontend/.env.production
ports:
  - "80:80"
restart: always
depends_on:
  - backend
```

---

### 5. ì‹¤í–‰ ëª…ë ¹ì–´

#### 1) ê°œë°œ í™˜ê²½ ì‹¤í–‰
```bash
docker-compose -f docker-compose.dev.yml up --build
```

#### 2) ìš´ì˜ í™˜ê²½ ë¹Œë“œ ë° ì‹¤í–‰
```bash
docker-compose -f docker-compose.prod.yml up --build -d
```

---

### í•µì‹¬ ì„¤ì • ì„¤ëª…

1. ARG & ENV ì¡°í•©
- `build.args`ë¥¼ ì‚¬ìš©í•´ Dockerfileì— í™˜ê²½ êµ¬ë¶„ ì „ë‹¬
- 

2. ë³¼ë¥¨ ë§ˆìš´íŠ¸ (ê°œë°œìš© ì „ìš©)
- ì‹¤ì‹œê°„ ì½”ë“œ ë°˜ì˜ì„ ìœ„í•´ ë¡œì»¬ ì½”ë“œë¥¼ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸
- `node_modules`ëŠ” ë³„ë„ë¡œ ê´€ë¦¬í•˜ì—¬ ì¶©ëŒ ë°©ì§€

1. React íŠ¹ì´ì‚¬í•­


2. ë³´ì•ˆ ê¶Œì¥ì‚¬í•­
- `.env*` íŒŒì¼ì€ `.gitignore`ì— ì¶”ê°€
- ë¯¼ê° ì •ë³´(ì˜ˆ: JWT_SECRET)ëŠ” Docker Secrets ì‚¬ìš© ê¶Œì¥

---

### ë¬¸ì œ í•´ê²° íŒ
- í™˜ê²½ ë³€ìˆ˜ê°€ ì ìš©ë˜ì§€ ì•Šì„ ë•Œ
```bash
# ìºì‹œ ì—†ì´ ì¬ë¹Œë“œ
docker-compose -f docker-compose.dev.yml build --no-cache
```

- React í™˜ê²½ ë³€ìˆ˜ í™•ì¸
```bash
docker exec -it frontend_container cat /usr/share/nginx/html/env-config.js
```

- Node.js í™˜ê²½ ë³€ìˆ˜ í™•ì¸
```bash
docker exec -it backend_container printenv
```
