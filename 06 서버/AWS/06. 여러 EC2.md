#여러EC2

#AWS로시작하는인프라구축의정석 , #아마존웹서비스AWS

----

# 이론 

## 맥락
#### 인터넷 트래픽이 EC2에 도달하는 과정 ✔
![[Pasted image 20221123164030.png]]
1) **VPC는 인터넷 게이트웨이에 연결**이 되어야만 외부 인터넷과 통신을 할 수 있다.
2) 라우터(Router)는 **라우터 테이블 해당하는 주소**를 보고 인터넷 트래픽을 맞는 방향에 전송해준다.
3) **NACL**(Network Access Control List) 인터넷 트래픽이 **서브넷에 접근하기 전에 허용한 트래픽인지 거부한 트래픽인지 확인**한다.
4) **인스턴스에 접근하는 트래픽이 허용한 트래픽**인지 확인하는 절차를 가지는 게 **보안그룹**(Security Group) 이다.


#### 인프라 구축하는 과정
[[AWS] 가장쉽게 VPC 개념잡기. 가장쉽게 VPC 알아보기](https://medium.com/harrythegreat/aws-%EA%B0%80%EC%9E%A5%EC%89%BD%EA%B2%8C-vpc-%EA%B0%9C%EB%85%90%EC%9E%A1%EA%B8%B0-71eef95a7098)

5) VPC의 아이피범위를 RFC1918이라는 **Private IP대역에 맞추어 구축**해야함. (Private IP 할당)
![[Pasted image 20221123173746.png]]

6) 서브넷 만들기
![[Pasted image 20221123174211.png]]

7) 라우팅 테이블과 라우터
- 네트워크 요청이 발생하면 데이터는 우선 라우터로 향하게됩니다. 
- 라우터란 목적지이고 라우팅테이블은 각 목적지에 대한 이정표
- 데이터는 라우터로 향하게되며 네트워크 요청은 각각 정의된 라우팅테이블에따라 작동함.
- if) 범위 밖에 네트워크 요청이 온다면, 처리할수 없음
![[Pasted image 20221123175726.png]]

8) 인터넷게이트웨이
- 인터넷게이트웨이란? VPC와 인터넷을 연결해주는 하나의 관문
- 서브넷B의 라우팅테이블을 잘보면 0.0.0.0/0으로 정의되어있습니다. 이뜻은 모든 트래픽에 대하여 IGA(인터넷 게이트웨이) A로 향하라는뜻
![[Pasted image 20221123180246.png]]

9) 네트워크 ACL과 보안그룹
- 네트워크 ACL과 보안그룹은 방화벽과 같은 역할을 하며 인바운드 트래픽과 아웃바운드 트래픽 보안정책을 설정
- 보안그룹이란? Stateful한 방식으로 동작하는 보안그룹은 모든 허용을 차단하도록 기본설정 되어있으며 필요한 설정은 허용
-  네트워크ACL이란? 각각의 보안그룹별로도 별도의 트래픽을 설정할 수 있으며 서브넷에도 설정할 수 있지만 각각의 EC2인스턴스에도 적용.
![[Pasted image 20221123180401.png]]

10) NAT 게이트웨이
- NAT 게이트웨이란? 프라이빗서브넷이 인터넷과 통신하기위한 아웃바운드 인스턴스
- 프라이빗 네트워크가 외부에서 요청되는 인바운드는 필요없더라도 인스턴스의 펌웨어나 혹은 주기적인 업데이트가 필요하여 아웃바운드 트래픽만 허용되야할 경우사용함.
![[Pasted image 20221123183143.png]]


## VPC
#### 네트워크란?
**인프라스트럭처(=인프라, 기반시설) 관리자가 주체가 되어 관리**하는 장소임. 네트워크 내의 기기는 LAN을 통해서 자유롭게 통신할 수 있음.
![image](https://github.com/sprae114/Study/assets/52237184/0a4f177e-632b-4703-bff4-976ec89eb8bc)


#### 가용영역이란?
클라우드 컴퓨팅에서 특정 지역 내에서 **독립적으로 운영되는 데이터 센터**를 의미합니다.
![[Pasted image 20240228200915.png]]

각 가용 영역은 독립적인 전원, 쿨링 시스템, 네트워크를 가지며, 다른 가용 영역과는 **물리적으로 분리**되어 있습니다.
![image](https://github.com/sprae114/Study/assets/52237184/5043d173-dbd1-4b77-83a0-84c69a4df22b)


#### VPC이란?
- **논리적으로 격리된 사용자 전용 가상 네트워크**
- 복수의 AZ(데이터센터)에 걸친 상태로 생성가능해, 물리적으로는 다른 곳에 위치하지만 논리적으로 같은 네트워크
![[Pasted image 20240228200839.png]]


#### VPC를 사용하는 이유는?
 ![[Pasted image 20221123173403.png]]
VPC가 없다면 EC2 인스턴스들이 서로 거미줄처럼 연결되고 인터넷과 연결됌. 이렇게 되면 인스턴스 변경에 불편함 생김.

 ![[Pasted image 20221123173527.png]]
VPC를 적용하면 위 그림과같이 **VPC별로 네트워크를 구성**할 수 있고 각각의 VPC에따라 다르게 네트워크 설정을 줄 수 있습니다.


## 서브넷
#### 서브넷이란?
VPC의 **IP주소 범위를 나누는 단위**로, **VPC안에는 하나 이상의 서브넷**을 만들어야함.
![[Pasted image 20240228201026.png]]


#### 서브넷을 사용하는 이유는?
11. 네트워크 관리의 편의성
서브넷을 사용하면 큰 네트워크를 **여러 개의 작은 네트워크로 분할**할 수 있습니다. 이렇게 하면 네트워크를 더욱 쉽게 관리할 수 있습니다.

12. 보안 강화
서브넷을 사용하면 네트워크의 보안을 강화할 수 있습니다. 서브넷을 통해 각 네트워크를 물리적 또는 논리적으로 분리함으로써, 각 네트워크를 독립적으로 보호할 수 있습니다. 예를 들어, 중요한 데이터를 처리하는 서버는 별도의 서브넷에 배치하여 외부로부터의 접근을 제한할 수 있습니다.

13. 효율적인 IP 주소 관리
서브넷을 사용하면 IP 주소를 효율적으로 관리할 수 있습니다. 서브넷을 통해 IP 주소를 그룹화하고 할당하면, IP 주소의 낭비를 줄이고, IP 주소의 관리를 효율적으로 수행할 수 있습니다.


#### 서브넷 종류는?
![image](https://github.com/sprae114/Study/assets/52237184/6bea6eb3-fcf5-4127-a922-df740bf33edb)
14. Public 서브넷
Public 서브넷의 인스턴스는 인터넷 게이트웨이를 통해 **인터넷에 직접 연결**될 수 있습니다. 이를 가능하게 하려면 인스턴스에 공용 IP 주소(예: Elastic IP)가 할당되어야 합니다. 또한, 라우팅 테이블에 인터넷 게이트웨이를 지정해야 합니다. 
일반적으로 **웹 서버, 애플리케이션 서버**와 같이 외부와 통신이 필요한 시스템을 배치합니다.

15. Private 서브넷
Private 서브넷의 인스턴스는 **인터넷에 직접 연결되지 않습**니다. 이들 인스턴스는 NAT 게이트웨이 또는 NAT 인스턴스를 통해 인터넷에 액세스할 수 있지만, 인터넷에서 이들 인스턴스를 직접 액세스할 수는 없습니다. 
일반적으로 보안이 중요한 데이터를 처리하는 **데이터베이스, 백엔드 서버** 등..을 배치합니다.


## 통로
#### 인터넷 게이트웨이란?
인터넷 게이트웨이는 **VPC와 인터넷 간의 통신을 가능하게 하는 라우팅 역할**을 하는 AWS 구성 요소입니다. 이를 통해 VPC 내의 인스턴스가 인터넷에 접근하도록 하거나, 인터넷에서 직접 접근 가능한 인스턴스로 트래픽을 라우팅할 수 있습니다.
![image](https://github.com/sprae114/Study/assets/52237184/6bea6eb3-fcf5-4127-a922-df740bf33edb)


#### NAT 게이트웨이란?
**사설 IP 주소와 공인 IP 주소 간의 변환을 수행하는 네트워크 기술**입니다. 프라이빗 서브넷에 생성된 리소스는 인터넷으로 내보낼 수는 있지만 인터넷에 접근할 수 없어야함. 이를 위해 NAT 게이트웨이가 등장함. 퍼블릭 서브넷에 생성함.
![image](https://github.com/sprae114/Study/assets/52237184/92efbafa-30d0-44fa-a63d-a75d7c622819)

![image](https://github.com/sprae114/Study/assets/52237184/b0e17f34-c26b-468d-a6c2-01226fedcbe7)

![image](https://github.com/sprae114/Study/assets/52237184/3385094f-85bf-4249-9cfd-0f52e6cacf5d)


#### 라우팅 테이블이란?
네트워크 **트래픽이 어디로 가야 하는지 결정하는 규칙을 담고 있는 테이블**입니다. 라우팅 테이블에는 목적지 IP 주소 범위(라우트)와 이 트래픽을 처리할 대상(예: 인터넷 게이트웨이, NAT 게이트웨이, VPC 피어링 등)이 포함되어 있습니다. 각 서브넷은 하나 이상의 라우팅 테이블에 연결되어 있으며, 이를 통해 네트워크 트래픽의 흐름을 제어합니다.

**서브넷과 각각 게이트 웨이 또는 서브넷과 서브넷이 통신 할 수 있는 경로**를 만들어야함.
![image](https://github.com/sprae114/Study/assets/52237184/45fcd322-23f2-4a6b-b79a-ec13d48885a0)

**통신 경로를 설정하기 위해** 라우팅 테이블을 사용함.
![[Pasted image 20230705165300.png]]
- 송신 대상지 : 접속 대상의 위치
- 타깃 : 경우지
![image](https://github.com/sprae114/Study/assets/52237184/f5644843-11f9-4246-a30c-79e50f93e07b)


## 보안그룹
#### 보안 그룹이란?
인스턴스에 대한 인바운드, 아웃바운드의 **네트워크 트래픽을 제어**하는 가상의 방화벽 역할을 수행함.
**인바운드 트래픽과 아웃바운드 트래픽을 별도로 제어** 가능

![image](https://github.com/sprae114/Study/assets/52237184/32abae85-18bd-423a-b4ee-ddbe6c2dd007)


#### 보안 그룹이 제어하는 2가지 방법은?
16) **포트 번호**
포트 번호로 서비스 종류 지정함. EX) HTTP(80번), HTTPS(443번), SSH(22번)

17) **IP 주소**
회사나 학교 조직 내에서 네트워크를 작업할 경우 IP주소를 한정할 수 있음. (IP 주소가 변하지 않으니깐)


#### 보안그룹을 왜 두개나 설정할까?
- **점프서버** : 모든 리소스에 접속하는 입구로, 주로 관리자 접근용으로 사용되는 중간 서버임. 외부에서 직접적으로 접근하지 못하도록 막은 내부 인스턴스에 접근하기 위한 보안 채널을 제공함. **내부 인스턴스에 SSH 또는 RDP를 사용하여 접속하기 위해**서는 점프 서버를 거치도록 되어 있음.
- **로드 밸린서** : **요청이나 처리를 분산하는 역할**로, 사용자 트래픽을 여러 인스턴스로 분산하여 예기치 않은 장애 및 서버 부하를 줄임.


#### NACL과 보안 그룹 차이는?
- 공통점 : **접근 제한을 수행**하기 위한 시스템
- NACL(Network Access Control List) : VPC 내부에 생성 **서브넷 단위**로 접근 제한
- 보안 그룹 : VPC 내부에 생성 **인스턴스 단위**로 접근 제한

![image](https://github.com/sprae114/Study/assets/52237184/b2f19bd7-946b-4871-93d1-e819100a89f0)


## 로드 밸런싱
#### 로드 밸런싱이란?
네트워크 기술의 일종으로 네트워크 **트래픽을 하나 이상의 서버나 장비로 분산**하기 위해 사용되는 기술
![[Pasted image 20221124002916.png]]

#### ELB(Elastic Load Balancing)
가용영역에서 EC2 인스턴스 및 컨테이너, IP주소 같은 동일한 서비스를 제공하기 위해 여러 네트워크 트래픽을 자동으로 분산시킴 
![[Pasted image 20221124021622.png]]


# 실습
## 가상네트워크 설정
#### VPC 설정
![image](https://github.com/sprae114/Study/assets/52237184/3cc864e8-2aac-4e7f-99ea-975a969b9fd8)


#### 서브넷 생성 설정
![image](https://github.com/sprae114/Study/assets/52237184/54405164-174c-4907-abeb-c56bb3e35fc3)

![image](https://github.com/sprae114/Study/assets/52237184/49470de6-28a6-4482-af58-2ef7813d4772)


####  NAT 게이트웨이 생성 내용
![image](https://github.com/sprae114/Study/assets/52237184/882b7545-56ae-45af-951e-6532e16f1f5b)


#### 라우팅 테이블 설정
![image](https://github.com/sprae114/Study/assets/52237184/fc0a5a4c-22a2-424e-b885-8fd65226a48e)

![image](https://github.com/sprae114/Study/assets/52237184/d81af3bc-0311-411d-9a7a-b315ff63c60a)

![image](https://github.com/sprae114/Study/assets/52237184/4509e93a-f136-478f-a381-7c364317fb1d)


#### 보안 그룹 설정
![[Pasted image 20230705193055.png]]

