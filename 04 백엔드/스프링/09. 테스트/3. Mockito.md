# Mockito 사용법

## Mock 객체 의존성 주입
Mockito에서 가짜 객체의 의존성 주입을 위해서는 크게 3가지 어노테이션이 사용된다.

- @Mock: 가짜 객체를 만들어 반환해주는 어노테이션
- @Spy: Stub하지 않은 메소드들은 원본 메소드 그대로 사용하는 어노테이션
- @InjectMocks: @Mock 또는 @Spy로 생성된 가짜 객체를 자동으로 주입시켜주는 어노테이션

예를 들어 UserController에 대한 단위 테스트를 작성하고자 할 때, UserService를 사용하고 있다면 @Mock 어노테이션을 통해 가짜 UserService를 만들고, @InjectMocks를 통해 UserController에 이를 주입시킬 수 있다.


## Stub로 결과 처리
의존성이 있는 객체는 **가짜 객체를 주입하여 어떤 결과를 반환하라고 정해진 답변을 준비**시켜야 한다.

- doReturn(): 가짜 객체가 특정한 값을 반환해야 하는 경우
- doNothing(): 가짜 객체가 아무 것도 반환하지 않는 경우(void)
- doThrow(): 가짜 객체가 예외를 발생시키는 경우


## Mockito 어노테이션 추가
Mockito도 테스팅 프레임워크이기 때문에 JUnit과 결합되기 위해서는 클래스 어노테이션으로 별도의 작업이 필요하다. 
JUnit4 -> `@RunWith(MockitoJUnitRunner.class)`
JUnit5 -> `@ExtendWith(MockitoExtension.class)`


# 메소드
## mock()
**Mock 객체를 생성**합니다.
```java
List mockedList = mock(List.class);
```


## when() / thenReturn()
Mock 객체의 메서드 호출에 대한 **반환 값을 설정**합니다.
```java
when(mockedList.get(0)).thenReturn("first");
```


## verify()
특정 메서드가 **몇 번 호출되었는지 검증**합니다.
```java
verify(mockedList).add("one");
verify(mockedList, times(1)).add("one"); // same as above line
```


## anyInt(), anyString(), any()
메서드 호출 시 **어떤 인자가 들어와도 동작하게** 만듭니다.
```java
when(mockedList.get(anyInt())).thenReturn("element");
```


## times(), never()
특정 메서드가 **몇 번 호출되었는지 검증할 때** 사용됩니다.
```java
verify(mockedList, times(2)).clear();
verify(mockedList, never()).remove(0);
```


## doThrow() / when()
**예외를 발생**시킵니다.
```java
doThrow(new RuntimeException()).when(mockedList).clear();
```


##  reset()
Mock 객체의 상태를 **초기화**합니다.
```java
reset(mockedList);
```


## inOrder()
메서드 호출 **순서를 검증**합니다.
```java
InOrder inOrder = inOrder(firstMock, secondMock);
inOrder.verify(firstMock).add("was called first");
inOrder.verify(secondMock).add("was called second");
```


## timeout()
특정 시**간 내에 메소드가 호출**되었는지 검증합니다.
```java
verify(mockedList, timeout(100)).size();
```


## doReturn() / when()
Stubbing 할 때 실제 메소드를 실행하지 않고 바로 Stubbing 값이 반환되게 합니다. 
```java
doReturn("value").when(mockedList).get(0);
```


## ArgumentMatchers
특정 타입의 인자나 조건을 만족하는 인자 등으로 메소드 호출을 매칭시킬 수 있습니다.
```java
when(mockedList.contains(argThat(isValid()))).thenReturn(true);
```


## BDDMockito
BDD 스타일로 작성된 테스트 코드에 적합한 방식으로 Mockito를 사용할 수 있게 해줍니다. 
```java
given(mockedList.get(0)).willReturn("first"); 
then(mockedList).should().add("one");
```

