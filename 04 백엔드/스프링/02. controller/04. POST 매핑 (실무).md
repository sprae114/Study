
#ë§¤í•‘, #Post

#ì¸í”„ëŸ°MVC_1í¸

inflearn-mvc1/mapping

----
#ì¸í”„ëŸ°MVC_1í¸03(page. )
# Post
## Post ë§¤í•‘ì´ë€?


## Post ë§¤í•‘ êµ¬í˜„ ë‹¨ê³„
1) `@PostMapping`ìœ¼ë¡œ ì–´ë–¤ URL post ë§¤í•‘í• ì§€ ì •í•˜ê¸°
2) í•´ë‹¹ ë§¤í•‘ ìš”ì²­ë°›ì„ì§€ êµ¬í˜„í•˜ê¸°(modelì— ê°’ ì „ë‹¬ í¬í•¨)
3) ë°˜í™˜ê°’ì„ view, json, redirect í• ì§€ ì •í•˜ê¸°

![[Untitled 3.png]]



# ìš”ì²­ í•˜ê¸°
#### 1) URLë¡œ ìš”ì²­í•˜ê¸°
ğŸ’¥ì¸í„°ë„·ì— URLë¡œ ìš”ì²­í•˜ë©´ GETìœ¼ë¡œ ì²˜ë¦¬ëŒ. ê·¸ë˜ì„œ postmanì„ ì¨ì„œ ìš”ì²­í•´ì•¼í•¨.
- URLë¡œ ìš”ì²­í•˜ê¸°
![[Pasted image 20230112150206.png]]


#### 2) Bodyë¡œ ìš”ì²­í•˜ê¸°
- ë°”ë””ì— ì§ì ‘ ì…ë ¥
![[Untitled 2.png]]


#### 3) Htmlë¡œ ìš”ì²­í•˜ê¸°
- inputë²„íŠ¼ìœ¼ë¡œ ìš”ì²­í•˜ëŠ” ë°©ë²•
ì¶œì²˜ : [ì½”ë”©ì˜ ì‹œì‘, TCP School](http://www.tcpschool.com/html-tag-attrs/form-action), [HTML DOM Form Object (w3schools.com)](https://www.w3schools.com/jsref/dom_obj_form.asp)
```html
<!-- ìƒëµ -->
<form action="/request-param-v1" method="post">
		username: <input type="text" name="username" />
		age: <input type="text" name="age" />
		<button type="submit">ì „ì†¡</button>
</form>
<!-- ìƒëµ -->
```
    
- ì–´ë–»ê²Œ ì „ì†¡ë˜ëŠ” ê±°ì§€?
ì¶œì²˜ : [th:action, th:onclick ì°¨ì´ - ì¸í”„ëŸ° | ì§ˆë¬¸ & ë‹µë³€ (inflearn.com)](https://www.inflearn.com/questions/522237/th-action-th-onclick-%EC%B0%A8%EC%9D%B4)
	onclick -> Â í´ë¦­ ì‹œ ë°œìƒí•  ë©”ì„œë“œ(ì´ë²¤íŠ¸)ë¥¼ ì§€ì •
    action â†’ `<form>`íƒœê·¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì†ì„±ìœ¼ë¡œÂ ì„œì‹ ë°ì´í„°(form data)ë¥¼ ì„œë²„ë¡œ ë³´ë‚¼ ë•Œ í•´ë‹¹ ë°ì´í„°ê°€ ë„ì°©í•  URLì„ ì§€ì •
    method â†’ ë™ì‘ ë©”ì†Œë“œ ì•Œë ¤ì¤Œ
    submit â†’ ë²„íŠ¼ì„ í†µí•´ post ë°©ì‹ìœ¼ë¡œ th:action ìš”ì²­í•¨.


#### 4) Jsonë¡œ ìš”ì²­í•˜ê¸°
- Postmanìœ¼ë¡œ Json ìš”ì²­
![[Untitled 1.png]]


# ìš”ì²­ ë°›ê¸°

## @RequestParam
String, int, Longì„ ìš”ì²­ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì„ ë•Œ ì‚¬ìš©í•¨.

#### ê¸°ë³¸ê°’
```java
@ResponseBody  
@PostMapping("/request-param-basic")  
public String postBasic(  
        @RequestParam String username,  
        @RequestParam int age) {  
  
    log.info("postBasic : username = {}, age={}", username, age);  
  
    return "post-basic username = " + username + " , " + age;  
}
```


#### ì˜µì…˜
```java
@ResponseBody  
@PostMapping("/request-param-default")  
public String requestParamDefault(  
        @RequestParam(required = true, defaultValue = "guest") String username,  
        @RequestParam(required = false, defaultValue = "-1") int age) {  
  
    log.info("ParamDefault : username = {}, age={}", username, age);  
  
    return username + " , " + age;  
}
```
- required,ëŠ” í•„ìˆ˜ ê°’, defaultValueëŠ” ê¸°ë³¸ ê°’
requiredëŠ” íŒŒë¼ë¯¸í„°ê°€ trueë©´ ìš”ì²­ íŒŒë¼ë¯¸í„°ì— ê¼­ ìˆì–´í•˜ëŠ” ê²ƒ, falseë©´ ìš”ì²­ íŒŒë¼ë¯¸í„°ì— ì—†ì–´ë„ ë˜ëŠ” ê²ƒ
defaultValueëŠ” ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì„ ë•Œ, ê¸°ë³¸ ê°’ ì§€ì •í•¨.


#### Model O
```java
@PostMapping("/request-param-model")  
public String requestParamModel(  
        @RequestParam String username,  
        @RequestParam int age,  
        Model model) {  
  
    model.addAttribute("username", username);  
    model.addAttribute("age", age);  
  
    return "checkUser";  
}
```


## @ModelAttribute
#### ê¸°ë³¸ê°’
1)ê³¼ ê°™ì€ ì˜ë¯¸ì§€ë§Œ ì…ë ¥ì—ì„œ ê°ì²´ë¥¼ ë°›ì„ìˆ˜ ìˆê²Œí•¨.
```java
@PostMapping("/request-ModelAttribute")  
public User requestModelAttribute(  
        @ModelAttribute User user,  
        Model model) {  
  
    model.addAttribute("username", user.getUsername());  
    model.addAttribute("age", user.getAge());  
  
    return user;  
}
```

â–¶@ModelAttributeì˜ ì—­í• 
1. íŒŒë¼ë¯¸í„°ë¥¼ ìš”ì²­ ë°›ê¸°   ex) `@RequestParam String itemName`
2. ê°ì²´ ìƒì„±í•˜ê¸°   ex) `Item item = new Item();`
3. ê°ì²´ì— íŒŒë¼ë¯¸í„° ë„£ê¸° ex) `item.setItemName(itemName);`
4. modelì— ë„£ì–´ì„œ viewì— ë„˜ê²¨ì£¼ê¸° ex) `model.addAttribute("item", item);`


## @PathVariable
URI ê²½ë¡œì— íŒŒë¼ë¯¸í„°ì˜ ë”°ë¼ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ

#### ë‹¨ì¼ ê²½ë¡œ
ìš”ì²­ ë§¤í•‘ : `http://localhost:8080/mapping/kang`

```java
@ResponseBody  
@PostMapping("/mapping/{data}")  
public String mappingPath(@PathVariable String data) {  
    log.info("mappingPath userId={}", data);  
    return "data : " + data;  
}
```


#### ë‹¤ì¤‘ ê²½ë¡œ
ìš”ì²­ ë§¤í•‘ :  `http://localhost:8080/mapping/kang/2`

```java
@ResponseBody  
@PostMapping("/mapping/{data}/{num}")  
public String mappingPath(@PathVariable String data, @PathVariable int num) {  
    log.info("mappingPath userId={} {}", data, num);  
    return "data, num : " + data + " , " + num;  
}
```


## @RequestBody
#### @RequestBodyë€?
ì¶œì²˜ : https://mangkyu.tistory.com/72

- Json(application/json) í˜•íƒœì˜ **HTTP BodyÂ ë°ì´í„°**ë¥¼ MessageConverterë¥¼ í†µí•´ **Java ê°ì²´ë¡œ ë³€í™˜**ì‹œí‚´
- ê¸°ë³¸ ìƒì„±ìë¡œ ê°ì²´ë¥¼ ë§Œë“¤ê³ , Getterë‚˜ Setter ë“±ì˜ ë©”ì†Œë“œë¡œ í•„ë“œë¥¼ ì°¾ì•„Â Reflectionìœ¼ë¡œ ê°’ì„ ì„¤ì •í•¨
- **HTTP ë©”ì‹œì§€ ë°”ë””**ë¥¼ í†µí•´ì„œ ë°ì´í„°ê°€ ë„˜ì–´ì˜¬ ë•ŒëŠ” ê¸°ì¡´ì˜ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ìŒ.


#### ê¸°ë³¸ê°’
```java
@ResponseBody  
@PostMapping("/requestBody-user")  
public User requestBodyObject2(@RequestBody User user) {  
    log.info("username={}, age={}", user.getUsername(), user.getAge());  
    return user;  
}
```


## HttpEntity <>
#### HttpEntityë€?
- **HTTP ë©”ì‹œì§€ ë°”ë””**ë¥¼ í†µí•´ì„œ ë°ì´í„°ê°€ ë„˜ì–´ì˜¬ë•Œ ì‚¬ìš©í•¨.
- **HttpEntity ë¥¼ ì‚¬ìš©í•˜ì—¬ header, bodyì˜ ì •ë³´ë¥¼ í¸ë¦¬í•˜ê²Œ ì¡°íšŒ**
- HttpEntity , @RequestBody ë¥¼ ì‚¬ìš©í•˜ë©´Â HTTP ë©”ì‹œì§€ ì»¨ë²„í„°ê°€ HTTP ë©”ì‹œì§€ ë°”ë””ì˜ ë‚´ìš©ì„ ìš°ë¦¬ê°€ ì›í•˜ëŠ”Â ë¬¸ìë‚˜ ê°ì²´ ë“±ìœ¼ë¡œ ë³€í™˜í•´ì¤Œ.
- HttpEntityëŠ” **ì‘ë‹µì—ë„ ì‚¬ìš© ê°€ëŠ¥ ë©”ì‹œì§€ ë°”ë”” ì •ë³´ ì§ì ‘ ë°˜í™˜.  view ì¡°íšŒX**


#### ê¸°ë³¸ê°’
```java
@ResponseBody  
@PostMapping("/httpEntity")  
public HttpEntity<String> requestBodyStringV3(HttpEntity<String> httpEntity) throws IOException {  
    HttpHeaders headers = httpEntity.getHeaders();  
    String body = httpEntity.getBody();  
  
    log.info("messageBody={}", headers);  
    log.info("messageBody={}", body);  
  
    return new HttpEntity<>("User added successfully!", headers);  
}
```



# ì‘ë‹µ í•˜ê¸°

## 1) redirect ë°˜í™˜
#### redirect ì‚¬ìš© X
post -> viewë¥¼ ë¦¬í„´í•˜ë©´ ë©±ë“±ì„± ë¬¸ì œê°€ ë°œìƒí•¨.
```java

```


#### redirect ì‚¬ìš© O
resourcesì— ìˆëŠ” htmlì˜ ì´ë¦„ì´ ë§¤ì¹­í•˜ì—¬ viewë¥¼ ì°¾ê³  ëœë”ë§í•¨. Post ë°©ì‹ì€ ë©±ë“±ì´ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ìƒˆë¡œê³ ì¹¨í•˜ë©´ ê²°ê³¼ì— ì˜í–¥ì„ ì¤Œ. ë”°ë¼ì„œ redirectë¡œ ë°˜í™˜í•´ì•¼í•¨.

Controller
```java
@PostMapping("/new-form")
public String newForm() {return "new-form";}
```


---

## 2) json ë°˜í™˜
viewë¥¼ ì°¾ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, Http ë©”ì‹œì§€ ë°”ë””ì— ë°”ë¡œ ì…ë ¥í•¨.

- jsonìœ¼ë¡œ ì‘ë‹µí•˜ê¸°
```java
@RequestBody
@PostMapping("/hello-go")
public String helloBasic() {return "ok";}
```
- @RestController , @ResponseBody ì˜ ê³µí†µëœ ì—­í• ì€?
	- ë°˜í™˜ ê°’ìœ¼ë¡œ ë·°ë¥¼ ì°¾ëŠ”ê²ƒì´ ì•„ë‹ˆë¼, HTTP ë©”ì‹œì§€ ë°”ë””ì— ë°”ë¡œ ì…ë ¥í•˜ì—¬ ë³´ë‚¸ë‹¤.

## 3) HTTP ì‘ë‹µ

- ResponseEntity<> ë¥¼ ì´ìš©í•œ ì‘ë‹µ
    HttpEntityëŠ” HTTP ë©”ì‹œì§€ì˜ í—¤ë”, ë°”ë”” ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆë‹¤
```java
@PostMapping("/response-body-string-v2")
public ResponseEntity<String> responseBodyV2() {
	return new ResponseEntity<>("ok", HttpStatus.OK);
}
```


# ì´ë¡ 
## Redirectì— ëŒ€í•´ì„œ
mvc1í¸ page.216
#### ë¦¬ë‹¤ì´ë™ì…˜ì´ë€?
**re(ë‹¤ì‹œ)Â +Â ì§€ì‹œí•˜ë‹¤(direct)Â ë‹¤ì‹œÂ ì§€ì‹œí•˜ëŠ”Â ê²ƒ**ì„Â ë§í•œë‹¤.  
ì˜ˆë¥¼Â ë“¤ì–´Â ë¸Œë¼ìš°ì €ê°€ `www.webstone.com/blogA`Â URLì„Â ì›¹Â ì„œë²„ì—Â ìš”ì²­í–ˆë‹¤ê³ Â í•˜ì.Â ê·¸ëŸ¬ë©´Â ì„œë²„ëŠ”Â HTTPÂ ì‘ë‹µÂ ë©”ì‹œì§€ë¥¼Â í†µí•´Â "`www.webstone.com/blogB`ë¡œÂ ë‹¤ì‹œÂ ìš”ì²­í•´ë´!~"Â ë¼ê³ Â ë¸Œë¼ìš°ì €ì—ê²ŒÂ **ë‹¤ë¥¸Â URL(ê¸¸,Â ë°©í–¥)Â ì„Â ì§€ì‹œí• Â ìˆ˜Â ìˆëŠ”Â ê²ƒì„Â ë¦¬ë‹¤ì´ë ‰íŠ¸**ë¼Â í•œë‹¤.
![[Pasted image 20230127091621.png]]
  

#### ìƒí’ˆ ìˆ˜ì •í• ë•Œ ë¦¬ë‹¤ì´ë ‰ì…˜?
ìƒí’ˆ ìˆ˜ì •í›„ì— ë‹¤ì‹œ í•´ë‹¹ ìƒí’ˆí˜ì´ì§€ë¡œ ê°€ê¸° ìœ„í•´ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ í•„ìš”í•¨. ex) ì²˜ë°©ì„ ë°›ì€ ì´í›„, ê°œë°œì Aë¼ëŠ” ì´ë¦„ì„ ì•Œë ¤ì£¼ê³  ì²˜ë°©ì „ì„ ë°›ì•„ì•¼í•¨.


#### PRG Post/Redirect/Get ê°€ ì™œ í•„ìš”í• ê¹Œ?
ìƒí’ˆ ë“±ë¡ í›„, ì›¹ ë¸Œë¼ìš°ì €ì˜ **ìƒˆë¡œê³ ì¹¨ì„ í•˜ë©´ ìƒí’ˆì´ ê³„ì† ë“±ë¡ë˜ëŠ” ë¬¸ì œì **(POST ë©±ë“±ë¬¸ì œ)

- ê·¸ë¦¼
![[Pasted image 20230119121019.png]]

- ì½”ë“œ
```java
@PostMapping ("/add")
public String addItemV4 (Item item) {
	itemRepository.save(item);
	return "basic/item";
}
```


#### í•´ê²°ë²•ì€?
ìƒí’ˆ ì €ì¥ í›„ì— ë·° í…œí”Œë¦¿ìœ¼ë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìƒí’ˆ ìƒì„¸ í™”ë©´ìœ¼ë¡œ **ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ í˜¸ì¶œ**í•´ì£¼ë©´ ëœë‹¤. ì´ëŸ¬ë©´ ìƒí’ˆ ì €ì¥ í›„ì— ì‹¤ì œ ìƒí’ˆ ìƒì„¸ í™”ë©´ìœ¼ë¡œ ë‹¤ì‹œ ì´ë™

- ê·¸ë¦¼
![[Pasted image 20230119121320.png]]

- ì½”ë“œ
```java
@PostMapping ("/add")
public String addItemV5 (Item item) {
	itemRepository.save(item);
	return "redirect: /basic/items/"
}
```

#### RedirectAttributes
ìƒí’ˆì„ ì €ì¥í•˜ê³  ìƒí’ˆ ìƒì„¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í–ˆëŠ”ë°, ì˜ ì €ì¥ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ê°€ ì—†ìŒ.

- controller ë³€ê²½
```java
@PostMapping("/add") 
public String addItemV6(Item item, RedirectAttributes redirectAttributes) { 
	Item savedItem = itemRepository.save(item); 
	redirectAttributes.addAttribute("itemId", savedItem.getId()); 
	redirectAttributes.addAttribute("status", true); 
	
	return "redirect:/basic/items/{itemId}";
}
```
 PathVariableê³¼ ê°™ì´ ê°’ì„ ë„˜ê²¨ì£¼ê³ , ìƒíƒœë¥¼ ë„˜ê²¨ì¤€ë‹¤.

- ë·° í…œí”Œë¦¿ ì¶”ê°€
```html
<div class="container">
	<div class="py-5 text-center"> 
		<h2>ìƒí’ˆ ìƒì„¸</h2>
	</div>

	<!-- ì¶”ê°€ --> 
	<h2 th:if="${param.status}" th:text="'ì €ì¥ ì™„ë£Œ!'"></h2>
```

- ê²°ê³¼
![[Pasted image 20230119124105.png]]
