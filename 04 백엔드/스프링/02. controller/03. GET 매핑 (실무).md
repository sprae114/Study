#매핑, #Get

#인프런MVC_1편

inflearn-mvc1/mapping
[Mapping Requests (공식문서)](https://docs.spring.io/spring-framework/reference/web/webflux/controller/ann-requestmapping.html#webflux-ann-requestmapping-annotation)

----
#인프런MVC_1편03(page. )
# GET 개념

## GET 매핑이란?
- 쿼리파라미터로, **/url?`username=hello&age=20` 형식을 사용**한다.
- 메시지 바디 없이, **URL의 쿼리 파라미터에 데이터를 포함해서 전달**
- 예) 검색, 필터, 페이징 등... 에서 많이 사용하는 방식


## GET 매핑 구현 단계
1) `@GetMapping`으로 어떤 URL get 매핑할지 정하기
2) 해당 매핑 요청받을지 구현하기(model에 값 전달 포함)
3) 반환값을 view, json, redirect 할지 정하기

![[Untitled.png]]


# 요청 하기
## 직접 요청
URL을 직접 입력 : `http://localhost:8080/form`


## 링크/버튼 요청
[코딩의 시작, TCP School](http://www.tcpschool.com/html-tag-attrs/a-href)

![[Pasted image 20221221171900.png]]

#### 링크요청
```html
<!--thymleaf 사용 O-->
<li><a href="/example">Link to example</a></li>

<!--thymleaf 사용 X-->
<a th:href="@{/example}">Link to example</a>
```
**href에 있는 `/example` 로 Get매핑 요청**함.


#### 버튼요청
```html
<!--thymleaf 사용 O-->
<button onclick="location.href='/basic/items'">Go to example</button>

<!--thymleaf 사용 X-->
<a th:href="@{/example}">Link to example</a>
<button th:onclick="|location.href='@{/basic/items}'|">Go to Items</button>
```
**onclick에 있는 `/example` 로 Get매핑 요청**함.


## 입력 파라미터 요청
#### 기본형
```html
<!--thymleaf 사용 x-->
<form action="/example" method="get">
    username: <input type="text" name="username" />
    age: <input type="text" name="age" />
    <button type="submit">전송</button>
</form>

<!--thymleaf 사용 O-->
<form th:action="@{/example}" method="get">
    ...
</form>
```
- `action` : 폼 데이터를 보낼 서버의 **URL**을 지정, 여기서는  `/example` 
- `method` : 서버로 **데이터를 보내는 방식**을 지정, 여기서는  `get` 방식
- `input` : 사용자에게 텍스트 입력을 받기 위한 **입력 필드를 생성**, 여기서는 `username`, `age` 


#### 객체
```html
<!--thymleaf 사용 x-->
<form action="/example" method="get">
    User Name: <input type="text" name="user.name" />
    User Age: <input type="text" name="user.age" />
    <button type="submit">전송</button>
</form>

<!--thymleaf 사용 O (1)-->
<form th:action="@{/example}" method="get">
    User Name: <input type="text" th:field="*{user.name}" />
    User Age: <input type="text" th:field="*{user.age}" />
    <button type="submit">전송</button>
</form>

<!--thymleaf 사용 O (2)-->
<form th:action="@{/example}" th:object="${user}" method="get">
    User Name: <input type="text" th:field="*{itemName}" />
    User Age: <input type="text" th:field="*{itemName}" />
    <button type="submit">전송</button>
</form>
```
- `th:object` : 폼의 데이터를 바인딩하는 객체를 지정하며, 여기서는 `user` 객체 사용
- `th:field` : 입력 필드와 모델 객체의 속성을 바인딩하며. 여기서는 `user`객체의 `itemName` 속성과 바인딩됩니다.


# 요청 받기
## 기본 URL 호출
#### 단일 URL
```java
@GetMapping("/home")  
public String newForm() {  
    return "newHome";  
}
```


#### 다중 URL
```java
@ResponseBody  
@GetMapping({"/home-stay", "/home-go"})  
public String helloBasic() {  
    return "helloBasic";  
}
```


#### Model O
model의 값을 view에게 전달
```java
@GetMapping("/variable")
public String variable(Model model) {
	User userA = new User("userA", 10);
	User userB = new User("userB", 20);

	List<User> list = new ArrayList<>();
	list.add(userA);
	list.add(userB);

	Map<String, User> map = new HashMap<>();
	map.put("userA", userA);
	map.put("userB", userB);

	model.addAttribute("user", userA);
	model.addAttribute("users", list);
	model.addAttribute("userMap", map);

	return "basic/variable";
}
```
`model.addAttribute`(뷰에서 데이터를 참조할 변수, 함수의 매개변수);


## @RequestParam (기본형)
**파라미터 값이 있을 때, 요청** 받는 방법. 기본형은 **String, int, Long**을 요청 파라미터로 받음.
요청방법 : `localhost:8082/request-param-basic?username=kang&age=30` 형식

#### 기본값
```java
@ResponseBody  
@GetMapping("/request-param-basic")  
public String requestParamBasic(@RequestParam String username, @RequestParam int age) {  
    log.info("username={}, age={}", username, age);  
    return "requestParamV3";  
}
```


####  Model O
```java
@GetMapping("/variable-input")  
public String variableInput(@RequestParam String username,  
                            @RequestParam int age,  
                            Model model) {  
    User userA = new User(username, age);  
    User userB = new User("userB", 20);  
  
    List<User> list = new ArrayList<>();  
    list.add(userA);  
    list.add(userB);  
  
    Map<String, User> map = new HashMap<>();  
    map.put("userA", userA);  
    map.put("userB", userB);  
  
    model.addAttribute("user", userA);  
    model.addAttribute("users", list);  
    model.addAttribute("userMap", map);  
  
    log.info("User username={}, age={}", userA.getUsername(), userA.getAge());  
    log.info("User username={}, age={}", userB.getUsername(), userB.getAge());  
  
    return "basic/variable";  
}
```


## @RequestParam (자료구조)
[스프링 controller에서 파라미터를 받는 다양한 방법](https://velog.io/@shson/%EC%8A%A4%ED%94%84%EB%A7%81-controller%EC%97%90%EC%84%9C-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A5%BC-%EB%B0%9B%EB%8A%94-%EB%8B%A4%EC%96%91%ED%95%9C-%EB%B0%A9%EB%B2%95-RequestParam-RequestBody-PathVariable#4-map-%ED%99%9C%EC%9A%A9)
**간단한 JSON 데이터 응답** 하는데 사용함.

####  기본값
```java
//파라미터를 Map으로 조회
@ResponseBody  
@GetMapping("/request-param-map")  
public String requestParamMap(@RequestParam Map<String, Object> paramMap) {  
    log.info("username={}, age={}, gender={}", paramMap.get("username"), paramMap.get("age"), paramMap.get("gender"));  
    return "requestParamMap";  
}
```

▶ 요청 (1) -> 3개의 파라미터 모두 넣는 경우
`http://localhost:8086/request-param-map?username=kang&age=29&gender=man` 
![[Pasted image 20221222154227.png]]

▶ 결과 (1)
```
username=kang, age=29, gender=man
```


▶ 요청 (2) -> `gender`의 값을 안넣는 경우
`http://localhost:8086/request-param-map?username=kang&age=29`

▶ 결과 (2)
```
username=kang, age=29, gender=null
```


## @ModelAttribute (객체)
**HTTP 요청 파라미터를 해당 객체에 바인딩**

#### @ModelAttribute란?
- 객체를 생성하고, 요청 파라미터의 값을 프로퍼티 접근법(setXxx)으로 입력해줌. 즉 객체가 **Set함수**가 있어야함.
- 모델(Model)에 @ModelAttribute로 지정한 **객체를 자동으로 모델에 넣어줌**.
	- `@ModelAttribute("hello") Item item`   : 이름을 hello 로 지정 
	- `model.addAttribute("hello", item);` : 모델에 hello 이름으로 저장


#### 기본값
```java
@ResponseBody  
@RequestMapping("model-attribute-v2")  
public String modelAttributeV2(@ModelAttribute User user,  
                               Model model) {  
  
    model.addAttribute("user", user);  
  
    log.info("User username={}, age={}", user.getUsername(), user.getAge());  
  
    return "modelAttributeV2";  
}
```


▶`@RequestParam`로 나타내면?
```java
@ResponseBody  
@RequestMapping("model-attribute-v1")  
public String modelAttributeV1(@RequestParam String username,  
                               @RequestParam int age,  
                               Model model) {  
  
    User userA = new User(username, age);  
    model.addAttribute("user", userA);  
  
    log.info("User username={}, age={}", userA.getUsername(), userA.getAge());  
  
    return "modelAttributeV1";  
}
```
 `@ModelAttribute`보다 훨씬 복잡한 `@RequestParam`의 복잡한 코드가 생성됌.


## @RequestParam (옵션)
#### 요청 파라미터 값 ≠ 변수 값
`username`  -> `memberName`, `age` -> `memberAge`로 들어온 값을 각각 바인딩함.
```java
@ResponseBody  
@GetMapping("/request-param-variable")  
public String requestParamVariable(@RequestParam("username") String memberName, @RequestParam("age") int memberAge) {  
    log.info("username={}, age={}", memberName, memberAge);  
    return "requestParamAnotherVariable";  
}
```


#### 입력 유/무, 기본값을 설정
기타 설정(required는 필수 값, defaultValue는 기본 값)
```java
@GetMapping("/request-param-default")  
public String requestParamDefault(  
        @RequestParam(required = true, defaultValue = "guest") String username,  
        @RequestParam(required = false, defaultValue = "-1") int age) {  
    log.info("username={}, age={}", username, age);  
    return "ok";  
}
//출력 username=guest, age=-1
```
- `required` : 파라미터가 true면 요청 파라미터에 꼭 있어하는 것
- `defaultValue` : 값을 입력하지 않을 때, 기본 값 지정함.


## @PathVariable (URI 경로)
**URL 경로에 따라 동적**으로 변함.

#### 단일 경로
요청 매핑 : `http://localhost:8080/mapping/kang`
```java
@ResponseBody  
@GetMapping("/mappings/{data}")  
public String mappingPath(@PathVariable String data) {  
    log.info("mappingPath userId={}", data);  
    return "mappingPath";  
}
```


#### 다중 경로
요청 매핑 : `http://localhost:8080/mapping/kang/2`
```java
@ResponseBody  
@GetMapping("/mappings/{data}/{id}")  
public String mappingPathTwo(@PathVariable String data, @PathVariable("id") int num) {  
    log.info("mappingPath userId={} {}", data, num);  
    return "mappingPathTwo";  
}
```


#### 입력으로 경로
```html
<form th:action="@{'/mappings/' + data + '/' + id}" method="get"> 다중 경로(입력) :  
    data: <label>  
        <input type="text" name="data"/>  
    </label>    id: <label>  
        <input type="text" name="id"/>  
    </label>    <button type="submit">전송</button>  
</form>
```
타임리프를 이용해서 입력해서 갈 수 없었다.
`localhost:8086/mappings/23/11` 가 아닌
`localhost:8086/mappings/data/id?data=23&id=11` 이와 같이 url 매핑이 됌


# 응답 하기
## 1) view 반환
#### 다음 view 입력값 X
resources에 있는 html의 이름이 매칭하여 view를 찾고 랜더링함.
```java
@GetMapping("/newHome")  
public String newHome() {return "newHome";}
```


#### 다음 view 입력값 O
▶ThymeLeaf 사용 O
```java
//view 반환 : 다음 view 입력값 O (Model X)
@GetMapping("/addMemberFail")  
public String addMemberFail() {  
    return "formMember";  
}
```

- formMember
```html
...
<form th:action="@{/submit}" th:object = "${member}" method="post">  
    이름: <input type="text" th:field ="*{name}"><br>  
    이메일: <input type="text" th:field ="*{email}"><br>  
    <input type="submit" value="전송">  
</form>
...
```
thymeleaf를 이용할땐, view 변수값에 바인딩해야하기 때문에 model에 값을 넘겨주지 않으면 오류남.

▶ThymeLeaf 사용 X
```java
@GetMapping("/formMemberNoThyme")  
public String addMemberFailNoThymeleaf() {  
    return "formMemberNoThyme";  
}
```

- formMemberNoThymleaf
```html
<form action="/submit" method="post">  
    이름: <input type="text" name ="name"><br>  
    이메일: <input type="text" name ="email"><br>  
    <input type="submit" value="전송">  
</form>
```
기본 html을 사용해, model을 넘겨주지 않아서 view가 작동하고 값도 정상적으로 전달된다.


## 2) json 반환
view를 찾는 것이 아니라, **Http 메시지 바디에 바로 입력**함.
```java
@ResponseBody  
@RequestMapping("/newHello-go")  
public String newGoHome() {return "newHello-go";}
```
클래스에 `@RestController`가 있어도 같은 결과가 나온다.


## 3) HTTP 응답
#### response 정상 응답
GET 요청에 대해 상태 코드 200 (OK)와 함께 "Hello, World!"라는 메시지를 반환
```java
@GetMapping("/response1")  
public ResponseEntity<String> example1() {  
    return new ResponseEntity<>("Hello, World!", HttpStatus.OK);  
}
```
`ResponseEntity<T>`는 HTTP 응답의 본문(body), 상태 코드(status code), 헤더(headers) 등을 포함하는 클래스
![[Pasted image 20231201234836.png]]

#### response 예외 응답
```java
@GetMapping("/response2")  
public ResponseEntity<String> example2() {  
    return new ResponseEntity<>("Bad Test", HttpStatus.BAD_REQUEST);  
}
```

![[Pasted image 20231201234739.png]]


#### 오류 반환
GET 요청에 대해 상태 코드 400 (Bad Request)와 함께 "Bad Request"라는 메시지를 반환
```java
@GetMapping("/response3")  
public void example3(HttpServletResponse response) throws IOException {  
    response.sendError(HttpServletResponse.SC_FORBIDDEN, "Bad Request!!!!");  
}
```

![[Pasted image 20231201235459.png]]
