# Persisting Authentication(지속적 인증)
사용자가 보호된 자원을 처음 요청할 때, 그들에게는 자격 증명을 입력하라는 메시지가 나타납니다. 가장 일반적으로 사용자에게 로그인 페이지로 리디렉션하여 자격 증명을 요청하는 방법이 있습니다. 인증되지 않은 사용자가 보호된 리소스를 요청하는 경우 HTTP 교환의 개요는 다음과 같습니다:

▶예제 1. 인증되지 않은 사용자가 보호된 리소스를 요청함 
```http
GET / HTTP/1.1
Host: example.com
Cookie: SESSION=91470ce0-3f3c-455b-b7ad-079b02290f7b
```
```http
HTTP/1.1 302 Found
Location: /login
```

사용자는 사용자 이름과 비밀번호를 제출합니다.

▶사용자 이름과 비밀번호 제출됨
```http
POST /login HTTP/1.1
Host: example.com
Cookie: SESSION=91470ce0-3f3c-455b-b7ad-079b02290f7b

username=user&password=password&_csrf=35942e65-a172-4cd4-a1d4-d16a51147b3e
```

사용자를 인증한 후, 세션 고정 공격을 방지하기 위해 사용자는 새로운 세션 ID와 연결됩니다.

▶인증된 사용자가 새로운 세션에 연결됨 
```http
HTTP/1.1 302 Found
Location: /
Set-Cookie: SESSION=4c66e474-3f5a-43ed-8e48-cc1d8cb1d1c8; Path=/; HttpOnly; SameSite=Lax
```

이후의 요청들은 세션 쿠키를 포함하며 이는 세션 동안 사용자를 인증하는 데 사용됩니다.

▶인증된 세션이 자격 증명으로 제공됨
```http
GET / HTTP/1.1
Host: example.com
Cookie: SESSION=4c66e474-3f5a-43ed-8e48-cc1d8cb1d1c8
```

# SecurityContextRepository
Spring Security에서 사용자를 향후 요청에 연결하는 것은 `SecurityContextRepository`를 사용하여 이루어집니다. `SecurityContextRepository`의 기본 구현체는 `DelegatingSecurityContextRepository`로, 다음에 위임합니다:

- HttpSessionSecurityContextRepository
- RequestAttributeSecurityContextRepository

## HttpSessionSecurityContextRepository

`HttpSessionSecurityContextRepository`는 `SecurityContext`를 `HttpSession`에 연결합니다. 사용자가 원한다면 `HttpSessionSecurityContextRepository`를 다른 `SecurityContextRepository` 구현체로 대체하여 사용자를 후속 요청에 다른 방식으로 연결하거나 전혀 연결하지 않을 수 있습니다.

## NullSecurityContextRepository

만약 SecurityContex t를 HttpSession에 연결하는 것이 바람직하지 않은 경우 (즉, OAuth로 인증할 때), NullSecurit yContex tRepositor y는 아무런 작업도 수행하지 않는 Securit yContex tRepositor y의 구현체입니다.

## RequestAttributeSecurityContextRepository 

RequestAttributeSecuri tyCon textRe pository 는 요청 속성으로 Securit yContex t을 저장하여 dispatch 유형이 변경되어도 단일 요청 동안  Securit yContex t가 유지되도록 합니다.


예제 코드:
```java
public SecurityFilterChain filterChain(HttpSecuri ty http) {
	http
		// ...
		.securityCon text((securityCon text) -> securityCon text
			.securityCon textRe pository(new RequestAttri buteSecuri tyCon textRe pository())
		);
	return http.build();
}
````