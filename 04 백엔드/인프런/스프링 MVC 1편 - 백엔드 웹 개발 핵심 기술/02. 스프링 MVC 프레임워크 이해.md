## ì§ì ‘ ë§Œë“  MVCì™€ ìŠ¤í”„ë§ MVCì™€ ë¹„êµ

#### ğŸ“Œê·¸ë¦¼ìœ¼ë¡œ ë¹„êµí•˜ê¸°
![[Pasted image 20221219213807.png]]

#### ğŸ“Œìš©ì–´ ì •ë¦¬  
- handleë€? **ë³€í™˜í•˜ê¸° ì „ URI ì •ë³´**  
- adapterë€? handleë¥¼ ì•Œë§ì€ **íƒ€ì…ìœ¼ë¡œ ë³€í™˜**ì‹œí‚¤ê¸° ìœ„í•œ ë©”ì†Œë“œ  
- ModelAndView -> View ì´ë¦„, Viewë¥¼ ë Œë”ë§í•  ë•Œ í•„ìš”í•œ Model ê°ì²´ë‚˜ String(**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬í•œë°ì´í„°**)  
- viewResolver -> **Viewì´ë¦„ì„ URIë¡œ ë§Œë“¤ê¸° ìœ„í•œ ë©”ì†Œë“œ**(ë Œë”ë§í•˜ê¸° ìœ„í•¨)  

#### ğŸ“Œë§¤ì»¤ë‹ˆì¦˜ ì •ë¦¬  
1) í•¸ë“¤ëŸ¬ ì¡°íšŒ  
- í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ í†µí•´ ìš”ì²­ URLì— ë§¤í•‘ëœ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ë¥¼ ì¡°íšŒí•œë‹¤.  
- url ë¿ë§Œ ì•„ë‹ˆë¼ content-type ë“± ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í™•ì¸í•œë‹¤.  

2) í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì¡°íšŒ  
-  í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì¡°íšŒí•œë‹¤.  

3) í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì‹¤í–‰  
- í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì‹¤í–‰í•œë‹¤.  

4) ModelAndView ë°˜í™˜  
-  í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ëŠ” í•¸ë“¤ëŸ¬ê°€ ë°˜í™˜í•˜ëŠ” ì •ë³´ë¥¼ ModelAndViewë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•œë‹¤.  

5) viewResolver í˜¸ì¶œ  
- viewResolverë¥¼ ì°¾ê³  í˜¸ì¶œí•œë‹¤.  
- JSPëŠ” InternalResourceViewResolverê°€ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ì‚¬ìš©ëœë‹¤.  

6) View ë°˜í™˜  
- viewResolverëŠ” viewì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë¬¼ë¦¬ ì´ë¦„ìœ¼ë¡œ ë°”ê¾¸ê³  ë Œë”ë§ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” View ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.  
- JSPëŠ” InternalResourceViewë¥¼ ë°˜í•œí•˜ë©° ì´ ë‚´ë¶€ì— forward() ë¡œì§ì´ ìˆë‹¤.  

7) view ë Œë”ë§  
- Viewë¥¼ í†µí•´ viewë¥¼ ë Œë”ë§í•œë‹¤.  


#### ğŸ“Œ<ì½”ë“œ> ì§ì ‘ë§Œë“  MVC í”„ë ˆì„ì›Œí¬
```java
@WebServlet(name = "frontControllerServletV5", urlPatterns = "/front-controller/v5/*")  
public class FrontControllerServletV5 extends HttpServlet {  
  
    private final Map<String, Object> handlerMappingMap = new HashMap<>();  
    private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();  
  
    public FrontControllerServletV5() {  
        initHandlerMappingMap();  
        initHandlerAdapters();  
    }  

    //0.í•¸ë“¤ëŸ¬ ë“±ë¡í•˜ê¸°  
    private void initHandlerMappingMap() {  
	    //V3 ì¶”ê°€
        handlerMappingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());  
        handlerMappingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());  
        handlerMappingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());  
  
        //V4 ì¶”ê°€  
        handlerMappingMap.put("/front-controller/v5/v4/members/new-form", new MemberFormControllerV4());  
        handlerMappingMap.put("/front-controller/v5/v4/members/save", new MemberSaveControllerV4());  
        handlerMappingMap.put("/front-controller/v5/v4/members", new MemberListControllerV4());  
    }  
  
    //0.ì–´ëŒ‘í„° ë“±ë¡í•˜ê¸°  
    private void initHandlerAdapters() {  
        handlerAdapters.add(new ControllerV3HandlerAdapter());  
        handlerAdapters.add(new ControllerV4HandlerAdapter());  
    }  
  
    @Override  
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {  
        //1.URLì— í•´ë‹¹í•˜ëŠ” í•¸ë“¤ëŸ¬ ì–»ê¸°. ì—†ìœ¼ë©´ 404 ì˜¤ë¥˜í˜ì´ì§€  
        Object handler = getHandler(request);  
        if (handler == null) {  
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);  
            return;        }  
  
        //3.í•¸ë“¤ëŸ¬ì— ë§ëŠ” ì–´ëŒ‘í„° ì°¾ê¸°  
        MyHandlerAdapter adapter = getHandlerAdapter(handler);  
  
        //4.í•¸ë“¤ëŸ¬ í˜¸ì¶œí•´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ ìˆ˜í–‰í•˜ê¸°  
        ModelView mv = adapter.handle(request, response, handler);  
  
        //5.ModelViewì—ì„œ ê°’ ë°˜í™˜í•˜ê¸°  
        String viewName = mv.getViewName();  
        //6~7.viewResolver í˜¸ì¶œí•´ì„œ í•´ë‹¹í•˜ëŠ” ë·° ë°˜í™˜í•˜ê¸°   
		MyView view = viewResolver(viewName);  
  
        //8.view ëœë”ë§í•˜ê¸°  
        view.render(mv.getModel(), request, response);  
  
    }  


    private Object getHandler(HttpServletRequest request) {  
        String requestURI = request.getRequestURI();  
        return handlerMappingMap.get(requestURI);  
    }  


    private MyHandlerAdapter getHandlerAdapter(Object handler) {  
        //MemberFormControllerV4  
        for (MyHandlerAdapter adapter : handlerAdapters) {  
            if (adapter.supports(handler)) {  
                return adapter;  
            }  
        }  
        throw new IllegalArgumentException("handler adapterë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. handler=" + handler);  
    }  


    private MyView viewResolver(String viewName) {  
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");  
    }  
}
```


#### ğŸ“Œ<ì½”ë“œ> ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” DispatcherServlet
```java
protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {  
  
    HttpServletRequest processedRequest = request;  
    HandlerExecutionChain mappedHandler = null;  
    ModelAndView mv = null;  
  
    // 1. í•¸ë“¤ëŸ¬ ì¡°íšŒ  
    mappedHandler = getHandler(processedRequest);  
    if (mappedHandler == null) {  
        noHandlerFound(processedRequest, response);  
        return;    
    }  
  
    //2.í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì¡°íšŒ-í•¸ë“¤ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì–´ëŒ‘í„°  
    HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());  
  
    // 3. í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì‹¤í–‰ -> 4. í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ í†µí•´ í•¸ë“¤ëŸ¬ ì‹¤í–‰ -> 5. ModelAndView ë°˜í™˜   
	mv = ha.handle(processedRequest, response, mappedHandler.getHandler());  
  
    processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);  
}  


private void processDispatchResult(HttpServletRequest request, HttpServletResponse response, HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception) throws Exception {  
    // ë·° ë Œë”ë§ í˜¸ì¶œ  (ë Œë”ë§ í•œë‹¤ëŠ” ì‚¬ì‹¤ì´ ì¤‘ìš”!!!)
    render(mv, request, response); 
}  
  
protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)  
throws Exception {  
    View view;  
    String viewName = mv.getViewName();  
  
    //6. ë·° ë¦¬ì¡¸ë²„ë¥¼ í†µí•´ì„œ ë·° ì°¾ê¸°, 7.View ë°˜í™˜  
    view = resolveViewName(viewName, mv.getModelInternal(), locale, request);  
  
    // 8. ë·° ë Œë”ë§  
    view.render(mv.getModelInternal(), request, response);  
}
```

## ìŠ¤í”„ë§ ìš©ì–´ ì„¤ëª…
ì¶œì²˜ : [[Spring JPA] @RestController / @ResponseBody / @RequestBody](https://frogand.tistory.com/24)

#### ğŸ“Œ@RequestMapping
-   í•¸ë“¤ëŸ¬ ë§¤í•‘ (RequestMappingHandlerMapping) + í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ë§¤í•‘(RequestMappingHandlerAdapter) 
- RequestMappingHandlerMapping ì€ ìŠ¤í”„ë§ ë¹ˆ ì¤‘ì—ì„œ @RequestMapping ë˜ëŠ” @Controller ê°€ í´ë˜ìŠ¤ ë ˆë²¨ì— ë¶™ì–´ ìˆëŠ” ê²½ìš°ì— ë§¤í•‘ ì •ë³´ë¡œ ì¸ì‹í•œë‹¤
-  **URI ë§¤ì¹­ + HTTP Method**

#### ğŸ“Œ@Controller
-   **ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡**í•œë‹¤.  (ë‚´ë¶€ì— @Component ì¡´ì¬í•¨)
-  Â Model ê°ì²´ë¥¼ ë§Œë“¤ì–´ **ë°ì´í„°ë¥¼ ë‹´ê³  Viewë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©**í•œë‹¤.

#### ğŸ“Œ@ResponseBody
- ì£¼ë¡œ **ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©**í•œë‹¤.
- @Controllerì™€ ë‹¤ë¥´ê²Œ Viewë¥¼ ê±°ì¹˜ì§€ ì•Šê³ , Controllerì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ë¦¬í„´í•˜ëŠ” ê²ƒì´ íŠ¹ì§•ì´ë‹¤.

#### ğŸ“Œ@RestController  
- @RestController = (**@Controller + @ResponseBody**) í˜•íƒœ
- ì£¼ë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ë©°, @ResponseBodyì™€ ë™ì¼í•œ ê³¼ì •

#### ğŸ“Œ@RequestParam  
- **Http ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ**

#### ğŸ“ŒModelAndView  
-   **Viewì— ë¦¬ì¡¸ë²„í•  ì´ë¦„ì„ ë§Œë“¤ê³  Modelì— ë·°ë¡œ ë³´ë‚¼ ë°ì´í„°ë¥¼ ë„£ìŒ.**
```java
ModelAndView mv = new ModelAndView("save-result"); //ë·°ì˜ ì´ë¦„ì„ ì˜ë¯¸
mv.addObject("member", member);  //ë·°ë¡œ ë³´ë‚¼ ë°ì´í„°ê°’
return mv
```


## ìŠ¤í”„ë§ MVC ì ìš©í•˜ê¸°
#### ğŸ“Œ<ì½”ë“œ> ModelAndViewë¥¼ ì´ìš©í•œ íšŒì› ë“±ë¡ í¼ë§Œë“¤ê¸°
```java
@Controller  
@RequestMapping("/springmvc/v2/members")  
public class SpringMemberControllerV2 {  
  
    private MemberRepository memberRepository = MemberRepository.getInstance();  
  
    @RequestMapping("/new-form")  
    public ModelAndView newForm() {  
        return new ModelAndView("new-form");  
    }  
  
    @RequestMapping("/save")  
    public ModelAndView save(HttpServletRequest request, HttpServletResponse response) {  
        String username = request.getParameter("username");  
        int age = Integer.parseInt(request.getParameter("age"));  
  
        Member member = new Member(username, age);  
        memberRepository.save(member);  
  
        ModelAndView mv = new ModelAndView("save-result");  
        mv.addObject("member", member);  
        return mv;  
    }  
  
    @RequestMapping  
    public ModelAndView members() {  
  
        List<Member> members = memberRepository.findAll();  
  
        ModelAndView mv = new ModelAndView("members");  
        mv.addObject("members", members);  
        return mv;  
    }  
}
```

#### ğŸ“Œ<ì½”ë“œ>ì‹¤ìš©ì  ë°©ì‹ì˜ íšŒì› ë“±ë¡ í¼ë§Œë“¤ê¸°

```java
@Controller  
@RequestMapping("/springmvc/v3/members")  
public class SpringMemberControllerV3 {  
  
    private MemberRepository memberRepository = MemberRepository.getInstance();  
  
    @GetMapping("/new-form")  
    public String newForm() {  
        return "new-form";  
    }  
  
    @PostMapping("/save")  
    public String save(  
            @RequestParam("username") String username,  
            @RequestParam("age") int age,  
            Model model) {  
  
        Member member = new Member(username, age);  
        memberRepository.save(member);  
  
        model.addAttribute("member", member);  
        return "save-result";  
    }  
  
    @GetMapping  
    public String members(Model model) {  
  
        List<Member> members = memberRepository.findAll();  
  
        model.addAttribute("members", members);  
        return "members";  
    }  
}
```
