ë§í¬ : [[ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬  ê¸°ë³¸í¸.pdf]]
í•´ì‹œíƒœí¬ : #ë¹ˆìŠ¤ì½”í”„

----

## ë¹ˆ ìŠ¤ì½”í”„ë€?
- ìŠ¤ì½”í”„ëŠ” ë²ˆì—­ ê·¸ëŒ€ë¡œ ë¹ˆì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ë²”ìœ„ë¥¼ ëœ»í•œë‹¤.(ë³€ìˆ˜ í—ˆìš© ë²”ìœ„ë‘ ê°œë… ê°™ìŒ)  


## ìŠ¤ì½”í”„ì˜ ì¢…ë¥˜
- ì‹±ê¸€í†¤: ê¸°ë³¸ ìŠ¤ì½”í”„, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ì¢…ë£Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ê°€ì¥ ë„“ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„ì´ë‹¤.  
- í”„ë¡œí† íƒ€ì…: ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€ë§Œ ê´€ì—¬í•˜ê³  ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ë§¤ìš° ì§§ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„ì´ë‹¤.  
- request(ì›¹ ê´€ë ¨ ìŠ¤ì½”í”„) : ì›¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„ì´ë‹¤.


## [ì½”ë“œ] ìŠ¤ì½”í”„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
```java
@Scope("prototype")
@Component
pubilc class HelloBean(){
}
```


## í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì´ë€?
í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¡°íšŒí•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” **í•­ìƒ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜**

#### ğŸ“Œí”„ë¡œí† íƒ€ì… ë¹ˆì˜ íŠ¹ì§•
-   ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì… ê·¸ë¦¬ê³  **ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬**í•œë‹¤.  
-   **ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.**  why?ê·¸ë˜ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì¡°íšŒí•œ í´ë¼ì´ì–¸íŠ¸ê°€ ê´€ë¦¬í•´ì•¼ í•œë‹¤. ì¢…ë£Œ ë©”ì„œë“œì— ëŒ€í•œ í˜¸ì¶œë„ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í•´ì•¼í•œë‹¤.


## í”„ë¡œí†  íƒ€ì… ìŠ¤ì½”í”„ ë™ì‘ ê³¼ì •ì€?
![[Pasted image 20221216215432.png]]
![[Pasted image 20221216215440.png]]
-   1. í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— **ìš”ì²­**í•œë‹¤.  
-   2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì´ ì‹œì ì— í”„ë¡œí† íƒ€ì… **ë¹ˆì„ ìƒì„±**í•˜ê³ , í•„ìš”í•œ **ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…**í•œë‹¤.  
-   3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í´ë¼ì´ì–¸íŠ¸ì— **ë°˜í™˜**í•œë‹¤.  
-   4. ì´í›„ì— **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê°™ì€ ìš”ì²­ì´ ì˜¤ë©´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ ë°˜í™˜**í•œë‹¤.


## í”„ë¡œí† íƒ€ì… ë¹ˆì™€ ì‹±ê¸€í†¤ ë¹ˆ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì 
- ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„± ì‹œì ì—ë§Œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ë°›ê¸° ë•Œë¬¸ì—, í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒˆë¡œ ìƒì„±ë˜ê¸°ëŠ” í•˜ì§€ë§Œ, ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ê³„ì† ìœ ì§€ë˜ëŠ” ê²ƒì´ ë¬¸ì œì  ë°œìƒ

#### ğŸ“ŒCountì„ ì´ìš©í•œ ì˜ˆì‹œ
- ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆì•ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í–ˆì„ë•Œ ì¹´ìš´íŠ¸ê°€ ì˜¬ë¼ê°€ëŠ” ì˜ˆì‹œ
![[Pasted image 20221216221005.png]]
![[Pasted image 20221216221008.png]]
![[Pasted image 20221216221011.png]]
=> 2ë¡œ ì¦ê°€í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ 1ë¡œ ê³„ì† ìœ ì§€í•´ì•¼í•¨.

#### ğŸ“Œ <ì½”ë“œ> ê·¸ë¦¼ì„ ì½”ë“œë¡œ êµ¬í˜„í•˜ê¸°
-  í…ŒìŠ¤íŠ¸ ì½”ë“œ
```java
public class SingletonWithPrototypeTest1 {  
    @Test  
    void singletonClientUsePrototype() {  
        // ClientBean, PrototypeBean ë‘˜ ë‹¤ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ í•´ì¤˜ì•¼ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤.  
        ApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);  
  
        ClientBean clientBean1 = ac.getBean(ClientBean.class);  
        int count1 = clientBean1.logic();  
        assertThat(count1).isEqualTo(1);  
  
        ClientBean clientBean2 = ac.getBean(ClientBean.class);  
        int count2 = clientBean2.logic();  
        assertThat(count2).isEqualTo(2);  
    }  
  
    @Scope("singleton")  
    static class ClientBean {  
        // ìƒì„± ì‹œì ì— ì´ë¯¸ ì£¼ì…ë˜ì–´ ê³„ì† ê°™ì€ ê±¸ ì“°ê²Œ ëœë‹¤.  
        private final PrototypeBean prototypeBean;  
  
        @Autowired  
        public ClientBean(PrototypeBean prototypeBean) {  
            this.prototypeBean = prototypeBean;  
        }  
  
        public int logic() {  
            prototypeBean.addCount();  
            return prototypeBean.getCount();  
        }  
    }  
  
    @Scope("prototype")  
    static class PrototypeBean {  
  
        private int count = 0;  
  
        public void addCount() {  
            count++;  
        }  
  
        public int getCount() {  
            return count;  
        }  
    }  
}
```


## <ì½”ë“œ> í•´ê²°ë²•
ì‹±ê¸€í†¤ ë¹ˆê³¼ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ, ì–´ë–»ê²Œ í•˜ë©´ **ì‚¬ìš©í•  ë•Œë§ˆë‹¤ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±**í•  ìˆ˜ ìˆì„ê¹Œ?
- í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•  ë•Œ ë§ˆë‹¤ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìƒˆë¡œ ìš”ì²­
```java
static class ClientBean {  
    @Autowired  
    private ApplicationContext ac;  
    
    public int logic() {  
        PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);  
        prototypeBean.addCount();  
        int count = prototypeBean.getCount();  
        return count;  
    }  
}
```
=> ê·¸ëŸ°ë° ì´ë ‡ê²Œ ìŠ¤í”„ë§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ì „ì²´ë¥¼ ì£¼ì…ë°›ê²Œ ë˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¢…ì†ì ì¸ ì½”ë“œê°€ ë˜ê³ , ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ì›Œì§.


- ì§€ì •í•œ ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” DL ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì½”ë“œ
```java
static class ClientBean {  
    @Autowired  
    private ObjectProvider<PrototypeBean> prototypeBeanProvider;  
    
    public int logic() {  
        PrototypeBean prototypeBean = prototypeBeanProvider.getObject();  
        prototypeBean.addCount();  
        int count = prototypeBean.getCount();  
        return count;  
    }  
}
```
=> ObjectProvider ì˜ getObject() ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆë§Œì„ ì°¾ì•„ì„œ ë°˜í™˜í•œë‹¤.


## ì›¹ìŠ¤ì½”í”„ë¥¼ ì“°ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ?
ë™ì‹œì— ì—¬ëŸ¬ HTTP ìš”ì²­ì´ ì˜¤ë©´ ì •í™•íˆ ì–´ë–¤ ìš”ì²­ì´ ë‚¨ê¸´ ë¡œê·¸ì¸ì§€ êµ¬ë³„í•˜ê¸° ì–´ë µë‹¤. ê·¸ë˜ì„œ HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„, **ê°ê°ì˜ HTTP ìš”ì²­ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³ , ê´€ë¦¬**ëœë‹¤.

#### ğŸ“ŒíŠ¹ì§•
-   ì›¹ ìŠ¤ì½”í”„ëŠ” **ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘**í•œë‹¤.  
-   ì›¹ ìŠ¤ì½”í”„ëŠ” í”„ë¡œí† íƒ€ì…ê³¼ ë‹¤ë¥´ê²Œ ìŠ¤í”„ë§ì´ í•´ë‹¹ ìŠ¤ì½”í”„ì˜ **ì¢…ë£Œì‹œì ê¹Œì§€ ê´€ë¦¬**í•œë‹¤. ë”°ë¼ì„œ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.


## ì›¹ ìŠ¤ì½”í”„ ì¢…ë¥˜
- request: HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„, ê°ê°ì˜ HTTP ìš”ì²­ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³ , ê´€ë¦¬ëŒ
- session: HTTP Sessionê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- application: ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸( ServletContext )ì™€ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- websocket: ì›¹ ì†Œì¼“ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„

[ì›¹ ìŠ¤ì½”í”„(Scope)ì™€ í”„ë¡ì‹œ ê¸°ìˆ  (tistory.com)](https://taehoung0102.tistory.com/143)


## â›ì›¹ìŠ¤ì½”í”„ ë™ì‘ê³¼ì •ì€?

![[Pasted image 20221216230356.png]]