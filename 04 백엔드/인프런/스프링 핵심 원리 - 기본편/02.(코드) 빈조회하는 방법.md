ë§í¬ : [[ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬  ê¸°ë³¸í¸.pdf]] (page. 49)
í•´ì‹œíƒœí¬ : #ë¹ˆ
ë§ˆì§€ë§‰ ë³µìŠµ : #23/01/31
í•´ë‹¹ í”„ë¡œì íŠ¸ : mvc1/test/java/corespring/corespring/beandfind

----
#### ğŸ“Œëª¨ë“  ë¹ˆ ì¡°íšŒí•˜ëŠ” ë°©ë²•
```java
public class ApplicationContextInfoTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

  @Test
  @DisplayName("ëª¨ë“  ë¹ˆ ì¶œë ¥í•˜ê¸°")
  void findAllBean() {
    // ìŠ¤í”„ë§ì— ë“±ë¡ëœ ëª¨ë“  ë¹ˆ ì´ë¦„ì„ ì¡°íšŒí•œë‹¤.
    String[] beanDefinitionNames = ac.getBeanDefinitionNames();
    for (String beanDefinition : beanDefinitionNames) {
      // ë¹ˆ ì´ë¦„ìœ¼ë¡œ ë¹ˆ ê°ì²´(ì¸ìŠ¤í„´ìŠ¤)ë¥¼ ì¡°íšŒí•œë‹¤.
      Object bean = ac.getBean(beanDefinition);
      System.out.println("beanDefinition = " + beanDefinition + ", object = " + bean);
    }
  }
}
```
=> ac.getBean([ë¹ˆ ì´ë¦„], íƒ€ì…)ì„ ì´ìš©í•´ì„œ ë¹ˆì„ ì¡°íšŒí•˜ì§€ë§Œ í•˜ë‚˜ì”©ë§Œ ì¡°íšŒê°€ëŠ¥, ë‘ê°œ ì´ìƒì´ë©´ ë¹ˆ ì´ë¦„ì„ í†µí•´ì„œ êµ¬ì²´í™”ì‹œì¼œì¤˜ì•¼í•¨.

- ì¶œë ¥
![[Pasted image 20221214210753.png]]


#### ğŸ“Œì§ì ‘ ë“±ë¡í•œ ë¹ˆë§Œ ì¶œë ¥
```java
public class ApplicationContextInfoTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

  @Test
  @DisplayName("ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹ˆ ì¶œë ¥í•˜ê¸°")
  void findApplicationBean() {
    String[] beanDefinitionNames = ac.getBeanDefinitionNames();
    for (String beanDefinitionName : beanDefinitionNames) {
      BeanDefinition beanDefinition = ac.getBeanDefinition(beanDefinitionName);

      // ROLE_APPLICATION: ì§ì ‘ ë“±ë¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹ˆ
      // ROLE_INFRASTRUCTURE: ìŠ¤í”„ë§ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¹ˆ
      if (beanDefinition.getRole() == BeanDefinition.ROLE_APPLICATION) {
        Object bean = ac.getBean(beanDefinitionName);
        System.out.println("name = " + beanDefinitionName + ", object = " + bean);
      }
    }
  }
}
```
![[Pasted image 20221214210735.png]]


#### ğŸ“Œë¹ˆ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒí•˜ê¸°
```java
public class ApplicationContextBasicFindTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

  @Test
  @DisplayName("ë¹ˆ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ")
  void findBeanByName() {
    MemberService memberService = ac.getBean("memberService", MemberService.class);
    assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
  }
}
```


#### ğŸ“Œíƒ€ì…ìœ¼ë¡œë§Œ ì¡°íšŒ
```java
public class ApplicationContextBasicFindTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

  @Test
  @DisplayName("ì´ë¦„ ì—†ì´ íƒ€ì…ìœ¼ë¡œë§Œ ì¡°íšŒ")
  void findBeanByType() {
    MemberService memberService = ac.getBean(MemberService.class);
    assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
  }
}
```

#### ğŸ“Œêµ¬í˜„ì²´ íƒ€ì…ìœ¼ë¡œë§Œ ì¡°íšŒ
```java
public class ApplicationContextBasicFindTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

  @Test
  @DisplayName("êµ¬ì²´ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ")
  void findBeanByName2() {
    MemberService memberService = ac.getBean(MemberServiceImpl.class);
    assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
  }
}
```
=>ê¸°ë³¸ì ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì¡°íšŒí•˜ë©´ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ê°€ ì¡°íšŒ ëŒ€ìƒì´ ëœë‹¤.  ê·¸ë˜ì„œ ì´ë ‡ê²Œ ì§ì ‘ êµ¬í˜„ì²´ë¡œ ë¹ˆì„ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆë‹¤.


#### ğŸ“Œì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¹ˆ ì¡°íšŒí•˜ë©´?
```java
public class ApplicationContextBasicFindTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

  @Test
  @DisplayName("ë¹ˆ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ ì‹¤íŒ¨")
  void findBeanByNameFail() {
    assertThrows(NoSuchBeanDefinitionException.class,
        () -> ac.getBean("ì—†ëŠ” ë¹ˆ", MemberServiceImpl.class));
  }
}
```
=>` NoSuchBeanDefinitionException` ì—ëŸ¬ ë°œìƒ


#### ğŸ“Œê°™ì€ íƒ€ì…ì˜ ìŠ¤í”„ë§ ë¹ˆì´ ë‘˜ ì´ìƒì´ë©´ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•˜ë©´?
```java
public class ApplicationContextSameBeanTest {

  AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(SameBeanConfig.class);

  @Test
  @DisplayName("íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•  ë•Œ ë‘˜ ì´ìƒì´ ìˆìœ¼ë©´ ì¤‘ë³µ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.")
  void findBeanByTypeDuplicate() {
  assertThrows(NoUniqueBeanDefinitionException.class,
        () -> ac.getBean(MemberRepository.class));
  }
}
```
=> `NoUniqueBeanDefinitionException` ì—ëŸ¬ ë°œìƒ

- config ì„¤ì •
```java
@Configuration
static class SameBeanConfig{
	@Bean
	public MemberRepository memberRepository1() {
	  return new MemoryMemberRepository();
	}
	
	@Bean
	public MemberRepository memberRepository2() {
	  return new MemoryMemberRepository();
	}
}
```


#### ğŸ“ŒíŠ¹ì • íƒ€ì… ëª¨ë‘ ì¡°íšŒ
```java
public class ApplicationContextSameBeanTest {

  @Test
  @DisplayName("íŠ¹ì • íƒ€ì…ì„ ëª¨ë‘ ì¡°íšŒí•œë‹¤.")
  void findAllBeanByType() {
    Map<String, MemberRepository> beansOfType = ac.getBeansOfType(MemberRepository.class);

    for (String key : beansOfType.keySet()) {
      System.out.println("key = " + key + " value = " + beansOfType.get(key));
    }

    System.out.println("beansOfType = " + beansOfType);
    assertThat(beansOfType.size()).isEqualTo(2);
  }
}
```

ê²°ê³¼
![[Pasted image 20221214213334.png]]


#### ğŸ“Œë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ëª¨ë“  ë¹ˆ ì¡°íšŒ
```java
public class ApplicationContextInheritanceTest {

  @Test
  @DisplayName("ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ëª¨ë“  ë¹ˆì„ ì¡°íšŒí•œë‹¤.")
  void findBeanByParentType() {
    Map<String, DiscountPolicy> beansOfType = ac.getBeansOfType(DiscountPolicy.class);

    for (String key : beansOfType.keySet()) {
      System.out.println("key = " + key + ", value = " + beansOfType.get(key));
    }

    assertThat(beansOfType.size()).isEqualTo(2);
  }

}
```

ì¶œë ¥
![[Pasted image 20221214213740.png]]


#### ğŸ“ŒObject íƒ€ì…ìœ¼ë¡œ ëª¨ë“  ë¹ˆ ì¡°íšŒ 
```java
public class ApplicationContextInheritanceTest {

  @Test
  @DisplayName("Object íƒ€ì…ìœ¼ë¡œ ëª¨ë“  ë¹ˆì„ ì¡°íšŒí•œë‹¤.")
  void findBeanByObject() {
    Map<String, Object> beansOfType = ac.getBeansOfType(Object.class);

    for (String key : beansOfType.keySet()) {
      System.out.println("key = " + key + ", value = " + beansOfType.get(key));
    }
  }

}
```

ì¶œë ¥
![[Pasted image 20221214213805.png]]

#### ğŸ“ŒList, Mapë¥¼ ì´ìš©í•œ ë¹ˆ ëª¨ë‘ ì¡°íšŒ
- ex) í• ì¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ë°, í´ë¼ì´ì–¸íŠ¸ê°€ í• ì¸ì˜ ì¢…ë¥˜(rate, fix)ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•´ë³´ì

```java
public class AllBeanTest {

  @Test
  void findAllBean() {
    // ë‘ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
    ApplicationContext ac = new AnnotationConfigApplicationContext(AutoAppConfig.class,
        DiscountService.class);
  }

  static class DiscountService {
  
    private final Map<String, DiscountPolicy> policyMap;
    private final List<DiscountPolicy> policyList;

    // ë¹ˆì„ ë“±ë¡í•  ë•Œ ë§µê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì£¼ì…ë°›ëŠ”ë‹¤.
    @Autowired
    public DiscountService(
        Map<String, DiscountPolicy> policyMap,
        List<DiscountPolicy> policyList) {
      this.policyMap = policyMap;
      this.policyList = policyList;

      System.out.println("policyMap = " + policyMap);
      System.out.println("policyList = " + policyList);
    }
  }
}
```

- ì¶œë ¥
![[Pasted image 20221216003357.png]]
=> `DiscountPolicy`ì— ì†í•˜ëŠ” `FixDiscountPolicy`ì™€ `RateDiscountPolicy`ê°€ ëª¨ë‘ ì£¼ì…ë˜ì—ˆë‹¤. `Map<String, DiscountPolicy>`ì€ í‚¤ì— ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„, ê°’ìœ¼ë¡œ `DiscountPolicy` íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•œ ëª¨ë“  ìŠ¤í”„ë§ ë¹ˆì´ ë‹´ê¸´ë‹¤. `List<DiscountPolicy>`ëŠ” `DiscountPolicy` íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•œ ëª¨ë“  ìŠ¤í”„ë§ ë¹ˆì„ ë‹´ì•„ì¤€ë‹¤.