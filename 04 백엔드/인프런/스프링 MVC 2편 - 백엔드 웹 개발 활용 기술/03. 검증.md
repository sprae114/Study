ë§í¬ : [[ìŠ¤í”„ë§ mvc 2í¸.pdf]] (page. 97, 136)
í•´ì‹œíƒœí¬ : #ê²€ì¦

----

## ê²€ì¦ ë°°ê²½ ì§€ì‹
#### âœ” í•´ì•¼í•  ê²€ì¦ ì¢…ë¥˜ëŠ”?
1) **íƒ€ì… ê²€ì¦** => ì›í•˜ëŠ” íƒ€ì…ë§Œ ë“¤ì–´ê°€ë„ë¡í•˜ëŠ” ê²€ì¦  
	 -   ê°€ê²© ì…ë ¥ì°½ì— ë¬¸ìê°€ ë“¤ì–´ê°€ëŠ” ê²½ìš°
2) **í•„ë“œ ê²€ì¦** => ìˆ«ìì¼ë•Œ, í•„ìˆ˜ ê°’ ë° ì›í•˜ëŠ” ë²”ìœ„ ì„¤ì •  
	-   ìƒí’ˆëª…: í•„ìˆ˜, ê³µë°±X  
	-   ê°€ê²©: 1000ì› ì´ìƒ, 1ë°±ë§Œì› ì´í•˜  
	-   ìˆ˜ëŸ‰: ìµœëŒ€ 9999  
3) **ì˜¤ë¸Œì íŠ¸ ê²€ì¦**(íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦) => ë‘ê°œ ì´ìƒì˜ í•„ë“œê°€ ë¡œì§ìœ¼ë¡œ ì´ë£¨ì–´ì§ˆë•Œ ë²”ìœ„ì„¤ì •  
	-   ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì¸ ê²½ìš°  
4) **API ê²€ì¦**  
    -   postmanê°™ì€ Httpìš”ì²­ìœ¼ë¡œ ë°ì´í„° ì¡°ì‘ê°€ëŠ¥


#### ğŸ“Œí´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê²€ì¦ì˜ ì°¨ì´ëŠ”?
-   í´ë¼ì´ì–¸íŠ¸ ê²€ì¦ : **ì¦‰ê°ì ì¸** ì‚¬ìš©ì„±ì´ ê°€ëŠ¥ ex)ë¹„ë²ˆì„ ì…ë ¥í–ˆì„ë•Œ, ê¸¸ì´ì™€ ì¡°í•©ì´ ì•ˆëœë‹¤ê³  ì•Œë ¤ì¤Œ.
-   ì„œë²„ ê²€ì¦ : **httpsìš”ì²­**ì„ í•´ì•¼ ì‘ë‹µì´ ê°€ëŠ¥í•´ì•¼í•˜ì§€ë§Œ, ë³´ì•ˆì„± ë›°ì–´ë‚¨.


#### âœ” ê²€ì¦ì´ ì‘ë™í•˜ëŠ” ë°©ì‹ì€?
- ì €ì¥ì— ì‹¤íŒ¨í•˜ëŠ” ê²½ìš° ì˜ˆì‹œ
![[Pasted image 20230120172339.png]]

-  ëŒ€ì²˜í•  ìˆ˜ ìˆëŠ” ë°©ì•ˆì€?
1) ë‹¨ìˆœ **ì˜¤ë¥˜í˜ì´ì§€**ë¥¼ ë³´ì—¬ì¤Œ(ex. 404) -> ë¶ˆí¸í•œ ì„œë¹„ìŠ¤ë¼ ì„ í˜¸ X  
2) **ì´ì „ ì›¹í˜ì´ì§€**(ex. ìƒí’ˆ ë“±ë¡í¼)ë¥¼ ë³´ì—¬ì¤€ë‹¤. ê·¸ë¦¬ê³  **ì–´ë–¤ ê°’ì´ ì˜ëª» ì…ë ¥**í–ˆëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤.


## í•´ê²°í•´ì•¼ ë  ë¬¸ì œ ê³¼ì • ì´í•´ê³¼ì •
#### ğŸ“Œ(ì½”ë“œ) ìˆœìˆ˜ ìë°”ì½”ë“œë¥¼ ì´ìš©í•œ ê²€ì¦í•˜ëŠ” ë°©ë²•ì€?
- ê²€ì¦ ì „ ë“±ë¡í¼
```java
@PostMapping("/add")  
public String addItem(@ModelAttribute Item item, RedirectAttributes redirectAttributes) {  
    Item savedItem = itemRepository.save(item);  
    redirectAttributes.addAttribute("itemId", savedItem.getId());  
    redirectAttributes.addAttribute("status", true);  
    return "redirect:/form/items/{itemId}";  
}
```

- ê²€ì¦ ì´í›„ ë“±ë¡ í¼
```java
@PostMapping("/add")  
public String addItem(@ModelAttribute Item item, RedirectAttributes redirectAttributes, Model model) {  
  
    //ê²€ì¦ ì˜¤ë¥˜ ê²°ê³¼ë¥¼ ë³´ê´€  
    Map<String, String> errors = new HashMap<>();  
  
    //ê²€ì¦ ë¡œì§  
    if (!StringUtils.hasText(item.getItemName())) {  
        errors.put("itemName", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");  
    }  
    if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {  
        errors.put("price", "ê°€ê²©ì€ 1,000 ~ 1,000,000 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.");  
    }  
    if (item.getQuantity() == null || item.getQuantity() >= 9999) {  
        errors.put("quantity", "ìˆ˜ëŸ‰ì€ ìµœëŒ€ 9,999 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.");  
    }  
  
    //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦  
    if (item.getPrice() != null && item.getQuantity() != null) {  
        int resultPrice = item.getPrice() * item.getQuantity();  
        if (resultPrice < 10000) {  
            errors.put("globalError", "ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = " + resultPrice);  
        }  
    }  
  
    //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ  
    if (!errors.isEmpty()) {  
        log.info("errors = {} ", errors);  
        model.addAttribute("errors", errors);  
        return "validation/v1/addForm";  
    }  
  
    //ì„±ê³µ ë¡œì§  
    Item savedItem = itemRepository.save(item);  
    redirectAttributes.addAttribute("itemId", savedItem.getId());  
    redirectAttributes.addAttribute("status", true);  
    return "redirect:/validation/v1/items/{itemId}";  
}
```

- ë§¤ì»¤ë‹ˆì¦˜
1 ) ê²€ì¦ì˜¤ë¥˜ë¥¼ HashMapì„ í†µí•´ì„œ ë³´ê´€.
2 ) ê²€ì¦ ë¡œì§ì„ êµ¬ë¶„í•´ì„œ ê°œë³„ì ìœ¼ë¡œ hashì— ë‹´ê¸°.
3-1 ) ê²€ì¦ë¡œì§ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°(ì˜¤ë¥˜ê°€ ìˆëŠ”ê²½ìš°), ì˜¤ë¥˜ë¥¼ ëª¨ë¸ì— ë‹´ì•„ì„œ viewë Œë”ë§. 
		ê·¼ë° ì™œ ëª¨ë¸ì— ë‹´ì§€? modelì— ë‹´ì•„ì•¼ë§Œâ€‹ viewì— ë„˜ê²¨ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì„.
3-2 ) ì„±ê³µí•˜ëŠ” ê²½ìš° ê¸°ì¡´ê³¼ ë™ì¼.


- íƒ€ì„ë¦¬í”„ ê²€ì¦ì— ë”°ë¥¸ html ì¶”ê°€
```html
<head>
	<style>  
	    .container {  
	        max-width: 560px;  
	    }  
	    .field-error {  
	        border-color: #dc3545;  
	        color: #dc3545;  
	    } 
	</style>
</head>

<body>
<div class="container">
	<div class="py-5 text-center">  
	    <h2 th:text="#{page.addItem}">ìƒí’ˆ ë“±ë¡</h2>  
	</div>  
	  
	<form action="item.html" th:action th:object="${item}" method="post">  
	    <!-- ì „ì²´ ê²€ì¦ ì˜¤ë¥˜ ì¶”ê°€í•œ ë¶€ë¶„-->  
	    <div th:if="${errors?.containsKey('globalError')}">  
	        <p class="field-error" th:text="${errors['globalError']}">ì „ì²´ ì˜¤ë¥˜ ë©”ì‹œì§€</p>  
	    </div>    <!---->  
	  
	    <div>  
	        <label for="itemName" th:text="#{label.item.itemName}">ìƒí’ˆëª…</label>  
	        <!-- ê²€ì¦ ì˜¤ë¥˜ ì¶”ê°€í•œ ë¶€ë¶„-->  
	        <input type="text" id="itemName" th:field="*{itemName}"  
	               th:class="${errors?.containsKey('itemName')} ? 'form-control field-error' : 'form-control'"  
	               class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">  
	        <div class="field-error" th:if="${errors?.containsKey('itemName')}" th:text="${errors['itemName']}">  
	            ìƒí’ˆëª… ì˜¤ë¥˜  
	        </div>  
	        <!---->  
	    </div>
	
		...
		
	</form>
```
- `th:class="${errors?.containsKey('itemName')} ? 'form-control field-error' : 'form-control'"` : Â Form ì…ë ¥ ì¹¸ì— ë¹¨ê°„ íƒœë‘ë¦¬ë¥¼ ë§Œë“¤ê¸°

- ê²°ê³¼
![[Pasted image 20230120210624.png]]


#### ğŸ“Œê²€ì¦ ì˜¤ë¥˜ ê²°ê³¼ ë³´ê´€ì˜ ë¬¸ì œì ê³¼ í•´ê²°ë°©ì•ˆì€?
â–¶ ë¬¸ì œì 
ê¸°ì¡´ì—ëŠ” **ì§ì ‘ Mapì„ ìƒì„±**í•´ì„œ ì˜¤ë¥˜ë“¤ì„ ëª¨ì•˜ë‹¤. í•˜ì§€ë§Œ ìƒì„±ë¹„ìš©ê³¼ ë·°ì— ë„˜ê²¨ì¤˜ì•¼í•˜ëŠ” ë³µì¡í•œ ìƒí™©ì´ ìƒê¹€

â–¶ í•´ê²°ë²•
**`BindingResult bindingResult`** ì„ ì´ìš©í•´ ì˜¤ë¥˜ë¥¼ ì €ì¥í•´ë‘ëŠ” errors Mapê³¼ê°™ì€ ì—­í•  + ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ë·°ì— ë„˜ê²¨ì¤Œ(ê·¸ë˜ì„œ ë·°ì˜ ì½”ë“œë¥¼ ì¢€ë” ê°„ë‹¨í•˜ê²Œ í‘œí˜„ ê°€ëŠ¥í•¨.)
```html
<div> 
	<label for="price" th:text="#{label.item.price}">ê°€ê²©</label> 
	<input type="text" id="price" th:field="*{price}" th:errorclass="field-error" 
		class="form-control" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”"> 
	<div class="field-error" th:errors="*{price}"> ê°€ê²© ì˜¤ë¥˜ </div> 
</div>
```
-Â **#{fields}**Â : íƒ€ì„ë¦¬í”„ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê°ì²´ì´ë‹¤. `#fields`ë¡œ BindingResultê°€ ì œê³µí•˜ëŠ” ê²€ì¦ ì˜¤ë¥˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
-Â **th:errorclass**Â : th:field ì—ì„œ ì§€ì •í•œ í•„ë“œ ì´ë¦„ìœ¼ë¡œ BindfingResultì— ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ classê°€ ì¶”ê°€ë˜ì–´ ë¹¨ê°„ íƒœë‘ë¦¬ê°€ ìƒê¸°ê²Œ ëœë‹¤.
-Â **th:errors**Â : í•´ë‹¹ í•„ë“œì— ì˜¤ë¥˜ê°€ ìˆëŠ” ê²½ìš°ì— íƒœê·¸ë¥¼ ì¶œë ¥í•œë‹¤. th:if ì˜ í¸ì˜ ë²„ì „ì´ë‹¤.

â–¶ ì£¼ì˜ì 
BindingResult bindingResult íŒŒë¼ë¯¸í„°ì˜ ìœ„ì¹˜ëŠ” **@ModelAttribute Item item ë‹¤ìŒì—** ì™€ì•¼ í•œë‹¤.
	why? item ê°ì²´ì˜ ë°”ì¸ë”© ê²°ê³¼ë¥¼ ê°€ì§€ê³  ìˆê²Œ ë•Œë¬¸ì„.


#### ğŸ“Œì˜¤ë¥˜ êµ¬ë³„ì˜ ë¬¸ì œì ê³¼ í•´ê²°ë°©ì•ˆì€?
â–¶ ë¬¸ì œì 
ê¸°ì¡´ì—ëŠ” `errors.put("itemName", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");` ê³¼ ê°™ì´ ì—ëŸ¬ì˜ ì¢…ë¥˜ì˜ ìƒê´€ì—†ì´ ì˜¤ë¥˜ë¥¼ ë³´ê´€í–ˆë‹¤. ê·¸ë˜ì„œ **ì—ëŸ¬ êµ¬ë¶„ë¬¸ì œ**ì™€ **ë©”ì‹œì§€ì˜ í†µì¼ì„±** ë¬¸ì œê°€ ìƒê¹€

â–¶ í•´ê²°ë²•
1) **`FieldError` ì™€ `ObjectError`** êµ¬ë¶„í•´ì„œ `bindingResult` ì— ë‹´ê¸°
- í•„ë“œ/ì˜¤ë¸Œì íŠ¸ ì—ëŸ¬ ì½”ë“œ
```java
public FieldError(String objectName, String field, String defaultMessage); 

public FieldError(String objectName, String field, @Nullable Object rejectedValue, boolean bindingFailure, @Nullable String[] codes, @Nullable Object[] arguments, @Nullable String defaultMessage)

public ObjectError(String objectName, String defaultMessage)

public ObjectError(String objectName, @Nullable String[] codes, @Nullable Object[] arguments, @Nullable String defaultMessage)
```
ex) `bindingResult.addError(new FieldError("item", "itemName", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤."));`
- ê²°ê³¼
![[Pasted image 20230122190157.png]]

2) **messages.properties**ë¥¼ ì´ìš©í•´ì„œ ë©”ì‹œì§€ í†µì¼í•˜ê¸°
EX) ê°€ê²© ë²”ìœ„ ì˜¤ë¥˜ë¥¼ ë©”ì‹œì§€í™” ë° ë™ì í™” í•˜ê¸°
- errors.properties
```
range.item.price=ê°€ê²©ì€ {0} ~ {1} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
```
`bindingResult.addError(new FieldError("item", "price", item.getPrice(), false, new String[]{"range.item.price"}, new Object[]{1000, 1000000}, null));`
- ê²°ê³¼
![[Pasted image 20230122190122.png]]


#### ğŸ“ŒField/ObjectErrorì˜ ë¬¸ì œì ê³¼ í•´ê²°ë°©ì•ˆì€?
â–¶ ë¬¸ì œì 
FieldError ì™€ ObjectError ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œëŠ” ë„˜ê²¨ì£¼ì–´ì•¼ í•  **ì¸ìë„ ë„ˆë¬´ ë§ê³ , ê¸¸ì–´ì„œ ë³µì¡í•¨**.

â–¶ í•´ê²°ë²•
**BindingResult**Â ëŠ” ì´ë¯¸ ë³¸ì¸ì´ ê²€ì¦í•´ì•¼ í•  ê°ì²´ì¸ target ì„ ì•Œê³  ìˆìŒ. ê·¸ë˜ì„œ FieldErrorë¥¼ rejectValueë¡œ, bjectErrorë¥¼ rejectë¡œ ë°”ê¾¼ë‹¤.

- ì¸í„°í˜ì´ìŠ¤
```java
void rejectValue(@Nullable String field, String errorCode, @Nullable Object[] errorArgs, @Nullable String defaultMessage);

void reject(String errorCode, @Nullable Object[] errorArgs, @Nullable String defaultMessage);
```

ex) ê°€ê²© ë²”ìœ„ í•„ë“œì—ëŸ¬ ì˜ˆì‹œ
```java
//í•„ë“œ ì—ëŸ¬ ë³€ê²½ì „
bindingResult.addError(new FieldError("item", "price", item.getPrice(), false, new String[]{"range.item.price"}, new Object[]{1000, 1000000}, null));

//í•„ë“œ ì—ëŸ¬ ë³€ê²½í›„
bindingResult.rejectValue("price", "range", new Object[]{1000, 1000000}, null);
```
=> `errorCode` ë¶€ë¶„ì€ ë©”ì‹œì§€í™”ë¡œ ì¸í•´ ê°„ë‹¨íˆ í‘œí˜„í•¨.


#### ğŸ“ŒìŠ¤í”„ë§ì´ ë§Œë“  ê²€ì¦ ì˜¤ë¥˜ ë©”ì‹œì§€ì˜ ë¬¸ì œì ê³¼ í•´ê²°ë°©ì•ˆì€?
â–¶ ë¬¸ì œì 
=> ìŠ¤í”„ë§ì´ ì§ì ‘ ì‘ì„±í•˜ëŠ” ì˜¤ë¥˜ëŠ” ë„ˆë¬´ ê¸¸ê³  ë³µì¡í•¨.
![[Pasted image 20230122180545.png]]

â–¶ í•´ê²°ë²•
ìŠ¤í”„ë§ì´ ìƒì„±í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë³€ê²½í•˜ê¸°
- errors.propertiesì— ì¶”ê°€í•˜ê¸°
```
typeMismatch.java.lang.Integer=ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. 
typeMismatch=íƒ€ì… ì˜¤ë¥˜ì…ë‹ˆë‹¤.
```

- ê²°ê³¼
![[Pasted image 20230122214331.png]]


#### ğŸ“Œì»¨íŠ¸ë¡¤ëŸ¬ ë‚´ë¶€ì˜ ê²€ì¦ ë¡œì§ì— ë¬¸ì œì ê³¼ í•´ê²°ë°©ì•ˆì€?
â–¶ ë¬¸ì œì 
ê¸°ì¡´ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ë‚´ë¶€ì˜ **ê²€ì¦ ë¡œì§ì€ ë„ˆë¬´ ì§€ì €ë¶„**í•˜ë‹¤. ê·¸ë˜ì„œ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ê³¼ ì½”ë“œë¥¼ ì´í•´í•˜ëŠ”ë° ë§ì€ ë¹„ìš©ë°œìƒí•¨.

â–¶ í•´ê²°ë²•
ë³„ë„ì˜ ê²€ì¦ ë¶€ë¶„ìœ¼ë¡œ **ë¶„ë¦¬í•˜ì—¬ ItemValidator** ë¼ëŠ” classë¡œ ë§Œë“¤ì. ê·¸ë¦¬ê³  **ì• ë…¸í…Œì´ì…˜**ì„ í†µí•œ ì£¼ì…ìœ¼ë¡œ í•˜ì
- ê²€ì¦ê¸° ë¶€ë¶„ë§Œ í´ë˜ìŠ¤ ë¶„ë¦¬í•˜ê¸°
```java
@Component
public class ItemValidator implements Validator {

    @Override
    public boolean supports(Class<?> clazz) {
        return Item.class.isAssignableFrom(clazz);
    }

    @Override
    public void validate(Object target, Errors errors) {
        Item item = (Item)target;

        // ê²€ì¦ ë¡œì§
        if(!StringUtils.hasText(item.getItemName())){
            errors.rejectValue("itemName", "required");
        }
        if(item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000){
            errors.rejectValue("price", "range", new Object[]{1000, 1000000}, null);
        }
        if(item.getQuantity() == null || item.getQuantity() >= 9999){
            errors.rejectValue("quantity", "max", new Object[]{9999}, null);
        }

        // ë³µí•© ë£° ê²€ì¦
        if(item.getPrice() != null && item.getQuantity() != null){
            int resultPrice = item.getPrice() * item.getQuantity();
            if(resultPrice < 10000){
                errors.reject("totalPriceMin", new Object[]{10000, resultPrice},null);
            }
        }
    }
}
```
=> `supports()` : ì—¬ëŸ¬ ê²€ì¦ê¸°ë¥¼ ë“±ë¡í•œë‹¤ë©´ ê·¸ ì¤‘ì— ì–´ë–¤ ê²€ì¦ê¸°ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í• ì§€ êµ¬ë¶„í•  ë•Œ ì‚¬ìš©í•¨.

- ë“±ë¡ ê²€ì¦ë¡œì§
```java
private final ItemValidator itemValidator;

@InitBinder  
public void init(WebDataBinder dataBinder) {  
    dataBinder.addValidators(itemValidator);  
}

...

@PostMapping("/add")  
public String addItemV6(@Validated
						@ModelAttribute Item item,  
						BindingResult bindingResult,  
						RedirectAttributes redirectAttributes,  
						Model model) {  
	
	//ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ  
	if (bindingResult.hasErrors()) {  
		log.info("errors={} ", bindingResult);  
		return "validation/v2/addForm";  
	}  

	//ì„±ê³µ ë¡œì§  
	Item savedItem = itemRepository.save(item);  
	redirectAttributes.addAttribute("itemId", savedItem.getId());  
	redirectAttributes.addAttribute("status", true);  
	return "redirect:/validation/v2/items/{itemId}";  
}
```
=> `WebDataBinder`  : ìŠ¤í”„ë§ì˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì˜ ì—­í• ì„ í•´ì£¼ê³  ê²€ì¦ ê¸°ëŠ¥ë„ ë‚´ë¶€ì— í¬í•¨í•œë‹¤.
=> `@InitBinder` : í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ë§Œ ì˜í–¥ì„ ì¤€ë‹¤. ê¸€ë¡œë²Œ ì„¤ì •ì€ ë³„ë„ë¡œ í•´ì•¼í•œë‹¤. 
=> `@Validated`  : ê²€ì¦ê¸°ë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ì• ë…¸í…Œì´ì…˜ì´ë‹¤.ì´ ì• ë…¸í…Œì´ì…˜ì´ ë¶™ìœ¼ë©´ ì•ì„œ WebDataBinderì— ë“±ë¡í•œ ê²€ì¦ê¸°ë¥¼ ì°¾ì•„ ì‹¤í–‰í•¨.


#### ğŸ“Œë°”ì¸ë”© ì‹œì ì— íƒ€ì… ì˜¤ë¥˜ë°œìƒí•´ë„ ì…ë ¥ê°’ì´ ì–´ë–»ê²Œ ìœ ì§€ë ê¹Œ?
=> ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ FieldErrorì— **rejectedValueë³€ìˆ˜ì— ê°’ì„ ë³´ê´€**í•˜ê²Œ ëœë‹¤.  ê·¸ë˜ì„œ **í•„ë“œ ì—ëŸ¬ì—ì„œ ê°’ì„ ì‚¬ìš©**í•  ìˆ˜ ìˆëŠ” ê²ƒì„.
```JAVA
public FieldError(String objectName, String field, @Nullable Object rejectedValue, boolean bindingFailure, @Nullable String[] codes, @Nullable Object[] arguments, @Nullable String defaultMessage)
```


#### ğŸ“Œì˜ëª» ì…ë ¥í•œ ë°ì´í„°ëŠ” ì–´ë–»ê²Œ ìš°ë¦¬ì˜ í™”ë©´ì— ë‹¤ì‹œ ì¶œë ¥ì´ ë ê¹Œ?
- ë“±ë¡ í¼
```java
@GetMapping("/add")
public String addForm(Model model) {
    model.addAttribute("item", new Item());
    return "validation/v1/addForm";
}
```
=> í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” Item ì´ë¼ëŠ” **í……ë¹ˆ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ Modelì— ë“±ë¡**í–ˆë‹¤.

- ë·°ì—ì„œ ì‚¬ìš©ìê°€ í¼ì— ì…ë ¥í–ˆì„ë•Œ
```java
PostMapping("/add")
public String addItem(@ModelAttribute Item item, RedirectAttributes redirectAttributes, Model model) {
    // ê²€ì¦ ì˜¤ë¥˜ ê²°ê³¼ë¥¼ ë³´ê´€
    Map<String, String> errors = new HashMap<>();
    
    // ìƒëµ...
}
```
=>Formì—ì„œ ì „ë‹¬í•œ ë°ì´í„°ë¥¼ ê°–ì€ Itemê°ì²´ê°€ **ê·¸ëŒ€ë¡œ ë‹¤ì‹œ Modelì— ë“±ë¡**ë˜ì–´ ë·°ë¡œ ì „ë‹¬ë˜ëŠ” ê²ƒ ì´ë‹¤.


#### ğŸ“Œê²€ì¦ì—ì„œ, @ModelAttributeëŠ” ë³¸ì¸ì´ ê²€ì¦í•´ì•¼ë  ê°ì²´ë¥¼ ì–´ë–»ê²Œ ì•Œê³  ìˆì„ê¹Œ?
=>Â BindingResult í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ, **í™•ì¸ ì¤‘ì¸ ê°œì²´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ `BindingResult` ì™€ í•¨ê»˜ ì¸ìˆ˜ë¡œ ë©”ì„œë“œì— ì „ë‹¬**ë©ë‹ˆë‹¤. 
```java
@PostMapping("/save")
public String save(@Valid MyObject myObject, BindingResult bindingResult) {
   if (bindingResult.hasErrors()) {
      // there are errors in the object, handle them
   } else {
      // the object is valid, save it
   }
   return "redirect:/";
}
```
=> ìœ„ì˜ ì˜ˆì—ì„œ `myObject` ì¸ìˆ˜ëŠ” Spring MVC í”„ë ˆì„ì›Œí¬ì— ì´ ê°œì²´ì— ëŒ€í•œ ë°ì´í„° ê²€ì¦ì„ ìˆ˜í–‰í•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” @Validë¡œ ì• ë…¸í…Œì´ì…˜ì„ ë‹¬ì•˜ë‹¤. ê·¸ëŸ° ë‹¤ìŒ BindingResultê°€ ì¸ìˆ˜ë¡œ ì „ë‹¬ë˜ê³  myObject ì¸ìˆ˜ì™€ ì—°ê²°ë˜ë©° ê²€ì¦ í”„ë¡œì„¸ìŠ¤ ì¤‘ì— ë°œê²¬ëœ ëª¨ë“  ì˜¤ë¥˜ê°€ í¬í•¨ë©ë‹ˆë‹¤.

=> `BindingResult` ëŠ” method ì¸ìˆ˜ ëª©ë¡ì„ ê²€í† í•˜ê³  BindingResult ê°ì²´ë¥¼ `@Valid`ë¡œ ì• ë…¸í…Œì´ì…˜ì„ ë‹¨ ì´ì „ ê°œì²´ì™€ ì¼ì¹˜ì‹œí‚´ìœ¼ë¡œì¨ ì—°ê²°ëœ ê°œì²´ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, BindingResult í´ë˜ìŠ¤ëŠ” Spring MVCì˜ ë°ì´í„° ë°”ì¸ë”© í”„ë¡œì„¸ìŠ¤ì™€ ë°€ì ‘í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆìœ¼ë©°, **ì¸ìˆ˜ì˜ ìˆœì„œì— ì˜í•´ ê²€ì¦ë˜ì–´ì•¼ í•  ê°ì²´ë¥¼ ì•Œê³  ìˆë‹¤.**


#### ğŸ“Œ@ModelAttributeì— ë°”ì¸ë”© ì‹œ íƒ€ì… ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´?
- BindingResult ê°€ **ì—†ìœ¼ë©´ 400 ì˜¤ë¥˜ê°€ ë°œìƒ**í•˜ë©´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œë˜ì§€ ì•Šê³ , ì˜¤ë¥˜ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.
![[Pasted image 20230122180515.png]]

- BindingResult ê°€ **ìˆìœ¼ë©´ ì˜¤ë¥˜ ì •ë³´**( FieldError )ë¥¼ BindingResult ì— ë‹´ì•„ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì •ìƒ í˜¸ì¶œí•œë‹¤.
![[Pasted image 20230122180545.png]]


## ì‚¬ìš©í•  ê²€ì¦
#### âœ”BindingResultì— ê²€ì¦ ì˜¤ë¥˜ë¥¼ ì ìš©í•˜ëŠ” 3ê°€ì§€ ë°©ë²•ì€?
1) @ModelAttribute ì˜ ê°ì²´ì— íƒ€ì… ì˜¤ë¥˜ ë“±ìœ¼ë¡œ ë°”ì¸ë”©ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš° **ìŠ¤í”„ë§ì´ ì˜¤ë¥˜ ìƒì„±**í•´ì„œ BindingResult ì— ë„£ì–´ì¤€ë‹¤.
=> ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤Œ
![[Pasted image 20230122184301.png]]

2) ê°œë°œìê°€ **ì§ì ‘ ì˜¤ë¥˜ë¥¼ ë„£ì–´**ì¤€ë‹¤. (ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì—ì„œì˜ ê²€ì¦ì—ì„œ ì¶”ê°€)
=> EX)` bindingResult.addError(new FieldError("item", "itemName", item.getItemName(), false, null, null, "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤."));`
![[Pasted image 20230122184346.png]]

3) **Validator ì‚¬ìš©**
=> í•´ë‹¹ ê°ì²´ì— ì• ë…¸í…Œì´ì…˜ì„ ë„£ì–´ì¤˜ì„œ ê²€ì¦í•¨. ê°„ë‹¨í•´ì„œ **ëŒ€ë¶€ë¶„ ê²½ìš°ì— ì‚¬ìš©**í•¨.
```java
@Data  
public class Item {  

    private Long id;  
    
    @NotBlank  
    private String itemName;  
    
    @NotNull  
    @Range(min = 1000, max = 1000000)  
    private Integer price;  
    
    @NotNull  
    @Max(9999)  
    private Integer quantity;  

	...
 }
```


#### ğŸ“Œê¸°ì¡´ ê²€ì¦ ë¡œì§ê³¼ ì‚¬ìš©í•  ê²€ì¦ ë¡œì§ì˜ ì°¨ì´ì ì€?
â–¶ê¸°ì¡´ ê²€ì¦ë¡œì§
=> ê¸°ì¡´ì— ì§ì ‘ êµ¬í˜„í•˜ì˜€ë˜ ê²€ì¦ê³¼ì •ì´ ë‹¨ìˆœí™” ëì§€ë§Œ ì—¬ì „íˆ ë³µì¡í•¨. **ê²€ì¦ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì½”ë“œë¥¼ ì¼ì¼íˆ ì‘ì„±**í•´ì•¼í•¨.

â–¶ì‚¬ìš©í•  ê²€ì¦ ë¡œì§
=> Bean Validation : **ì• ë…¸í…Œì´ì…˜ í•˜ë‚˜ë¡œ ê²€ì¦ ë¡œì§**ì„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì ìš©í•´ë³´ì.
Bean Validation ì• ë…¸í…Œì´ì…˜ ì •ë¦¬ : [Spring Validation Annotation ì´ì •ë¦¬ (tistory.com)](https://hyeran-story.tistory.com/81)


#### âœ”  Bean Validationì˜ ê²€ì¦ ìˆœì„œëŠ”?
1) @ModelAttribute ê°ê°ì˜ **í•„ë“œì— íƒ€ì… ë³€í™˜ ì‹œë„** 
	1. ì„±ê³µí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ 
	2. ì‹¤íŒ¨í•˜ë©´ typeMismatch ë¡œ FieldError ì¶”ê°€
=> ì´ë¡œì¸í•´ íƒ€ì…ê²€ì¦ì— ì‹¤íŒ¨í–ˆì„ë•Œ, í•„ë“œê²€ì¦ì„ ë”°ë¡œ ì•ˆí•´ ì˜¤ë¥˜ê°€ ë‘ê°œ ì¶œë ¥í•˜ëŠ” ë¬¸ì œì ì´ í•´ê²°ëìŒ.
2) ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ **Validator** ì ìš©

ì˜ˆ)
- itemName ì— ë¬¸ì "A" ì…ë ¥ => íƒ€ì… ë³€í™˜ ì„±ê³µ => itemName í•„ë“œì— BeanValidation ì ìš©
- price ì— ë¬¸ì "A" ì…ë ¥ => "A"ë¥¼ ìˆ«ì íƒ€ì… ë³€í™˜ ì‹œë„ ì‹¤íŒ¨ => typeMismatch FieldError ì¶”ê°€ => price í•„ë“œëŠ” BeanValidation ì ìš© X


#### âœ”(ì½”ë“œ) Bean Validation ì„¤ì • ë° ì‚¬ìš©ë°©ë²•ì€?
â–¶ ì˜ì¡´ê´€ê³„ ì„¤ì •í•˜ê¸°
- build.gradle 
```
implementation 'org.springframework.boot:spring-boot-starter-validation'
```

â–¶ í´ë˜ìŠ¤ ì‘ì„±
- Item
```java
@Data  
public class Item {  

    private Long id;  
    
    @NotBlank  
    private String itemName;  
    
    @NotNull  
    @Range(min = 1000, max = 1000000)  
    private Integer price;  
    
    @NotNull  
    @Max(9999)  
    private Integer quantity;  
  
    public Item() {  
    }  
  
    public Item(String itemName, Integer price, Integer quantity) {  
        this.itemName = itemName;  
        this.price = price;  
        this.quantity = quantity;  
    }  
}
```
=>ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ í•„ë“œ ê²€ì¦

â–¶ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ ì‘ì„±
```java
@PostMapping("/add")    
public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult,   
RedirectAttributes redirectAttributes, Model model) {  
  
	//íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦  
	if (item.getPrice() != null && item.getQuantity() != null) {  
		int resultPrice = item.getPrice() * item.getQuantity();  
		if (resultPrice < 10000) {  
			bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);  
		}  
	}  
	
	//ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ  
	if (bindingResult.hasErrors()) {  
		log.info("errors={} ", bindingResult);  
		return "validation/v3/addForm";  
	}  
	
	//ì„±ê³µ ë¡œì§  
	Item savedItem = itemRepository.save(item);  
	redirectAttributes.addAttribute("itemId", savedItem.getId());  
	redirectAttributes.addAttribute("status", true);  
	return "redirect:/validation/v3/items/{itemId}";  
}
```

â–¶ html ì‘ì„±í•˜ê¸°
- íƒ€ì„ë¦¬í”„ ê²€ì¦ì— ë”°ë¥¸ html ì¶”ê°€
```html
<head>
	<style>  
	    .container {  
	        max-width: 560px;  
	    }  
	    .field-error {  
	        border-color: #dc3545;  
	        color: #dc3545;  
	    } 
	</style>
</head>

<body>
<div class="container">
	<div class="py-5 text-center">  
	    <h2 th:text="#{page.addItem}">ìƒí’ˆ ë“±ë¡</h2>  
	</div>  
	  
	<form action="item.html" th:action th:object="${item}" method="post">  
	    <!-- ì „ì²´ ê²€ì¦ ì˜¤ë¥˜ ì¶”ê°€í•œ ë¶€ë¶„-->  
	    <div th:if="${errors?.containsKey('globalError')}">  
	        <p class="field-error" th:text="${errors['globalError']}">ì „ì²´ ì˜¤ë¥˜ ë©”ì‹œì§€</p>  
	    </div>    <!---->  
	  
	    <div>  
	        <label for="itemName" th:text="#{label.item.itemName}">ìƒí’ˆëª…</label>  
	        <!-- ê²€ì¦ ì˜¤ë¥˜ ì¶”ê°€í•œ ë¶€ë¶„-->  
	        <input type="text" id="itemName" th:field="*{itemName}"  
	               th:class="${errors?.containsKey('itemName')} ? 'form-control field-error' : 'form-control'"  
	               class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">  
	        <div class="field-error" th:if="${errors?.containsKey('itemName')}" th:text="${errors['itemName']}">  
	            ìƒí’ˆëª… ì˜¤ë¥˜  
	        </div>  
	        <!---->  
	    </div>
	
		...
		
	</form>
```
- `th:class="${errors?.containsKey('itemName')} ? 'form-control field-error' : 'form-control'"` : Â Form ì…ë ¥ ì¹¸ì— ë¹¨ê°„ íƒœë‘ë¦¬ë¥¼ ë§Œë“¤ê¸°


#### âœ”(ì½”ë“œ) ì˜¤ë¥˜ ì¶œë ¥ ë©”ì‹œì§€ ìˆ˜ì •í•˜ëŠ” ë°©ë²•ì€?
â–¶MessageCodesResolver
=> ê²€ì¦ ì½”ë“œë¥¼ í†µí•˜ì—¬ **ë©”ì‹œì§€ ì¶œë ¥ë¬¸ì„ ë§Œë“¤ì–´ì£¼ëŠ” ì—­í• **.

- DefaultMessageCodesResolverì˜ ê¸°ë³¸ ë©”ì‹œì§€ ìƒì„± ê·œì¹™
ê°ì²´ ì˜¤ë¥˜
```yaml
ê°ì²´ ì˜¤ë¥˜ì˜ ê²½ìš° ë‹¤ìŒ ìˆœì„œë¡œ 2ê°€ì§€ ìƒì„± 
1.: code + "." + object name 
2.: code

ì˜ˆ) ì˜¤ë¥˜ ì½”ë“œ: required, object name: item 
1.: required.item
2.: required
```

í•„ë“œ ì˜¤ë¥˜
```YAML
í•„ë“œ ì˜¤ë¥˜ì˜ ê²½ìš° ë‹¤ìŒ ìˆœì„œë¡œ4ê°€ì§€ ë©”ì‹œì§€ ì½”ë“œ ìƒì„±
1.: code + "." + object name + "." + field
2.: code + "." + field
3.: code + "." + field type
4.: code

ì˜ˆ) ì˜¤ë¥˜ ì½”ë“œ: typeMismatch, object name "user", field "age", field type: int 
1. "typeMismatch.user.age"
2. "typeMismatch.age"
3. "typeMismatch.int"
4. "typeMismatch"
```

â–¶ì˜ˆì‹œ
- ê²€ì¦
```java
@NotBlank 
private String itemName;
```

- `@NotBlank`ë¡œ ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ ë©”ì‹œì§€ ì½”ë“œ
```
NotBlank.item.itemName 
NotBlank.itemName 
NotBlank.java.lang.String 
NotBlank
```

- errors.properties
```properties
#Bean Validation ì¶”ê°€
NotBlank={0} ê³µë°±X
Range={0}, {2} ~ {1} í—ˆìš©
Max={0}, ìµœëŒ€ {1}
```
=> {0} ì€ í•„ë“œëª…ì´ê³ , {1} , {2} ...ì€ íŒŒë¼ë¯¸í„° ê°’ë§ˆë‹¤ ë‹¤ë¥´ë‹¤.

- ê²°ê³¼
![[Pasted image 20230123010218.png]]


#### ğŸ“Œë™ì¼í•œ ëª¨ë¸ ê°ì²´ë¥¼ ë“±ë¡, ìˆ˜ì • ê°ê° ë‹¤ë¥´ê²Œ ê²€ì¦í•˜ëŠ” ë°©ë²•ì€?
=>Itemì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ItemSaveForm, ItemUpdateForm ê°™ì€ í¼ ì „ì†¡ì„ ìœ„í•œ **ë³„ë„ì˜ ëª¨ë¸ ê°ì²´**ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ì

â–¶ í´ë˜ìŠ¤ ì‘ì„±
- Item ì˜ ê²€ì¦ì€ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê²€ì¦ ì½”ë“œë¥¼ ì œê±°
```java
@Data 
public class Item {
	private Long id; 
	private String itemName; 
	private Integer price; 
	private Integer quantity;
}
```

- ItemSaveForm - ITEM ì €ì¥ìš© í¼
```java
@Data
public class ItemSaveForm {

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;
}
```

-Â ItemUpdateForm - ITEM ìˆ˜ì •ìš© í¼
```java
@Data
public class ItemUpdateForm {

    @NotNull
    private Long id;

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    // ìˆ˜ì •ì—ì„œëŠ” ìˆ˜ëŸ‰ì€ ììœ 
    private Integer quantity;
}
```

â–¶ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ ì‘ì„±
```java
@PostMapping("/add")
public String addItem(@Validated @ModelAttribute("item") ItemSaveForm form, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

    // ë³µí•© ë£° ê²€ì¦
    if(form.getPrice() != null && form.getQuantity() != null){
        int resultPrice = form.getPrice() * form.getQuantity();
        if(resultPrice < 10000){
            bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice},null);
        }
    }

    // ê²€ì¦ì— ì‹¤íŒ¨í•œ ê²½ìš°
    if(bindingResult.hasErrors()){
        log.info("errors= {}", bindingResult);
        return "validation/v4/addForm";
    }

    // ì„±ê³µ ë¡œì§
    Item item = new Item(form.getItemName(), form.getPrice(), form.getQuantity());

    Item savedItem = itemRepository.save(item);
    redirectAttributes.addAttribute("itemId", savedItem.getId());
    redirectAttributes.addAttribute("status", true);
    return "redirect:/validation/v4/items/{itemId}";
}
```
=>` @ModelAttribute("item")` ê³¼ ê°™ì´ ì‚¬ìš©í–ˆëŠ”ë°, ì´ëŠ” modelì— ë‹´ê¸°ëŠ” ê°ì²´ì˜ ì´ë¦„ì„ ì§€ì •í•´ì¤€ ê²ƒì´ë‹¤.(ì•ˆí•˜ë©´, `model.Attribute("itemSaveForm", form)` ì´ë ‡ê²Œ ë“¤ì–´ê°). ì´ë ‡ê²Œ ì§€ì •í•´ì£¼ë©´ ì´ì „ì— ì‚¬ìš©í•˜ë˜ ë·° í…œí”Œë¦¿ì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.