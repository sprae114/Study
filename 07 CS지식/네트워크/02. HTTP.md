#HTTP웹기본지식

#HTTP

----

#HTTP웹기본지식02
## HTTP정의
#### HTTP란? ✔
웹에서 이루어지는 모든 **데이터 교환의 기본이 되는 프로토콜(규칙)**
![[Pasted image 20221229101034.png]]


#### HTTP 3가지 특징은?  
1) 클라이언트 서버 구조 : 클라이언트와 서버로 **분리**  
![[Pasted image 20230123134446.png]]
2) 무상태 프로토콜 : 어떠한 이전 요청과도 무관한 각각의 요청을 **독립적인 트랜잭션**으로 취급하는 통신 프로토콜. 그래서 요청이 증가할 때, **서버 증설 가능**  

3) 비연결성 : 기본이 연결(**3 way handshake**)을 유지하지 않는 모델  


#### 상태프로토콜 vs 무상태프로토콜
▶ 상태 유지
=> 중간에 **다른 점원으로 바뀌면 안된다.** (중간에 다른 점원으로 바뀔 때 상태 정보를 다른 점원에게 미리 알려줘야 한다.)
- **로그인한 사용자**의 경우 로그인했다는 상태를 서버에 유지가 필요함. (그래서 일반적으로 브라우저 쿠키와 서버 세션등을 사용해서 상태 유지함)
- 만약 서버1이 장애가 난다면 유지되던 상태정보가 다 날아가버리므로 처음부터 다시 서버에 요청해야 한다.
![[Pasted image 20230123135028.png]]

▶ 무상태
=> 중간에 다른 점원으로 바뀌어도 된다. 
- 갑자기 **클라이언트 요청이 증가해도 서버를 대거 투입**할 수 있다.
- 만약 서버1에 장애가 생기도라도 다른 서버에서 응답을 전달하면 되기 때문에 클라이언트는 다시 요청할 필요가 없다.
![[Pasted image 20230123135212.png]]


#### 연결성 vs 비연결성
▶연결성
- TCP/IP의 경우 기본적으로 연결을 유지한다.
- 연결을 유지하는 모델에서는 클라이언트가 요청을 보내지 않더라도 **계속 연결을 유지**해야 한다.
- 이러한 경우 연결을 유지하는 **서버의 자원이 계속 소모**된다.
![[Pasted image 20230123135441.png]]

▶비연결성
- 비연결성을 가지는 HTTP에서는 실제로 요청을 주고 받을 때만 연결을 유지하고 응답을 주고나면 TCP/IP 연결을 끊는다.
- 이를 통해 **최소한의 자원으로 서버 유지**를 가능하게 한다.
![[Pasted image 20230123135512.png]]
- HTTP 지속 연결 (Persistent Connections)로 단점 극복함. HTTP 지속 연결에서는 연결이 이루어지고 난 뒤 **각각의 자원들을 요청하고 모든 자원에 대한 응답이 돌아온 후에 연결을 종료**한다.


## HTTP 구조를 가지고 있을까?
#### 요청 HTTP 메시지 구조는?  
- 시작 라인  
- 헤더라인  

#### 응답 HTTP 메시지 구조는?  
- 시작 라인  
- 헤더 라인  
- 메시지 라인  

#### 시작라인의 용도는?  
- 사람이 이해할 수 있는 **짧은 상태 코드 설명 글**, http메소드나 HTTP상태  

#### 헤더라인의 용도는?  
- HTTP 전송에 필요한 모든 **부가정보**  
- ex) host정보, 메시지 바디의 내용(html인지 등), 메시지 바디의 크기, 압축 여부, 캐시 관리 정보  

#### 메시지 바디의 용도는?  
- **실제 전송할 데이터**가 있는 곳  


## HTTP 메서드종류와 속성
#### API 설계하는 방법하는 방법은?
- **리소스**를 식별하고 **계층구조**를 활용하자 + 행위는 **HTTP 메소드**로 해결  


#### HTTP메서드 종류는? ✔
- **GET** -> 리소스 조회로 사용함. 전달하고 싶은 데이터가 있을때 바디X, 시작라인에 쿼리로 전달함  
- **POST** -> 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행.  
- **PUT** -> 리소스를 대체(=완전히 덮어버림) 
- **PATCH** -> 리소스 부분 변경  
- **DELETE** -> 리소스 삭제  


#### HTTP 메서드의 속성 3가지는? ✔
- **안전** -> 호출해도 **리소스**가 변하지 않는다.
        GET은 단순 조회만 하기 때문에 안전하다. POST, DELETE, PATCH, PUT은 당연히 안전하지 않다.
        ![[Pasted image 20221229101339.png]]
- **멱등** -> **n번 호출**해도 결과가 같다  
- **캐시가능** -> 자주 사용하는데이터나 값을 밀 복사해 놓는 **임시 장소가 가능**한가  
    - 향후 재사용을 위해 이에 대한 응답을 저장할 수 있음을 나타낸다.  


## 데이터 전달방식을 살펴보자
#### 데이터 전달 방식은 2가지는?(요청할때 생각해보자) 
1) **쿼리 파라미터**를 통한 데이터 전송 ex) GET, 주로 정렬 필터(검색어) 
2) **메시지 바디**를 통한 데이터 전송 ex) POST, PUT, PATCH, 회원가입, 상품 주문, 리소스 등록, 리소스 변경  


#### 클라이언트에서 서버로 데이터 전송 4가지 상황은?
1) **정적 데이터 조회** ex) 이미지, 정적 텍스트 문서
![[Pasted image 20221229101452.png]]
    
 2) **동적 데이터 조회** ex) 주로 검색, 게시판목록에서 정렬 필터(검색어)
![[Pasted image 20221229101503.png]]
    
3) **HTML Form을 통한 데이터 전송** ex) 회원 가입, 상품 주문, 데이터 변경
![[Pasted image 20221229101533.png]]
![[Pasted image 20221229101537.png]]
html 즉 웹페이지를 통해서 메시지를 전달하는 것.  
HOW? HTML Form이라는 걸 알지? Header 정보에 Content-Type: application/x-www-form-urlencoded

4) **HTTP API를 통한 데이터 전송** 
- ex) 서버to 서버, 앱 클라이언트, 웹 클라이언트(Ajax)
- Ajax란? HTML에서 Form 전송 대신 자바 스크립트를 통한 통신에 사용
- content-type은 application/json을 사용
![[Pasted image 20221229101632.png]]


## HTTP 상태코드 ✔
#### 2xx
=> (Successful): 요청 **정상 처리**  

#### 3xx
=> (Redirection): 요청을 완료하려면 웹브라우저의 추가 행동이 필요(**리다이렉션**) 
- 3xx 응답 결과에 Location 헤더가 있으면 그 위치로 자동 이동하는 것을 의미
![[Pasted image 20221229103202.png]]

#### 4xx 
=> (Client Error): **클라이언트 오류**, 잘못된 문법등으로 서버가 요청을 수행할 수 없음  
▶**400 Bad Request**  
- 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없는 상태.요청 파라미터가 잘못되거나 **API 스펙이 맞지 않을 때 발생**한다.  
- ex) 잘못입력한 url인경우가 대부분!

▶ **404 Not Found**  
- 요청 **리소스를 찾을 수 없는 상태**. 또는 클라이언트가 권한이 부족한 리소스에 접근하면 그 리소스를 숨기고 싶을 때 사용  ex) url확인이나 캐시삭제 해볼것!

#### 5xx
=> (Server Error): **서버 오류**, 서버가 정상 요청을 처리하지 못함  
- 500 Internal Server Error 
	- 서버 문제로 오류 발생, 애매하면 500 오류

- 503 Service Unavailable 서비스 이용 불가
	- 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음

##  리다이랙션 대해서
#### 리다이랙션이란?
출처 : [리다이렉트란(Redirect) (tistory.com)](https://webstone.tistory.com/65)
=>**re(다시) + 지시하다(direct) 다시 지시하는 것**을 말한다.  
- 예를 들어 브라우저가 `www.webstone.com/blogA` URL을 웹 서버에 요청했다고 하자. 그러면 서버는 HTTP 응답 메시지를 통해 "`www.webstone.com/blogB`로 다시 요청해봐!~" 라고 브라우저에게 **다른 URL(길, 방향) 을 지시할 수 있는 것을 리다이렉트**라 한다.
![[Pasted image 20230127091621.png]]


#### 영구 리다이렉션(301, 308)
=> ex) 이비인후과에 갔는데 바로 옆건물에 이사했다고 붙여있었다. 그래서 개발자 A는 옆건물 이비인후과로 갔다.
- 특정 리소스의 **URI가 영구적으로 이동**된다. **이전 리소스는 사용하면 안되는 상황일 때 해당**된다. 검색 엔진들도 이 변경을 인지해서 새로운 URI를 적용함.
- 301 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음. (308은 거의 사용 X)
![[Pasted image 20221229103419.png]]

#### 일시 리다이렉션(302, 307, 303) : PRG  
- 리소스의 **URI가 일시적으로 변경**된다. 따라서 검색 엔진 등에서 URL을 변경하면 안된다. ex) **주문 완료 후 주문 내역 화면으로 이동**
![[Pasted image 20221229103436.png]]


#### PRG (Post/Redirect/Get)란?
▶기존 Post의 문제점
![[Pasted image 20230128060635.png]]
=> Post요청 상태에서 새로고침하면 다시 Post요청하는 문제점

▶해결책
![[Pasted image 20230128060649.png]]
=>Post 요청후, Get으로 리다이렉트하도록하자

#### 특수 리다이렉션(304)
- 캐시를 목적으로 사용한다. 클라이언트가 캐시가 만료됐는지 서버에 확인하기 위해 캐시 정보를 넘기고, 서버는 사용해도 되면 캐시로 다시 조회하라고 응답을 보낸다.  


## HTTP 부가정보 정리
#### Content-Type, Content-Encoding, Content-Language, Content-Length 
- Content-Type: 표현 데이터의 형식  
- Content-Encoding: 표현 데이터의 압축 방식  
- Content-Language: 표현 데이터의 자연 언어  
- Content-Length: 표현 데이터의 길이  

#### 헤더의 일반정보(Referer, User-Agent, Server, Date)
- User-Agent: 유저 에이전트 애플리케이션 정보  
- Server: 요청을 처리하는 오리진 서버의 소프트웨어 정보
- Date: 메시지가 생성된 날짜  

#### 헤더의 특별한 정보(Host, Location, Retry-After)
- Host: 요청한 호스트 정보(도메인) 
- Location: 페이지 리다이렉션  
- Retry-After: 유저 에이전트가 다음 요청을 하기까지 기다려야 하는 시간  

#### 콘텐츠 협상이란? 
- 클라이언트가 **선호하는 표현을 서버에 요청**하는 것이다. 서버는 원하는 우선 순위에 최대한 맞춰서 표현 데이터를 만들어주게 된다.  
![[Pasted image 20221229111223.png]]
- 클라이언트가 선호하는 표현 요청 우선순위는 1) 클수록 높은 우선순위 2)구체적인 것이 우선  

## HTTP 메세지 전송 방식 4가지는?
#### 단순 전송  
=>   요청을 하면 미리 **컨텐츠의 길이를 알고 지정해서 보내는 방식**이다. 
![[Pasted image 20221229111612.png]]

#### 압축 전송  
=>  서버에서 gzip 등으로 압축을 해서 용량을 확 줄인 후 Content-Encoding에 뭘로 **압축했는지 정보**를 같이 보낸다.
![[Pasted image 20221229111632.png]]

#### 분할 전송  
=> 한 번에 쭉 보내려면 대기 시간이 필요한데 이렇게 쪼개면 만들어지는 대로 바로바로 응답을 받을 수 있는 장점이 있다. 끝났으면 `0\r\n`을 보낸다 ![[Pasted image 20221229111719.png]]

#### 범위 전송  
=> 절반 정도 받고 끊겼는데 처음부터 **다시 요청하기엔 아까우니 범위를 지정해서 요청**하는 방식이다.  
![[Pasted image 20221229111757.png]]

