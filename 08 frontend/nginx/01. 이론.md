[[10ë¶„ í…Œì½”í†¡] ğŸ¤« í”¼ì¼€ì´ì˜ Nginx](https://www.youtube.com/watch?v=6FAwAXXj5N0)
[[10ë¶„ í…Œì½”í†¡] ğŸ¿ ì œì´ë¯¸ì˜ Forward Proxy, Reverse Proxy, Load Balancer - YouTube](https://www.youtube.com/watch?v=YxwYhenZ3BE)
[Nginx ì˜ ë™ì‘ì›ë¦¬ì™€ ë“±ì¥ë°°ê²½, ì—­ì‚¬ì— ëŒ€í•´ ì•Œì•„ë³´ì!](https://haon.blog/haon/infra/nginx/core-concept/)

---

# 1. ì•„í‚¤í…ì²˜ íŠ¹ì§•
## ì´ë²¤íŠ¸ ê¸°ë°˜ ë¹„ë™ê¸° ëª¨ë¸
- ë™ì‘ ë°©ì‹: ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ë¹„ì°¨ë‹¨(non-blocking) I/O ì²˜ë¦¬
- ì¥ì : ë‚®ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ + ë†’ì€ ë™ì‹œ ì ‘ì† ì²˜ë¦¬ ëŠ¥ë ¥
- C10K ë¬¸ì œ í•´ê²°: 10,000ê°œ ì´ìƒì˜ ë™ì‹œ ì—°ê²° íš¨ìœ¨ì  ì²˜ë¦¬

## í”„ë¡œì„¸ìŠ¤ êµ¬ì¡°
```bash
Master Process
â”œâ”€â”€ Worker Process (1)
â”œâ”€â”€ Worker Process (2)
â””â”€â”€ ... (CPU ì½”ì–´ ìˆ˜ë§Œí¼ ìƒì„±)
```
- Master Process: ì„¤ì • ì½ê¸°, ë¡œê·¸ ê´€ë¦¬, Worker ëª¨ë‹ˆí„°ë§
- Worker Process: ì‹¤ì œ ìš”ì²­ ì²˜ë¦¬ (ì´ë²¤íŠ¸ ë£¨í”„ ê¸°ë°˜)


# í•µì‹¬ êµ¬ì„± ìš”ì†Œ
## Configuration
```nginx
events { ... }       # ì—°ê²° ì²˜ë¦¬ ë°©ì‹ ì •ì˜

http {               # HTTP ì„œë²„ ì„¤ì •
  upstream { ... }   # ë¡œë“œ ë°¸ëŸ°ì‹± ëŒ€ìƒ ì„œë²„
  server {           # ê°€ìƒ í˜¸ìŠ¤íŠ¸ ì„¤ì •
    location / { ... } # URI íŒ¨í„´ë³„ ì²˜ë¦¬ ê·œì¹™
  }
}
```

- ì„¤ëª…
```c
#sever : 'í•˜ë‚˜ì˜ ì›¹ ì‚¬ì´íŠ¸ì— ê´€ë ¨ëœ ì„¤ì •'ì„ ê´€ë¦¬í•˜ëŠ” ë‹¨ìœ„(ì„œë²„ë¸”ëŸ­ì´ë¼ê³  ë¶€ë¦„)
server {
	# localhost:80ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì„œë²„ë¸”ëŸ­ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ì •í•¨.
	# server_nameì´ ì¼ì¹˜í•˜ëŠ” ì„œë²„ë¸”ëŸ­ì´ ì—†ëŠ”ê²½ìš° ì²«ë²ˆì§¸ ì •ì˜ë˜ì–´ ìˆëŠ” ì„œë²„ë¸”ëŸ­ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬
	listen 80;
	server_name localhost;

	# /ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ê²½ë¡œ ì²˜ë¦¬í•¨
	location / {
	# ë§Œì•½ A.html ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ /usr/share/nginx/html/A.html íŒŒì¼ë¡œ ì‘ë‹µì²˜ë¦¬
		root /usr/share/nginx/html;

		# /ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ index.htmlë¡œ ì²˜ë¦¬
		index index.html
	}

	# nginxì—ì„œ 500 502 503 504 ìƒíƒœì½”ë“œê°€ ë°œìƒí–ˆì„ë•Œ, /50x.htmlë¡œ ë¦¬ë‹¤ì´ë™íŠ¸
	error_page 500 502 503 504 /50x.html;

	# /50x.htmlì™€ ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ” ê²½ë¡œë¥¼ ì²˜ë¦¬
	location = /50x.html {
	# ë§Œì•½ /50x.html ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ /usr/share/nginx/html/50x.html íŒŒì¼ë¡œ ì‘ë‹µì²˜ë¦¬
		root /usr/share/nginx/html;
	}
}
```


## ì£¼ìš” ëª¨ë“ˆ
### Core Module: ê¸°ë³¸ HTTP ê¸°ëŠ¥
ê¸°ë³¸ì ì¸ HTTP ì„œë²„ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **ì •ì  íŒŒì¼ì„ ì œê³µí•˜ê±°ë‚˜ ê¸°ë³¸ì ì¸ ì›¹ ì„œë²„ ê¸°ëŠ¥ì„ ì„¤ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        root /usr/share/nginx/html;  # ì •ì  íŒŒì¼ ê²½ë¡œ
        index index.html index.htm;  # ì¸ë±ìŠ¤ íŒŒì¼ ê²½ë¡œ
    }
}
```

### Proxy Module : ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ê¸°ëŠ¥
Nginxë¥¼ **ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„œë²„ë¡œ ì„¤ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ **í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë‹¤ë¥¸ ì„œë²„ë¡œ ì „ë‹¬í•˜ê³ , ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜**í•©ë‹ˆë‹¤.

```nginx
upstream backend-server {
    server backend1.example.com;
}


server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://backend-server;  # ë°±ì—”ë“œ ì„œë²„ URL
        proxy_set_header Host $host; # í˜¸ìŠ¤íŠ¸ ì „ë‹¬
        proxy_set_header X-Real-IP $remote_addr; #  ì‹¤ì œ IP ì£¼ì†Œ ì „ë‹¬
    }
}
```

### Upstream Module: ë¡œë“œ ë°¸ëŸ°ì‹±
**ì—¬ëŸ¬ ë°±ì—”ë“œ ì„œë²„ì— ìš”ì²­ì„ ë¶„ì‚°**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¡œë“œ ë°¸ëŸ°ì‹±ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```nginx
upstream backend {
    server backend1.example.com;
    server backend2.example.com;
}

server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://backend;  # Upstream ë¸”ë¡ ì´ë¦„
    }
}

```

### Cache Module: ì •ì  ì½˜í…ì¸  ìºì‹±
ì •ì  ì½˜í…ì¸ ë¥¼ ìºì‹œí•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. NginxëŠ” ì •ì  íŒŒì¼ì„ ìºì‹±í•˜ì—¬ ë” ë¹ ë¥¸ ì‘ë‹µì„ ì œê³µí•©ë‹ˆë‹¤.
```nginx
proxy_cache_path /tmp/nginx_cache levels=1:2 keys_zone=my_cache:10m max_size=1g inactive=60m use_temp_path=off;

server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://backend;
        proxy_cache my_cache;  # ìºì‹œ ì‚¬ìš©
        proxy_cache_valid 200 1h;  # 200 ì‘ë‹µ ìºì‹œ ì‹œê°„ ì„¤ì •
    }
}

```

### SSL Module: ì•”í˜¸í™” í†µì‹ 
HTTPSë¥¼ ì„¤ì •í•˜ì—¬ ì•”í˜¸í™”ëœ í†µì‹ ì„ ì œê³µí•©ë‹ˆë‹¤. SSL ì¸ì¦ì„œë¥¼ ì„¤ì •í•˜ì—¬ ë³´ì•ˆ ì—°ê²°ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
```nginx
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /path/to/cert.pem;  # SSL ì¸ì¦ì„œ ê²½ë¡œ
    ssl_certificate_key /path/to/key.pem;  # SSL í‚¤ ê²½ë¡œ

    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
    }
}
```


## ê¸°íƒ€
### ë¡œê·¸ ê´€ë¦¬ ì»¤ìŠ¤í…€
```nginx
http {
	# í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ê¸°ë¡í• ì§€ ì»¤ìŠ¤í…€
    log_format main '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent';
    
    # í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ì •ë³´ ê¸°ë¡
    access_log /var/log/nginx/access.log main;

	# ì˜¤ë¥˜ ë¡œê·¸ ê¸°ë¡
    error_log /var/log/nginx/error.log warn;
}
```