#ë§¤í•‘, #Get, #ë³µìŠµController

#ì¸í”„ëŸ°MVC_1í¸

ì½”ë“œ : inflearn-mvc1/mapping
[Mapping Requests (ê³µì‹ë¬¸ì„œ)](https://docs.spring.io/spring-framework/reference/web/webflux/controller/ann-requestmapping.html#webflux-ann-requestmapping-annotation)

----
#ì¸í”„ëŸ°MVC_1í¸03(page. )
# GET ê°œë…

## GET ë§¤í•‘ì´ë€?
- ì¿¼ë¦¬íŒŒë¼ë¯¸í„°ë¡œ, **/url?`username=hello&age=20` í˜•ì‹ì„ ì‚¬ìš©**í•œë‹¤.
- ë©”ì‹œì§€ ë°”ë”” ì—†ì´, **URLì˜ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì— ë°ì´í„°ë¥¼ í¬í•¨í•´ì„œ ì „ë‹¬**
- ì˜ˆ) ê²€ìƒ‰, í•„í„°, í˜ì´ì§• ë“±... ì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë°©ì‹


## GET ë§¤í•‘ êµ¬í˜„ ë‹¨ê³„
1) `@GetMapping`ìœ¼ë¡œ ì–´ë–¤ URL get ë§¤í•‘í• ì§€ ì •í•˜ê¸°
2) í•´ë‹¹ ë§¤í•‘ ìš”ì²­ë°›ì„ì§€ êµ¬í˜„í•˜ê¸°(modelì— ê°’ ì „ë‹¬ í¬í•¨)
3) ë°˜í™˜ê°’ì„ view, json, redirect í• ì§€ ì •í•˜ê¸°

![[Untitled.png]]


# ìš”ì²­ ë°©ë²• âœ”
## ì§ì ‘ ìš”ì²­
URLì„ ì§ì ‘ ì…ë ¥ : `http://localhost:8080/form`


## ë§í¬/ë²„íŠ¼ ìš”ì²­
[ì½”ë”©ì˜ ì‹œì‘, TCP School](http://www.tcpschool.com/html-tag-attrs/a-href)

![[Pasted image 20221221171900.png]]

#### ë§í¬ìš”ì²­
```html
<!--thymleaf ì‚¬ìš© O-->
<li><a href="/example">Link to example</a></li>

<!--thymleaf ì‚¬ìš© X-->
<a th:href="@{/example}">Link to example</a>
```
**hrefì— ìˆëŠ” `/example` ë¡œ Getë§¤í•‘ ìš”ì²­**í•¨.


#### ë²„íŠ¼ìš”ì²­
```html
<!--thymleaf ì‚¬ìš© O-->
<button onclick="location.href='/basic/items'">Go to example</button>

<!--thymleaf ì‚¬ìš© X-->
<a th:href="@{/example}">Link to example</a>
<button th:onclick="|location.href='@{/basic/items}'|">Go to Items</button>
```
**onclickì— ìˆëŠ” `/example` ë¡œ Getë§¤í•‘ ìš”ì²­**í•¨.


## ì…ë ¥ íŒŒë¼ë¯¸í„° ìš”ì²­
#### ê¸°ë³¸í˜•
`localhost:8086/example?username=kang&age=30` ì´ì™€ ê°™ì´ url ë§¤í•‘ì´ ëŒ
```html
<!--thymleaf ì‚¬ìš© x-->
<form action="/example" method="get">
    username: <input type="text" name="username" />
    age: <input type="text" name="age" />
    <button type="submit">ì „ì†¡</button>
</form>

<!--thymleaf ì‚¬ìš© O-->
<form th:action="@{/example}" method="get">
    ...
</form>
```
- `action` : í¼ ë°ì´í„°ë¥¼ ë³´ë‚¼ ì„œë²„ì˜ **URL**ì„ ì§€ì •, ì—¬ê¸°ì„œëŠ”  `/example` 
- `method` : ì„œë²„ë¡œ **ë°ì´í„°ë¥¼ ë³´ë‚´ëŠ” ë°©ì‹**ì„ ì§€ì •, ì—¬ê¸°ì„œëŠ”  `get` ë°©ì‹
- `input` : ì‚¬ìš©ìì—ê²Œ í…ìŠ¤íŠ¸ ì…ë ¥ì„ ë°›ê¸° ìœ„í•œ **ì…ë ¥ í•„ë“œë¥¼ ìƒì„±**, ì—¬ê¸°ì„œëŠ” `username`, `age` 


#### ê°ì²´
```html
<!--thymleaf ì‚¬ìš© x-->
<form action="/example" method="get">
    User Name: <input type="text" name="user.name" />
    User Age: <input type="text" name="user.age" />
    <button type="submit">ì „ì†¡</button>
</form>

<!--thymleaf ì‚¬ìš© O (1)-->
<form th:action="@{/example}" method="get">
    User Name: <input type="text" th:field="*{user.name}" />
    User Age: <input type="text" th:field="*{user.age}" />
    <button type="submit">ì „ì†¡</button>
</form>

<!--thymleaf ì‚¬ìš© O (2)-->
<form th:action="@{/example}" th:object="${user}" method="get">
    User Name: <input type="text" th:field="*{itemName}" />
    User Age: <input type="text" th:field="*{itemName}" />
    <button type="submit">ì „ì†¡</button>
</form>
```
- `th:object` : í¼ì˜ ë°ì´í„°ë¥¼ ë°”ì¸ë”©í•˜ëŠ” ê°ì²´ë¥¼ ì§€ì •í•˜ë©°, ì—¬ê¸°ì„œëŠ” `user` ê°ì²´ ì‚¬ìš©
- `th:field` : ì…ë ¥ í•„ë“œì™€ ëª¨ë¸ ê°ì²´ì˜ ì†ì„±ì„ ë°”ì¸ë”©í•˜ë©°. ì—¬ê¸°ì„œëŠ” `user`ê°ì²´ì˜ `itemName` ì†ì„±ê³¼ ë°”ì¸ë”©ë©ë‹ˆë‹¤.

#### ajax
[[05. ìŠ¤í”„ë§ê³¼ ajax]] ì°¸ê³ 

# ìš”ì²­ ë°›ê¸° âœ”
```
1) ì •ì  URL
2) ë™ì  URL (@PathVariable)
3) URL + ë³€ìˆ˜ (@RequestParam, @ModelAttribute)
```

## ê¸°ë³¸ URL í˜¸ì¶œ
#### ë‹¨ì¼ URL
```java
@GetMapping("/home")  
public String newForm() {  
    return "newHome";  
}
```


#### ë‹¤ì¤‘ URL
```java
@ResponseBody  
@GetMapping({"/home-stay", "/home-go"})  
public String helloBasic() {  
    return "helloBasic";  
}
```


#### Model O
modelì˜ ê°’ì„ viewì—ê²Œ ì „ë‹¬
```java
@GetMapping("/variable")
public String variable(Model model) {
	User userA = new User("userA", 10);
	User userB = new User("userB", 20);

	List<User> list = new ArrayList<>();
	list.add(userA);
	list.add(userB);

	Map<String, User> map = new HashMap<>();
	map.put("userA", userA);
	map.put("userB", userB);

	model.addAttribute("user", userA);
	model.addAttribute("users", list);
	model.addAttribute("userMap", map);

	return "basic/variable";
}
```
`model.addAttribute(ë·°ì—ì„œ ë°ì´í„°ë¥¼ ì°¸ì¡°í•  ë³€ìˆ˜, í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜)`ë¡œ viewë¡œ ê°’ ì „ë‹¬í•¨.
viewì—ì„œëŠ” `ì°¸ì¡°í•  ë³€ìˆ˜`ë¥¼ í†µí•´ì„œ ë°ì´í„° ë§¤í•‘ê°€ëŠ¥í•¨.


## @RequestParam (ê¸°ë³¸í˜•)
**íŒŒë¼ë¯¸í„° ê°’ì´ ìˆì„ ë•Œ, ìš”ì²­** ë°›ëŠ” ë°©ë²•. ê¸°ë³¸í˜•ì€ **String, int, Long**ì„ ìš”ì²­ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ.
ìš”ì²­ë°©ë²• : `localhost:8082/request-param-basic?username=kang&age=30` í˜•ì‹

#### ê¸°ë³¸ê°’
```java
@ResponseBody  
@GetMapping("/request-param-basic")  
public String requestParamBasic(@RequestParam String username, 
								@RequestParam int age) {  
    log.info("username={}, age={}", username, age);  
    return "requestParamV3";  
}
```


#### Model O
```java
@GetMapping("/variable-input")  
public String variableInput(@RequestParam String username,  
                            @RequestParam int age,  
                            Model model) {  
    User userA = new User(username, age);  
    User userB = new User("userB", 20);  
  
    List<User> list = new ArrayList<>();  
    list.add(userA);  
    list.add(userB);  
  
    Map<String, User> map = new HashMap<>();  
    map.put("userA", userA);  
    map.put("userB", userB);  
  
    model.addAttribute("user", userA);  
    model.addAttribute("users", list);  
    model.addAttribute("userMap", map);  
  
    log.info("User username={}, age={}", userA.getUsername(), userA.getAge());  
    log.info("User username={}, age={}", userB.getUsername(), userB.getAge());  
  
    return "basic/variable";  
}
```


## @RequestParam (ìë£Œêµ¬ì¡°)
[ìŠ¤í”„ë§ controllerì—ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ëŠ” ë‹¤ì–‘í•œ ë°©ë²•](https://velog.io/@shson/%EC%8A%A4%ED%94%84%EB%A7%81-controller%EC%97%90%EC%84%9C-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A5%BC-%EB%B0%9B%EB%8A%94-%EB%8B%A4%EC%96%91%ED%95%9C-%EB%B0%A9%EB%B2%95-RequestParam-RequestBody-PathVariable#4-map-%ED%99%9C%EC%9A%A9)
ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ì„œÂ `@RequestParam`Â ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ìë™ìœ¼ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤. **ê° ìë£Œêµ¬ì¡°(`List`,Â `Map`,Â `Set`)ì— ë§ê²Œ ìš”ì²­ëœ ë°ì´í„°ë¥¼ ë³€í™˜**í•˜ì—¬ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ì— ì „ë‹¬í•©ë‹ˆë‹¤.
**ê°„ë‹¨í•œ JSON ë°ì´í„° ì‘ë‹µ** í•˜ëŠ”ë° ì‚¬ìš©í•¨.

#### List ìš”ì²­ ë°›ê¸°
```java
@GetMapping("/request-param-list")
public ResponseEntity<List<Integer>> getItems(@RequestParam List<Integer> ids) {
    // ë°›ì€ ids ì¶œë ¥
    return ResponseEntity.ok(ids);
}
```

â–¶ ìš”ì²­ -> `/request-param-list?ids=1&ids=2&ids=3`

â–¶ ê²°ê³¼
```json
[
    1,
    2,
    3
]
```


#### `List<User>` ìš”ì²­ ë°›ê¸°
`username`, `age` ë”°ë¡œë”°ë¡œ Listì— ë‹´ëŠ”ë‹¤.
```java
@GetMapping("/request-param-list-users")
public ResponseEntity<List<User>> getUsers(
		@RequestParam List<String> username,
		@RequestParam List<Integer> age) {
	
	List<User> users = new ArrayList<>();
	
	// usernameê³¼ age ë¦¬ìŠ¤íŠ¸ì˜ í¬ê¸°ê°€ ê°™ë‹¤ê³  ê°€ì •í•˜ê³  ì‚¬ìš©ìë¥¼ ìƒì„±
	for (int i = 0; i < username.size(); i++) {
		users.add(new User(username.get(i), age.get(i)));
	}
	
	return ResponseEntity.ok(users);
}
```

â–¶ ìš”ì²­ -> `/users?username=user1&age=30&username=user2&age=25`

â–¶ ê²°ê³¼
```json
[
    {
        "username": "user1",
        "age": 30
    },
    {
        "username": "user2",
        "age": 25
    }
]
````


#### Map ìš”ì²­ ë°›ê¸°
```java
//íŒŒë¼ë¯¸í„°ë¥¼ Mapìœ¼ë¡œ ì¡°íšŒ
@ResponseBody  
@GetMapping("/request-param-map")  
public String requestParamMap(@RequestParam Map<String, Object> paramMap) {  
    log.info("username={}, age={}, gender={}", 
	    paramMap.get("username"), 
	    paramMap.get("age"), 
	    paramMap.get("gender"));  
	    
    return "requestParamMap";  
}
```

â–¶ ìš”ì²­ (1) -> 3ê°œì˜ íŒŒë¼ë¯¸í„° ëª¨ë‘ ë„£ëŠ” ê²½ìš°
`http://localhost:8086/request-param-map?username=kang&age=29&gender=man` 
![[Pasted image 20221222154227.png]]

â–¶ ê²°ê³¼ (1)
```
username=kang, age=29, gender=man
```


â–¶ ìš”ì²­ (2) -> `gender`ì˜ ê°’ì„ ì•ˆë„£ëŠ” ê²½ìš°
`http://localhost:8086/request-param-map?username=kang&age=29`

â–¶ ê²°ê³¼ (2)
```
username=kang, age=29, gender=null
```


## @RequestParam (ì˜µì…˜)
#### ìš”ì²­ íŒŒë¼ë¯¸í„° ê°’ â‰  ë³€ìˆ˜ ê°’
`username`  -> `memberName`, `age` -> `memberAge`ë¡œ ë“¤ì–´ì˜¨ ê°’ì„ ê°ê° ë°”ì¸ë”©í•¨.
```java
@ResponseBody  
@GetMapping("/request-param-variable")  
public String requestParamVariable(@RequestParam("username") String memberName, 
								   @RequestParam("age") int memberAge) {  
    log.info("username={}, age={}", memberName, memberAge);  
    return "requestParamAnotherVariable";  
}
```


#### ì…ë ¥ ìœ /ë¬´, ê¸°ë³¸ê°’ì„ ì„¤ì •
ê¸°íƒ€ ì„¤ì •(requiredëŠ” í•„ìˆ˜ ê°’, defaultValueëŠ” ê¸°ë³¸ ê°’)
```java
@GetMapping("/request-param-default")  
public String requestParamDefault(  
        @RequestParam(required = true, defaultValue = "guest") String username,  
        @RequestParam(required = false, defaultValue = "-1") int age) {  
    log.info("username={}, age={}", username, age);  
    return "ok";  
}
//ì¶œë ¥ username=guest, age=-1
```
- `required` : íŒŒë¼ë¯¸í„°ê°€ trueë©´ ìš”ì²­ íŒŒë¼ë¯¸í„°ì— ê¼­ ìˆì–´í•˜ëŠ” ê²ƒ
- `defaultValue` : ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì„ ë•Œ, ê¸°ë³¸ ê°’ ì§€ì •í•¨.


## @ModelAttribute (ê°ì²´)
- **URL ì¸ì½”ë”©ëœ í¼ ë°ì´í„°ë¥¼ DTOë¡œ ë³€í™˜**í•  ë•Œ ì‚¬ìš©.

â–¶ **`@ModelAttribute`ì˜ ì—­í• **
1. íŒŒë¼ë¯¸í„°ë¥¼ ìš”ì²­ ë°›ê¸°   ex) `@RequestParam String itemName`
2. ê°ì²´ ìƒì„±í•˜ê¸°  ex) Item item = new Item();`
3. ê°ì²´ì— íŒŒë¼ë¯¸í„° ë„£ê¸°(**ê°ì²´ê°€ Setí•¨ìˆ˜ í•„ìˆ˜**) ex)  `item.setItemName(itemName);`
4. modelì— ë„£ì–´ì„œ viewì— ë„˜ê²¨ì£¼ê¸° ex) `model.addAttribute("item", item);`

#### `@RequestParam`ë¡œ ë‚˜íƒ€ë‚´ë©´?
```java
@RequestMapping("model-attribute-v1")  
public String modelAttributeV1(@RequestParam String username,  
                               @RequestParam int age,  
                               Model model) {  
  
    User userA = new User(username, age);  
    model.addAttribute("user", userA);  

    return "UserPage";
}
```


#### `@ModelAttribute` ì‚¬ìš©
```java
@RequestMapping("model-attribute-v2")  
public String modelAttributeV2(@ModelAttribute User user) {  
	return "UserPage";  
}
```
**ê°ì²´ ë³€í™˜ + modelì— ë‹´ê¸°ë¥¼ ìë™í™”** í•´ì¤Œ. **User ê°ì²´ê°€ ì¡´ì¬í•´ì•¼í•¨**


#### `@ModelAttribute("name")`
```java
@RequestMapping("model-attribute-v3")  
public String modelAttributeV3(@ModelAttribute("item") User user) {  
    return "UserPage2";  
}
```
- `"name"`ì€ **ëª¨ë¸ì— ì¶”ê°€ë  ê°ì²´ì˜ ì´ë¦„** ex) `model.addAttribute("item", user);` ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë·°ì—ì„œ í•´ë‹¹ ê°ì²´ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```html
<div>  
    <label>username:</label>  
    <p type="text" th:text="${item.username}"></p>  
  
    <label>age:</label>  
    <p type="number" th:text="${item.age}"></p>  
</div>
```


## @PathVariable (URI ê²½ë¡œ)
**URL ê²½ë¡œì— ë”°ë¼ ë™ì **ìœ¼ë¡œ ë³€í•¨.

#### ë‹¨ì¼ ê²½ë¡œ
ìš”ì²­ ë§¤í•‘ : `http://localhost:8080/mapping/kang`
```java
@ResponseBody  
@GetMapping("/mappings/{data}")  
public String mappingPath(@PathVariable String data) {  
    log.info("mappingPath userId={}", data);  
    return "mappingPath";  
}
```


#### ë‹¤ì¤‘ ê²½ë¡œ
ìš”ì²­ ë§¤í•‘ : `http://localhost:8080/mapping/kang/2`
```java
@ResponseBody  
@GetMapping("/mappings/{data}/{id}")  
public String mappingPathTwo(@PathVariable String data, 
							 @PathVariable("id") int num) {  
    log.info("mappingPath userId={} {}", data, num);  
    return "mappingPathTwo";  
}
```


ğŸ§¨ì£¼ì˜ì  
```html
<form th:action="@{'/mappings/' + data + '/' + id}" method="get"> ë‹¤ì¤‘ ê²½ë¡œ(ì…ë ¥) :  
    data: 
    <label>  
        <input type="text" name="data"/>  
    </label>    
    id: 
    <label>  
        <input type="text" name="id"/>  
    </label>    
    <button type="submit">ì „ì†¡</button>  
</form>
```
íƒ€ì„ë¦¬í”„ë¥¼ ì´ìš©í•´ì„œ ì…ë ¥í•´ì„œ ê°ˆ ìˆ˜ ì—†ì—ˆë‹¤.
`localhost:8086/mappings/23/11` ê°€ ì•„ë‹Œ
`localhost:8086/mappings/data/id?data=23&id=11` ì´ì™€ ê°™ì´ url ë§¤í•‘ì´ ëŒ


# ì‘ë‹µ í•˜ê¸° âœ”
```
1) view ì‘ë‹µ
2) Http ì‘ë‹µ (Json í¬í•¨)
```
## view ì‘ë‹µ
####  viewì— ë³€ìˆ˜ê°’ì— ë°”ì¸ë”© X
resourcesì— ìˆëŠ” htmlì˜ ì´ë¦„ì´ ë§¤ì¹­í•˜ì—¬ viewë¥¼ ì°¾ê³  ëœë”ë§í•¨.
```java
@GetMapping("/newHome")  
public String newHome() {return "newHome";}
```

```html
<body>  
    <h1> ë¹ˆí˜ì´ì§€ </h1>  
</body>
```


#### viewì— ë³€ìˆ˜ê°’ì— ë°”ì¸ë”© O
```java
//view ë°˜í™˜ : ë‹¤ìŒ view ì…ë ¥ê°’ O (Model X)
@GetMapping("/addMemberSuccess")  
public String addMemberSuccess(Model model) {  
    model.addAttribute("member", new Member());  
    return "formMember";  
}
```

```html
<body>  
<form th:action="@{/submit}" th:object = "${member}" method="post">  
    ì´ë¦„: <input type="text" th:field ="*{name}"><br>  
    ì´ë©”ì¼: <input type="text" th:field ="*{email}"><br>  
    <input type="submit" value="ì „ì†¡">  
</form>  
</body>
```
thymeleafë¥¼ ì´ìš©í• ë•, view ë³€ìˆ˜ê°’ì— ë°”ì¸ë”©í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— modelì— ê°’ì„ ë„˜ê²¨ì£¼ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ë‚¨.


ğŸ§¨ex) viewì— ë³€ìˆ˜ê°’ì— ë°”ì¸ë”© Oì— Modelì„ ì•ˆë„˜ê²¨ì¤€ ê²½ìš°
```java
@GetMapping("/formMemberNoThyme")  
public String addMemberFailNoThymeleaf() {  
    return "formMemberNoThyme";  
}
```

```
java.lang.IllegalStateException: Neither BindingResult nor plain target object for bean name 'member' available as request attribute at org.springframework.web.servlet.support.BindStatus.
```
`IllegalStateException` ì˜¤ë¥˜ ë°œìƒí•¨.

## HTTP ì‘ë‹µ
#### json
viewë¥¼ ì°¾ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **Http ë©”ì‹œì§€ ë°”ë””ì— ë°”ë¡œ ì…ë ¥**í•¨.
```java
@ResponseBody  
@RequestMapping("/newHello-go")  
public String newGoHome() {return "newHello-go";}
```
í´ë˜ìŠ¤ì— `@RestController`ê°€ ìˆì–´ë„ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤.


#### HTTP 
[[01. HTTP ì‘ë‹µ (ì‹¤ë¬´)]] ì°¸ê³ 